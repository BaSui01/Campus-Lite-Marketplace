# ╔═══════════════════════════════════════════════════════════════════════╗
# ║  校园轻享集市系统 - 环境配置模板                                           ║
# ║  Campus Lite Marketplace - Environment Configuration Template         ║
# ╚═══════════════════════════════════════════════════════════════════════╝
#
# 📝 使用方法: cp .env.example .env 然后修改 .env 中的配置
# ⚠️ 重要: .env.example 提交到 git，.env 千万别提交（有密钥！）

# ==================== 应用基础配置 ====================
APP_NAME=campus-marketplace
SPRING_PROFILES_ACTIVE=dev
SERVER_PORT=8200
APP_CONTEXT_PATH=/api
DOCKER_COMPOSE_FILE=docker/docker-compose.yml

# ==================== PostgreSQL 数据库配置 ====================
DB_HOST=localhost
DB_PORT=5432
DB_NAME=campus_marketplace
DB_USERNAME=postgres
DB_PASSWORD=123456

# HikariCP 连接池配置
DB_POOL_MIN_IDLE=5
DB_POOL_MAX_SIZE=20
DB_CONNECTION_TIMEOUT=30000
DB_IDLE_TIMEOUT=600000
DB_MAX_LIFETIME=1800000
DB_POOL_NAME=CampusMarketplaceHikariCP

# ==================== Flyway 数据库迁移配置 ====================
# 开发环境关闭 Flyway，使用 JPA 自动建表
# 生产环境建议启用 Flyway，使用迁移脚本管理数据库版本
FLYWAY_ENABLED=false

# ==================== JPA / Hibernate 配置 ====================
# DDL 策略: update(开发环境), validate(生产环境)
JPA_DDL_AUTO=update
JPA_SHOW_SQL=false
JPA_FORMAT_SQL=false
JPA_ENABLE_LAZY_NO_TRANS=false
JPA_BATCH_SIZE=50
JPA_ORDER_INSERTS=false
JPA_ORDER_UPDATES=false
HIBERNATE_SECOND_LEVEL_CACHE=true
HIBERNATE_QUERY_CACHE=true

# ==================== Redis 缓存配置 ====================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DATABASE=0

# Redis 连接池配置
REDIS_POOL_MAX_ACTIVE=20
REDIS_POOL_MAX_IDLE=10
REDIS_POOL_MIN_IDLE=5

# Redis 哨兵模式配置（高可用）
REDIS_SENTINEL_MASTER=
REDIS_SENTINEL_NODES=

# ==================== 邮件服务配置 ====================
MAIL_HOST=localhost
MAIL_PORT=1025
MAIL_USERNAME=
MAIL_PASSWORD=
MAIL_FROM_NAME=校园轻享集市
MAIL_SSL_ENABLE=false
MAIL_STARTTLS_ENABLE=false
MAIL_MOCK_ENABLED=true

# ==================== 短信服务配置(阿里云) ====================
SMS_PROVIDER=aliyun
ALIYUN_SMS_ACCESS_KEY_ID=
ALIYUN_SMS_ACCESS_KEY_SECRET=
ALIYUN_SMS_SIGN_NAME=
ALIYUN_SMS_TEMPLATE_REGISTER=SMS_0000001
ALIYUN_SMS_TEMPLATE_RESET=SMS_0000002

# ==================== JWT 认证配置 ====================
# JWT 密钥（建议生成随机字符串，至少64字符）
JWT_SECRET=5bwzFhN2dpPiac1wgPaFgb5iu_lEB5JrSxZqv-WIOwRiE_dQOE-fMFxy24-iOXgWm1NxybaJMrkbCXG9mY0a4Q

# Access Token 过期时间（毫秒）- 默认15分钟
JWT_EXPIRATION=900000

# Refresh Token 过期时间（毫秒）- 默认7天
JWT_REFRESH_EXPIRATION=604800000

# JWT 请求头配置
JWT_HEADER=Authorization
JWT_PREFIX="Bearer "

# ==================== AES 加密配置 ====================
AES_KEY=JrOagghJ4Ot3e63ObB1CJtOjvwYnk1chSwXR86E_MJs
BACKEND_ENCRYPT_KEY=JMMgf1RSDLBNksxUSNKl/2q94N6cIY7voJRXqlzcCBA=

# ==================== 验证码配置 ====================
VERIFICATION_CODE_LENGTH=6
VERIFICATION_CODE_EXPIRATION=600
VERIFICATION_RATE_LIMIT=60

# ==================== 双因素认证(2FA)配置 ====================
TWO_FACTOR_ENABLED=true
TWO_FACTOR_CODE_EXPIRATION=600

# ==================== 文件上传配置 ====================
FILE_UPLOAD_DIR=./uploads/dev
FILE_ALLOWED_EXTENSIONS=jpg,jpeg,png,gif
FILE_MAX_SIZE=5242880
FILE_MAX_REQUEST_SIZE=20971520
FILE_UPLOAD_ENABLED=true

# ==================== 支付宝支付配置 ====================
# 应用ID（沙箱环境）
ALIPAY_APP_ID=9021000141612345

# 应用私钥（PKCS#1 格式，请勿泄露！）
ALIPAY_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQCcKNKJfSLSeGgyeC+nfzPU0YA/4UoGOCPPBLvnm2CRPNrWA3HfSC/h1D32MbD22NFR/vlBA6XMNOIvHptjD9tF6xttb1MANc6/Iq5S1j2SAOCmeGUKqdtIB8BB+nQXkrD0SLcl91KHtXTd/Uv/7ubGS3tYh2i5eoaa9rOh3yl99ngx7gbCsDXkH1tznTTp4trwQkNmXVzloHcJkRuNFRSwosVRrSYIYuw7i0G4ruOjypxRSjvVM5EU5YFJNtaZjlE1AOl8GGVhB/VOGzR3cRMxAUPJTNPRXe5bA7Z5PoHEv+d6CFw090kqD483shOoMSYqrcB/iSz+opp0uaYu2fXvAgMBAAECggEBAIaaQW+1Z1CX7Oij5B+ya1DkDHIDlTTrKyKEaBtpOMG3/MFAUuUtaeh0c7xEdM8xcKwG5X5+0GjGpLgM389xmYYY85lOvfKObtkd4bkRZhz1mK6lVCLu6k6aL8QvR+YR0WmfTA7zsjW72TKH5PyERnNiGL3kagaGcIQeZhP/MdqaPtbBJbyrpBLwBES+YdQu4QySxTKaxF2vAY8hKp2YYj21p759HPo0uKBDH3Zo08iW3CftLhcYAesdnTIjOKmfblNt/e9xrAKGKz2ZN8A//kudVch3IQWdb/TAY1PS+AMlYvg1P3/WfOfTcgKhgtt5HPD9yGJaVWmLZEcn+vZWuBECgYEA40gHaYBGLH/2Frb82eI5x1elCUoDCa3/NzCppgDATAx/XxzQGb0rlcrp3CF5iHJPdo4YTemvAYSulQn3WGlooDq+lWmVX7ewPBEhdIy0BwZ3cLogw5p8uIXDr4wVyCueLD8Y/m5LqF+PYO+CuvyoNE+e1Z9Swn0GzJxHGhEoyZUCgYEAr+Quilg5U2bOrpGGuKUQXkXyQyQQ6jtuK7B35abbDUwRdwcdp8qK08shkye+WdYeFrH+1Dk8wTeqb7cKAVoaG7u1yGV/3IVp+DZ5lb8k2ZNAUmA5K+sURGgGELbNuklWx6GIj02uXvhXsdR7WLhQjvsfMHu4wpF7+5Y1uKcfyHMCgYEAi3YpRi114dxrDqkeIjxUo+M926NUld30mtL7ZmdTl9abWat+bizLz9CBC5hm0LkD1YV/mF9qCY526fEBm3iiwJ8LTvdIt0EpnNIOK0wjM6ReKgesDxp+qWM7Hj7hJsDM/+1/0q+vMRPiEOMm3sImHGM23XI0AC9juq2yW2ZoFrkCgYEAowUEkZplP0RoyOj+CUKLYiTH/ax+tOlyGbIL3eCA49kd0sjYlnwloViCfMX4KYFHD9fXDFEkWxxBrhrifhBJZGzcdaiFEhjg93ldxQmMmM9ebTrbojXV6fTTskgLct2oPYwcal0gAMuBU8NQsxDZMTvUU3ZH7qUyWSKGFednkLsCgYB0hbusnxfV2hcR+/A6oDK042VGU9RC71I0j6JK5zxusgFp43Wss+TuHlfWOpWP8IUtZZgWE5jKgZKZr2LC4fibN2oeVr8Jhb6iKjgae9Rratuo37VJrRudR1DJPeTLLsXMERIs6cHTStz5qcMCPffnb/4vtcbNdvZs4nl3PIY68w==

# 支付宝公钥（用于验证支付宝返回的签名）
ALIPAY_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxwDQsZzIFnmYbTPBS12E1SjH0ImCr6NbM+CxY1bjGhhn1dsR5i+nVPil4ap4KSOVwlZuJuxQix/sW5QY4fr/ocMEjhWkjG+9VRJfVbrdZZUpZ6Mw9D8YMkJJLKwGS2+3WpBzABhTcq+JE0lt64OkAiCQ4UhipHVyAQ6Ap2G0eeuWKRMSpjX8jfcIZEMY4NMd2vkbRMNLXPjRqEhdwHAfxrZbFMTdT9Iw52kl3cRcwpZmjd6/zdRn1qdUbBB5+LkayLtrG6Vfz0rJfSIvM+AIyDXkZSukhVYO/mhGXebSQLuK8L0MFm2I0eBjLGgpHGdBx6u7sY1VU64sbp/YcBujjwIDAQAB

# 应用公钥（可选，用于双向验证）
ALIPAY_APP_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnCjSiX0i0nhoMngvp38z1NGAP+FKBjgjzwS755tgkTza1gNx30gv4dQ99jGw9tjRUf75QQOlzDTiLx6bYw/bResbbW9TADXOvyKuUtY9kgDgpnhlCqnbSAfAQfp0F5Kw9Ei3JfdSh7V03f1L/+7mxkt7WIdouXqGmvazod8pffZ4Me4GwrA15B9bc5006eLa8EJDZl1c5aB3CZEbjRUUsKLFUa0mCGLsO4tBuK7jo8qcUUo71TORFOWBSTbWmY5RNQDpfBhlYQf1Ths0d3ETMQFDyUzT0V3uWwO2eT6BxL/neghcNPdJKg+PN7ITqDEmKq3Af4ks/qKadLmmLtn17wIDAQAB

# 支付网关地址（沙箱环境）
ALIPAY_GATEWAY_URL=https://openapi-sandbox.dl.alipaydev.com/gateway.do

# 支付回调地址（异步通知）
ALIPAY_NOTIFY_URL=http://localhost:8200/api/payment/alipay/notify

# 支付完成后跳转地址（同步返回）
ALIPAY_RETURN_URL=http://localhost:3000/payment/result

# 数据格式
ALIPAY_FORMAT=json

# 签名类型（RSA2 推荐）
ALIPAY_SIGN_TYPE=RSA2

# 字符集编码
ALIPAY_CHARSET=UTF-8

# ==================== 微信支付配置 ====================
WECHAT_PAY_VERSION=v3

# 微信支付 V2 配置（沙箱环境）
WECHAT_V2_APP_ID=
WECHAT_V2_MCH_ID=
WECHAT_V2_MCH_KEY=
WECHAT_V2_KEY_PATH=
WECHAT_V2_USE_SANDBOX=true
WECHAT_V2_NOTIFY_URL=http://localhost:8200/api/payment/wechat/notify

# 微信支付 V3 配置（正式环境）
WECHAT_APP_ID=wxa23d5ae949f8fd73
WECHAT_MCH_ID=
WECHAT_PRIVATE_KEY_PATH=
WECHAT_MERCHANT_SERIAL_NUMBER=
WECHAT_API_V3_KEY=
WECHAT_NOTIFY_URL=http://localhost:8200/api/payment/wechat/notify

# ==================== 佣金配置 ====================
COMMISSION_RATE=0.01
COMMISSION_MIN_RATE=0.005
COMMISSION_MAX_RATE=0.05

# ==================== ngrok 内网穿透配置 ====================
# 🌐 用途: 将本地前后端服务同时暴露到公网
#   - 8200: 后端API（支付回调必需）
#   - 8210: 前端管理端（可选）
#   - 8220: 前端用户端（可选）
#
# 📝 获取Token: https://dashboard.ngrok.com/get-started/your-authtoken
# 🔧 启动方式: docker compose --project-directory . -f docker/docker-compose.yml --profile tunnel up -d
# 🌐 管理界面: http://localhost:4040（查看所有公网地址）
# ⚠️ 必须设置！未设置会导致 ngrok 服务启动失败
NGROK_AUTHTOKEN=your_ngrok_authtoken_here

# 💡 获取到公网地址后，更新支付回调配置
# 示例: 
#   后端: https://xxxx-backend.ngrok-free.app
#   管理端: https://yyyy-admin.ngrok-free.app
#   用户端: https://zzzz-portal.ngrok-free.app

# ==================== 限流配置 ====================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT_LIMIT=100
RATE_LIMIT_DEFAULT_PERIOD=60

# ==================== 日志配置 ====================
# 日志级别: TRACE → DEBUG → INFO → WARN → ERROR → FATAL
LOG_LEVEL_ROOT=INFO
LOG_LEVEL_APP=DEBUG
LOG_LEVEL_SQL=DEBUG
LOG_LEVEL_SPRING_SECURITY=DEBUG
LOG_LEVEL_BINDER=TRACE

# 日志文件配置
LOG_DIR=logs
LOG_FILE_BASENAME=campus-marketplace
LOG_FILE_PATH=logs/campus-marketplace.log
LOG_FILE_MAX_SIZE=10MB
LOG_FILE_MAX_HISTORY=30
SLOW_QUERY_LOG_MAX_HISTORY=7

# 日志格式配置
LOG_PATTERN_CONSOLE="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
LOG_PATTERN_FILE="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
LOGBACK_PATTERN=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50}:%line - %msg%n
LOGBACK_PATTERN_COLOR=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %highlight(%-5level) %cyan(%logger{50}):%line - %msg%n

# ==================== Spring Boot Actuator 监控配置 ====================
ACTUATOR_ENDPOINTS=*
ACTUATOR_HEALTH_SHOW_DETAILS=always
ACTUATOR_BASE_PATH=/actuator
ACTUATOR_EXCLUDE=shutdown
PROMETHEUS_ENABLED=true
METRICS_HTTP_HISTOGRAM=true
TRACING_PROBABILITY=1.0

# ==================== API 文档配置 ====================
SPRINGDOC_ENABLED=true
SWAGGER_UI_ENABLED=true

# ==================== 调试配置 ====================
DEBUG_ENABLED=true
DEBUG_SHOW_ERROR_DETAILS=true

# ==================== Tomcat 线程池配置 ====================
TOMCAT_MAX_THREADS=200
TOMCAT_MIN_SPARE_THREADS=10

# ==================== 静态资源配置 ====================
STATIC_RESOURCE_BASE_URL=http://localhost:8200
GOODS_IMAGE_UPLOAD_DIR=./uploads/goods
USER_AVATAR_UPLOAD_DIR=./uploads/avatars
IMAGE_ALLOWED_EXTENSIONS=jpg,jpeg,png,gif,webp
IMAGE_MAX_SIZE=5242880
GOODS_MAX_IMAGES=9

# ==================== 前端配置(Vite 需要 VITE_ 前缀) ====================
VITE_API_BASE_URL=http://localhost:8200/api
VITE_WS_URL=ws://localhost:8200/ws
VITE_STATIC_BASE_URL=http://localhost:8200
VITE_APP_TITLE_ADMIN=校园轻享集市 - 管理端
VITE_APP_TITLE_PORTAL=校园轻享集市
VITE_APP_DESCRIPTION=校园二手交易与社区平台
VITE_ADMIN_PORT=8210
VITE_PORTAL_PORT=8220
VITE_ENCRYPT_KEY=JMMgf1RSDLBNksxUSNKl/2q94N6cIY7voJRXqlzcCBA=
