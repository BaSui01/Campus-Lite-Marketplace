# 校园轻享集市系统 - 生产环境配置模板
# 使用说明：复制为 .env 并按生产环境真实值填写；或在部署编排中以环境变量覆盖

# ==================== 应用配置 ====================
APP_NAME=campus-marketplace
SPRING_PROFILES_ACTIVE=prod
SERVER_PORT=8080
APP_CONTEXT_PATH=/api
DOCKER_COMPOSE_FILE=docker/docker-compose.prod.ha.yml

# ==================== PostgreSQL 配置 ====================
DB_HOST=postgres-master
DB_PORT=5432
DB_NAME=campus_marketplace_prod
DB_USERNAME=
DB_PASSWORD=
DB_POOL_MIN_IDLE=20
DB_POOL_MAX_SIZE=100
DB_CONNECTION_TIMEOUT=30000
DB_IDLE_TIMEOUT=600000
DB_MAX_LIFETIME=1800000
DB_POOL_NAME=CampusMarketplaceHikariCP

# ==================== JPA 配置 ====================
JPA_DDL_AUTO=validate
JPA_SHOW_SQL=false
JPA_FORMAT_SQL=false
JPA_ENABLE_LAZY_NO_TRANS=false
JPA_BATCH_SIZE=100
JPA_ORDER_INSERTS=true
JPA_ORDER_UPDATES=true
HIBERNATE_SECOND_LEVEL_CACHE=true
HIBERNATE_QUERY_CACHE=true

# ==================== Redis（生产可用 Sentinel）====================
# 方式一：直连单实例/主从（无 Sentinel）
REDIS_HOST=redis-master
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DATABASE=0

# 方式二：Sentinel（推荐生产）— 同时配置以下两项即启用
REDIS_SENTINEL_MASTER=mymaster
REDIS_SENTINEL_NODES=redis-sentinel-1:26379,redis-sentinel-2:26379,redis-sentinel-3:26379

# 连接池
REDIS_POOL_MAX_ACTIVE=200
REDIS_POOL_MAX_IDLE=50
REDIS_POOL_MIN_IDLE=10

# ==================== 邮件配置 ====================
MAIL_HOST=
MAIL_PORT=465
MAIL_USERNAME=
MAIL_PASSWORD=
MAIL_FROM_NAME=校园轻享集市
MAIL_SSL_ENABLE=true
MAIL_STARTTLS_ENABLE=false
# 生产必须为 false（否则不发真实邮件）
MAIL_MOCK_ENABLED=false

# ==================== 短信（阿里云）====================
SMS_PROVIDER=aliyun
ALIYUN_SMS_ACCESS_KEY_ID=
ALIYUN_SMS_ACCESS_KEY_SECRET=
ALIYUN_SMS_SIGN_NAME=
ALIYUN_SMS_TEMPLATE_REGISTER=
ALIYUN_SMS_TEMPLATE_RESET=

# ==================== JWT 配置 ====================
# 🔐 JWT密钥（必须填写！建议≥64字节强随机密钥）
# 🚨 安全警告：绝不使用默认值！生产环境必须随机生成！
# 生成方式: python -c "import secrets; print(secrets.token_urlsafe(64))"
# 示例: 5bwzFhN2dpPiac1wgPaFgb5iu_lEB5JrSxZqv-WIOwRiE_dQOE-fMFxy24-iOXgWm1NxybaJMrkbCXG9mY0a4Q
JWT_SECRET=
JWT_EXPIRATION=7200000
JWT_REFRESH_EXPIRATION=604800000

# ==================== AES 加密配置 ====================
# 🔐 AES密钥（必须填写！建议≥32字节支持AES-256）
# 🚨 安全警告：绝不使用默认值！生产环境必须随机生成！
# 生成方式: python -c "import secrets; print(secrets.token_urlsafe(32))"
# 示例: JrOagghJ4Ot3e63ObB1CJtOjvwYnk1chSwXR86E_MJs
AES_KEY=

# ==================== 文件上传配置 ====================
FILE_UPLOAD_DIR=/app/uploads
FILE_ALLOWED_EXTENSIONS=jpg,jpeg,png,gif
FILE_MAX_SIZE=10MB
FILE_MAX_REQUEST_SIZE=50MB
FILE_UPLOAD_ENABLED=true

# ==================== 支付宝（正式网关）====================
ALIPAY_APP_ID=
ALIPAY_PRIVATE_KEY=
ALIPAY_PUBLIC_KEY=
ALIPAY_GATEWAY_URL=https://openapi.alipay.com/gateway.do
ALIPAY_NOTIFY_URL=https://your-domain.com/api/payment/alipay/notify
ALIPAY_RETURN_URL=https://your-domain.com/payment/result

# ==================== 微信支付配置 ====================
# 生产默认使用 V3 正式环境；若仍处于沙箱联调，可将 WECHAT_PAY_VERSION 调整为 v2 并填写下方 V2 参数
WECHAT_PAY_VERSION=v3

# ------ V3 正式环境 ------
WECHAT_APP_ID=
WECHAT_MCH_ID=
WECHAT_PRIVATE_KEY_PATH=/etc/keys/wechat/apiclient_key.pem
WECHAT_MERCHANT_SERIAL_NUMBER=
WECHAT_API_V3_KEY=
WECHAT_NOTIFY_URL=https://your-domain.com/api/payment/wechat/notify

# ------ V2 沙箱（可选，用于预生产联调）------
WECHAT_V2_APP_ID=
WECHAT_V2_MCH_ID=
WECHAT_V2_MCH_KEY=
WECHAT_V2_KEY_PATH=
WECHAT_V2_USE_SANDBOX=true
WECHAT_V2_NOTIFY_URL=https://your-domain.com/api/payment/wechat/notify

# ==================== 佣金 & 限流 ====================
COMMISSION_RATE=0.01
COMMISSION_MIN_RATE=0.005
COMMISSION_MAX_RATE=0.05
RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT_LIMIT=300
RATE_LIMIT_DEFAULT_PERIOD=60

# ==================== 日志 & 观测 ====================
LOG_LEVEL_ROOT=INFO
LOG_LEVEL_APP=INFO
LOG_LEVEL_SQL=INFO
LOG_FILE_PATH=/var/log/campus-marketplace/app.log
LOG_FILE_MAX_SIZE=50MB
LOG_FILE_MAX_HISTORY=30
LOG_LEVEL_BINDER=WARN
LOG_LEVEL_SPRING_SECURITY=WARN
LOG_PATTERN_CONSOLE="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
LOG_PATTERN_FILE="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
LOG_DIR=/var/log/campus-marketplace
LOG_FILE_BASENAME=app
LOGBACK_PATTERN=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50}:%line - %msg%n
LOGBACK_PATTERN_COLOR=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50}:%line - %msg%n
SLOW_QUERY_LOG_MAX_HISTORY=14

# ==================== Actuator & 文档开关 ====================
ACTUATOR_ENDPOINTS=health,info,metrics,loggers
ACTUATOR_HEALTH_SHOW_DETAILS=when-authorized
ACTUATOR_BASE_PATH=/actuator
ACTUATOR_EXCLUDE=shutdown
PROMETHEUS_ENABLED=true
METRICS_HTTP_HISTOGRAM=true
TRACING_PROBABILITY=0.1
SPRINGDOC_ENABLED=false
SWAGGER_UI_ENABLED=false

# ==================== 调试开关 ====================
DEBUG_ENABLED=false
DEBUG_SHOW_ERROR_DETAILS=false

# ==================== Tomcat 线程池 ====================
TOMCAT_MAX_THREADS=400
TOMCAT_MIN_SPARE_THREADS=50

# ==================== JWT 头部配置 ====================
JWT_HEADER=Authorization
JWT_PREFIX="Bearer "

# ==================== Alipay 附加参数 ====================
ALIPAY_FORMAT=json
ALIPAY_SIGN_TYPE=RSA2
ALIPAY_CHARSET=UTF-8

# ==================== 静态资源配置 ====================
# 🎯 生产环境强烈推荐使用 CDN 或对象存储服务（OSS/COS/Kodo）
# 静态资源基础 URL（推荐使用 CDN 域名）
# 示例: https://cdn.campus-marketplace.com 或 https://oss.campus-marketplace.com
STATIC_RESOURCE_BASE_URL=https://cdn.your-domain.com
# 商品图片上传目录（推荐使用对象存储）
GOODS_IMAGE_UPLOAD_DIR=/app/uploads/goods
# 用户头像上传目录
USER_AVATAR_UPLOAD_DIR=/app/uploads/avatars
# 允许的图片格式
IMAGE_ALLOWED_EXTENSIONS=jpg,jpeg,png,gif,webp
# 单张图片最大尺寸（字节，10MB）
IMAGE_MAX_SIZE=10485760
# 商品图片最大数量
GOODS_MAX_IMAGES=9
