# 前端项目开发策略（2025-10-31）

## 1. 总体目标
- 以 Monorepo 为核心，先夯实公共层能力，再分阶段交付 Portal 与 Admin。
- 每个阶段都要产出可运行的增量版本，并保持 `pnpm -r lint`、`pnpm -r type-check`、`pnpm run build:all` 全绿。
- 与后端保持 API 契约同步，所有接口变更必须触发一次 `pnpm run api:generate` 与回归测试。

## 2. 工作优先级与节奏
| 顺序 | 时间窗口 | 重点 | 产出 | 责任人（建议） |
| ---- | -------- | ---- | ---- | ------------- |
| ① | 2025-11-01 ~ 2025-11-10 | shared 能力补强 | 组件/Hook/服务完善、Story Demo、单测 ≥ 40% | 前端核心小组 |
| ② | 2025-11-11 ~ 2025-12-05 | Portal MVP | 认证、商品、订单、消息、社区闭环；页面均接入真实接口 | Portal 小组 |
| ③ | 2025-12-06 ~ 2026-01-05 | Admin MVP | 仪表盘、审核工作台、用户与限流管理、配置中心 | Admin 小组 |
| ④ | 2026-01-06 ~ 2026-01-20 | 自动化 + 性能 | E2E、可访问性、性能调优、监控埋点 | 全体协作 |

> 若人力不足，可在阶段内按「共享层 → Portal → Admin」优先级调整迭代节奏。

## 3. 公共层（@campus/shared）任务清单
- ✅ 整理组件文档：为每个组件补充最小用例与 Prop 注释。
- ✅ 增强 HTTP 拦截器：统一错误码到中文提示，区分 401/403/429。
- ✅ 完善 `services/*`：遵循“请求 + DTO + 错误处理 + 缓存 key”惯例；所有函数都返回 `Promise<ApiResponseData>`。
- ✅ Hook 规范：`useXxx` 均暴露 loading/error 状态，必要时支持取消请求。
- ✅ 添加单元测试：组件使用 React Testing Library，服务使用 MSW 模拟接口。
- ✅ 输出 Storybook（可选）：集合组件文档，便于 Admin/Portal 复用。

## 4. Portal 开发策略
### 4.1 页面优先级
1. **认证模块**：登录、注册、忘记密码、Token 自动续期；完成后才开放后续页面。
2. **商品模块**：首页（列表/筛选）、详情、发布、收藏；数据依赖 `goodsService`、`favoriteService`。
3. **订单与支付**：订单列表、详情、支付状态轮询、退款申请。
4. **消息/通知**：会话列表、消息气泡、实时推送、已读管理。
5. **社区**：帖子列表、详情、评论、点赞；使用 `postService`、`replyService`。
6. **个人中心**：资料、密码、安全设置、订阅管理。

### 4.2 技术约束
- 路由：所有需要登录的页面通过 `RequireAuth` 守卫。
- 状态：除特定表单外禁止在组件内自建全局状态，统一使用 shared Hook 或 store。
- UI：尽量复用 shared 组件（Button、Form、ImageUpload、Toast 等），Tailwind 仅用于布局与少量修饰。
- 测试：关键流程编写 React Testing Library + MSW 单测，PR 必须附带可运行的演示截图或录屏。

## 5. Admin 开发策略
### 5.1 模块路线图
1. **基础框架**：接入 Ant Design 布局、菜单、面包屑；实现登录守卫、动态路由。
2. **仪表盘**：调用统计类接口，绘制折线/柱状图（AntD Charts 或 ECharts）。
3. **审核中心**：商品、帖子、举报处理；封装表格筛选 + 批量操作；支持权限控制。
4. **用户与权限**：用户列表、详情、封禁/解禁、角色授权。
5. **风控配置**：限流规则、黑白名单、校园与分类管理。
6. **通知模板**：模板 CRUD、测试发送。

### 5.2 复用原则
- 表格、弹窗、表单尽量来自 shared（如 Table、Modal、Form 组件）。
- 所有操作调用 `services/*`，统一错误提示与 Loading。
- 高级权限页面在路由层做 `hasAuthority` 验证（结合后端 `PermissionCodes`）。

## 6. 协作与代码规范
- 使用 Git 分支策略：`feature/<module>`，合并前必须通过 CI（lint + type-check + build）。
- PR 模板建议包含：变更摘要、影响范围、测试方式、截图/录屏、关联 Backlog。
- 代码评审关注点：组件复用情况、错误处理完整性、可测试性、国际化与辅助功能。
- 文档同步：完成功能后更新 `docs/前端Monorepo架构搭建完成报告.md` 与相关模块 README。

## 7. 验收标准
- Shared：所有导出在 `index.ts` 有文档注释；至少 40% 单测覆盖率。
- Portal：MVP 页面均可通过真实接口完成核心流程；Lighthouse 性能 > 85，PWA 指标可选。
- Admin：高优先级模块具备数据展示、查询、变更能力；关键操作有二次确认与权限校验。
- 自动化：E2E 测试覆盖登录、下单、审核三个场景；CI 集成。

## 8. 建议的每日例会输出
- 昨日完成、今日计划、阻塞项。
- API 变更提前通知共享层负责人。
- 每周至少一次合并 main 并执行 `pnpm run build:all`，确认产物可部署。

> 按上述策略推进，可确保共享层 → Portal → Admin 的逐步交付，同时让自动化与质量建设伴随整个生命周期。
