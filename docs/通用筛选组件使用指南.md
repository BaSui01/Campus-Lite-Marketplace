# é€šç”¨ç­›é€‰ç»„ä»¶ä½¿ç”¨æŒ‡å—

> **ä½œè€…**: BaSui ğŸ˜ | **æ›´æ–°**: 2025-11-10

---

## ğŸ¯ æ¦‚è¿°

é€šç”¨ç­›é€‰ç»„ä»¶æä¾›äº†ä¸€å¥—å®Œæ•´çš„å‰åç«¯ç­›é€‰è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§ç­›é€‰ç±»å‹ï¼Œå¯åœ¨æ‰€æœ‰åˆ—è¡¨é¡µé¢å¤ç”¨ã€‚

### âœ¨ ç‰¹æ€§

- âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… **é«˜åº¦å¯é…ç½®**ï¼šæ”¯æŒ 8 ç§ç­›é€‰ç±»å‹
- âœ… **å‰åç«¯ç»Ÿä¸€**ï¼šç»Ÿä¸€çš„å‚æ•°å‘½åè§„èŒƒ
- âœ… **æ˜“äºå¤ç”¨**ï¼šä¸€æ¬¡é…ç½®ï¼Œå¤šå¤„ä½¿ç”¨
- âœ… **å“åº”å¼å¸ƒå±€**ï¼šè‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸

---

## ğŸ“¦ åç«¯ä½¿ç”¨

### 1. åˆ›å»ºç­›é€‰è¯·æ±‚ç±»

æ‰€æœ‰ç­›é€‰è¯·æ±‚ç±»éƒ½åº”ç»§æ‰¿ `BaseFilterRequest`ï¼š

```java
package com.campus.marketplace.common.dto.request;

import com.campus.marketplace.common.enums.OrderStatus;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.SuperBuilder;

/**
 * è®¢å•ç­›é€‰è¯·æ±‚å‚æ•°
 */
@Data
@SuperBuilder
@EqualsAndHashCode(callSuper = true)
public class OrderFilterRequest extends BaseFilterRequest {

    /**
     * è®¢å•çŠ¶æ€
     */
    private OrderStatus status;

    /**
     * ä¹°å®¶ ID
     */
    private Long buyerId;

    /**
     * å–å®¶ ID
     */
    private Long sellerId;

    /**
     * æœ€ä½é‡‘é¢
     */
    private BigDecimal minAmount;

    /**
     * æœ€é«˜é‡‘é¢
     */
    private BigDecimal maxAmount;
}
```

### 2. åœ¨ Controller ä¸­ä½¿ç”¨

```java
@RestController
@RequestMapping("/api/orders")
public class OrderController {

    @GetMapping
    @Operation(summary = "æŸ¥è¯¢è®¢å•åˆ—è¡¨")
    public ApiResponse<Page<OrderResponse>> listOrders(OrderFilterRequest request) {
        Page<OrderResponse> result = orderService.listOrders(request);
        return ApiResponse.success(result);
    }
}
```

### 3. åœ¨ Service ä¸­å®ç°

```java
@Service
public class OrderServiceImpl implements OrderService {

    @Override
    public Page<OrderResponse> listOrders(OrderFilterRequest request) {
        // æ„å»ºåˆ†é¡µå‚æ•°
        Sort.Direction direction = "ASC".equalsIgnoreCase(request.getSortDirectionOrDefault())
                ? Sort.Direction.ASC
                : Sort.Direction.DESC;

        Pageable pageable = PageRequest.of(
                request.getPageOrDefault(),
                request.getSizeOrDefault(),
                Sort.by(direction, request.getSortByOrDefault())
        );

        // æŸ¥è¯¢æ•°æ®
        Page<Order> orderPage = orderRepository.findByConditions(
                request.getKeyword(),
                request.getStatus(),
                request.getBuyerId(),
                request.getSellerId(),
                request.getMinAmount(),
                request.getMaxAmount(),
                pageable
        );

        return orderPage.map(this::convertToResponse);
    }
}
```

---

## ğŸ¨ å‰ç«¯ä½¿ç”¨

### 1. å®šä¹‰ç­›é€‰é…ç½®

```typescript
import { FilterConfig } from '@campus/shared/components/FilterPanel';
import { GOODS_STATUS_OPTIONS } from '@campus/shared/constants';

// å•†å“ç­›é€‰é…ç½®
const goodsFilters: FilterConfig[] = [
  {
    type: 'input',
    field: 'keyword',
    label: 'å…³é”®è¯',
    placeholder: 'æœç´¢å•†å“æ ‡é¢˜æˆ–æè¿°',
    width: 200,
  },
  {
    type: 'select',
    field: 'categoryId',
    label: 'åˆ†ç±»',
    placeholder: 'é€‰æ‹©åˆ†ç±»',
    options: categories, // ä» API è·å–
    width: 150,
  },
  {
    type: 'numberRange',
    field: 'price',
    label: 'ä»·æ ¼åŒºé—´',
    prefix: 'Â¥',
    min: 0,
  },
  {
    type: 'select',
    field: 'status',
    label: 'çŠ¶æ€',
    placeholder: 'é€‰æ‹©çŠ¶æ€',
    options: GOODS_STATUS_OPTIONS,
    width: 120,
  },
];
```

### 2. ä½¿ç”¨ç­›é€‰é¢æ¿

```typescript
import { useState } from 'react';
import { FilterPanel, FilterValues } from '@campus/shared/components/FilterPanel';
import { useQuery } from '@tanstack/react-query';
import { goodsService } from '@campus/shared/services/goods';

export const GoodsList: React.FC = () => {
  // ç­›é€‰å€¼çŠ¶æ€
  const [filterValues, setFilterValues] = useState<FilterValues>({
    keyword: '',
    categoryId: undefined,
    price: { min: undefined, max: undefined },
    status: undefined,
  });

  // æŸ¥è¯¢å•†å“åˆ—è¡¨
  const { data, isLoading, refetch } = useQuery({
    queryKey: ['goods', 'list', filterValues],
    queryFn: () =>
      goodsService.listGoods({
        keyword: filterValues.keyword,
        categoryId: filterValues.categoryId,
        minPrice: filterValues.price?.min,
        maxPrice: filterValues.price?.max,
        status: filterValues.status,
        page: 0,
        size: 20,
        sortBy: 'createdAt',
        sortDirection: 'DESC',
      }),
  });

  // å¤„ç†æœç´¢
  const handleSearch = () => {
    refetch();
  };

  // å¤„ç†é‡ç½®
  const handleReset = () => {
    setFilterValues({
      keyword: '',
      categoryId: undefined,
      price: { min: undefined, max: undefined },
      status: undefined,
    });
  };

  return (
    <div>
      {/* ç­›é€‰é¢æ¿ */}
      <FilterPanel
        config={{ filters: goodsFilters }}
        values={filterValues}
        onChange={setFilterValues}
        onSearch={handleSearch}
        onReset={handleReset}
      />

      {/* æ•°æ®è¡¨æ ¼ */}
      <Table
        dataSource={data?.content}
        loading={isLoading}
        // ... å…¶ä»–é…ç½®
      />
    </div>
  );
};
```

---

## ğŸ”§ æ”¯æŒçš„ç­›é€‰ç±»å‹

### 1. input - æ–‡æœ¬è¾“å…¥

```typescript
{
  type: 'input',
  field: 'keyword',
  label: 'å…³é”®è¯',
  placeholder: 'æœç´¢...',
  width: 200,
}
```

### 2. select - ä¸‹æ‹‰é€‰æ‹©

```typescript
{
  type: 'select',
  field: 'status',
  label: 'çŠ¶æ€',
  placeholder: 'é€‰æ‹©çŠ¶æ€',
  options: [
    { label: 'å¾…å®¡æ ¸', value: 'PENDING' },
    { label: 'å·²ä¸Šæ¶', value: 'APPROVED' },
    { label: 'å·²ä¸‹æ¶', value: 'REJECTED' },
  ],
  width: 120,
}
```

### 3. multiSelect - å¤šé€‰ä¸‹æ‹‰

```typescript
{
  type: 'multiSelect',
  field: 'tags',
  label: 'æ ‡ç­¾',
  placeholder: 'é€‰æ‹©æ ‡ç­¾',
  options: tagOptions,
  width: 200,
}
```

### 4. numberRange - æ•°å­—èŒƒå›´

```typescript
{
  type: 'numberRange',
  field: 'price',
  label: 'ä»·æ ¼åŒºé—´',
  prefix: 'Â¥',
  min: 0,
  max: 99999,
  step: 1,
}
```

### 5. dateRange - æ—¥æœŸèŒƒå›´

```typescript
{
  type: 'dateRange',
  field: 'date',
  label: 'æ—¥æœŸèŒƒå›´',
  format: 'YYYY-MM-DD',
  showTime: false,
}
```

### 6. cascader - çº§è”é€‰æ‹©

```typescript
{
  type: 'cascader',
  field: 'category',
  label: 'åˆ†ç±»',
  placeholder: 'é€‰æ‹©åˆ†ç±»',
  options: categoryTree,
}
```

### 7. radio - å•é€‰æŒ‰é’®

```typescript
{
  type: 'radio',
  field: 'type',
  label: 'ç±»å‹',
  options: [
    { label: 'å…¨éƒ¨', value: 'all' },
    { label: 'æ–°å“', value: 'new' },
    { label: 'äºŒæ‰‹', value: 'used' },
  ],
}
```

### 8. checkbox - å¤é€‰æ¡†

```typescript
{
  type: 'checkbox',
  field: 'features',
  label: 'ç‰¹æ€§',
  options: [
    { label: 'åŒ…é‚®', value: 'free_shipping' },
    { label: 'å¯è®®ä»·', value: 'negotiable' },
    { label: 'æ”¯æŒé€€æ¢', value: 'returnable' },
  ],
}
```

---

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹

### å•†å“åˆ—è¡¨é¡µé¢

```typescript
import { useState } from 'react';
import { Table, Button, Space } from 'antd';
import { PlusOutlined } from '@ant-design/icons';
import { FilterPanel, FilterConfig, FilterValues } from '@campus/shared/components/FilterPanel';
import { GOODS_STATUS_OPTIONS } from '@campus/shared/constants';
import { useQuery } from '@tanstack/react-query';
import { goodsService } from '@campus/shared/services/goods';

export const GoodsList: React.FC = () => {
  // ç­›é€‰é…ç½®
  const filters: FilterConfig[] = [
    {
      type: 'input',
      field: 'keyword',
      label: 'å…³é”®è¯',
      placeholder: 'æœç´¢å•†å“æ ‡é¢˜æˆ–æè¿°',
      width: 200,
    },
    {
      type: 'select',
      field: 'categoryId',
      label: 'åˆ†ç±»',
      placeholder: 'é€‰æ‹©åˆ†ç±»',
      options: [], // ä» API è·å–
      width: 150,
    },
    {
      type: 'numberRange',
      field: 'price',
      label: 'ä»·æ ¼åŒºé—´',
      prefix: 'Â¥',
      min: 0,
    },
    {
      type: 'select',
      field: 'status',
      label: 'çŠ¶æ€',
      placeholder: 'é€‰æ‹©çŠ¶æ€',
      options: GOODS_STATUS_OPTIONS,
      width: 120,
    },
  ];

  // ç­›é€‰å€¼
  const [filterValues, setFilterValues] = useState<FilterValues>({});

  // æŸ¥è¯¢æ•°æ®
  const { data, isLoading, refetch } = useQuery({
    queryKey: ['goods', 'list', filterValues],
    queryFn: () =>
      goodsService.listGoods({
        ...filterValues,
        minPrice: filterValues.price?.min,
        maxPrice: filterValues.price?.max,
      }),
  });

  return (
    <div>
      {/* ç­›é€‰é¢æ¿ */}
      <FilterPanel
        config={{ filters }}
        values={filterValues}
        onChange={setFilterValues}
        onSearch={refetch}
        onReset={() => setFilterValues({})}
      />

      {/* æ“ä½œæŒ‰é’® */}
      <Space style={{ marginBottom: 16 }}>
        <Button type="primary" icon={<PlusOutlined />}>
          æ–°å¢å•†å“
        </Button>
      </Space>

      {/* æ•°æ®è¡¨æ ¼ */}
      <Table
        dataSource={data?.content}
        loading={isLoading}
        rowKey="id"
        pagination={{
          total: data?.totalElements,
          pageSize: 20,
        }}
      />
    </div>
  );
};
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€å‚æ•°å‘½å

**åç«¯å‚æ•°å‘½åè§„èŒƒ**ï¼š
- `keyword`: å…³é”®è¯æœç´¢
- `status`: çŠ¶æ€ç­›é€‰
- `categoryId`: åˆ†ç±»ç­›é€‰
- `minXxx/maxXxx`: èŒƒå›´ç­›é€‰
- `xxxIds`: å¤šé€‰ç­›é€‰
- `page/size`: åˆ†é¡µå‚æ•°
- `sortBy/sortDirection`: æ’åºå‚æ•°

### 2. ä½¿ç”¨ React Query ç¼“å­˜

```typescript
const { data } = useQuery({
  queryKey: ['goods', 'list', filterValues],
  queryFn: () => goodsService.listGoods(filterValues),
  staleTime: 5 * 60 * 1000, // ç¼“å­˜ 5 åˆ†é’Ÿ
});
```

### 3. è‡ªåŠ¨æœç´¢ vs æ‰‹åŠ¨æœç´¢

```typescript
// è‡ªåŠ¨æœç´¢ï¼ˆå€¼å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘ï¼‰
<FilterPanel
  config={{ filters, autoSearch: true }}
  values={filterValues}
  onChange={(values) => {
    setFilterValues(values);
    refetch(); // è‡ªåŠ¨è§¦å‘æœç´¢
  }}
/>

// æ‰‹åŠ¨æœç´¢ï¼ˆç‚¹å‡»æŒ‰é’®è§¦å‘ï¼‰
<FilterPanel
  config={{ filters, autoSearch: false }}
  values={filterValues}
  onChange={setFilterValues}
  onSearch={refetch}
/>
```

### 4. å¤„ç†å¤æ‚ç­›é€‰å€¼

```typescript
// numberRange ç±»å‹
const handleSearch = () => {
  goodsService.listGoods({
    minPrice: filterValues.price?.min,
    maxPrice: filterValues.price?.max,
  });
};

// dateRange ç±»å‹
const handleSearch = () => {
  goodsService.listOrders({
    startDate: filterValues.date?.[0],
    endDate: filterValues.date?.[1],
  });
};
```

---

## ğŸš€ æ‰©å±•æŒ‡å—

### è‡ªå®šä¹‰ç­›é€‰å­—æ®µ

å¦‚æœå†…ç½®çš„ç­›é€‰ç±»å‹ä¸æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ `render` å±æ€§è‡ªå®šä¹‰æ¸²æŸ“ï¼š

```typescript
{
  type: 'input', // ç±»å‹å¯ä»¥éšæ„ï¼Œå› ä¸ºä¼šè¢« render è¦†ç›–
  field: 'custom',
  label: 'è‡ªå®šä¹‰å­—æ®µ',
  render: (value, onChange) => (
    <YourCustomComponent
      value={value}
      onChange={onChange}
    />
  ),
}
```

---

## ğŸ“ æ€»ç»“

é€šç”¨ç­›é€‰ç»„ä»¶æä¾›äº†ä¸€å¥—å®Œæ•´çš„å‰åç«¯ç­›é€‰è§£å†³æ–¹æ¡ˆï¼š

âœ… **åç«¯**ï¼š`BaseFilterRequest` åŸºç±» + å…·ä½“ç­›é€‰è¯·æ±‚ç±»
âœ… **å‰ç«¯**ï¼š`FilterPanel` ç»„ä»¶ + `FilterConfig` é…ç½®
âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
âœ… **æ˜“äºå¤ç”¨**ï¼šä¸€æ¬¡é…ç½®ï¼Œå¤šå¤„ä½¿ç”¨

ç°åœ¨ä½ å¯ä»¥åœ¨æ‰€æœ‰åˆ—è¡¨é¡µé¢ï¼ˆå•†å“ã€è®¢å•ã€ç”¨æˆ·ç­‰ï¼‰å¤ç”¨è¿™å¥—ç­›é€‰æ–¹æ¡ˆäº†ï¼ğŸ‰

---

**BaSui çš„æœ€åå®å˜±**ï¼š
> ç»Ÿä¸€çš„ç­›é€‰è§„èŒƒæ˜¯æé«˜å¼€å‘æ•ˆç‡çš„å…³é”®ï¼
> å‰åç«¯å‚æ•°å‘½åä¿æŒä¸€è‡´ï¼Œé¿å…æ··ä¹±ï¼
> å–„ç”¨ React Query ç¼“å­˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼ğŸ’ªğŸ˜
