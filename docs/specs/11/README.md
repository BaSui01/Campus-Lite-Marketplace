# Spec #11: 前端门户增强开发 - 文档索引

> **创建日期**: 2025-11-06  
> **负责人**: BaSui 😎  
> **完成日期**: 2025-11-06  
> **状态**: ✅ 100%完成（10/10任务）

---

## 📚 文档清单

| 文档 | 说明 | 状态 |
|------|------|------|
| [requirements.md](./requirements.md) | 功能需求文档 | ✅ 已完成 |
| [design.md](./design.md) | 技术设计文档 | ✅ 已完成 |
| [tasks.md](./tasks.md) | 任务分解文档 | ✅ 已完成 |
| [SPEC_11_SUMMARY.md](../../SPEC_11_SUMMARY.md) | Spec #11 完成总结 | ✅ 已完成 |

---

## 🎯 Spec 概览

### 背景
前端用户门户(Portal)已实现核心交易流程,但接口覆盖率仅约 **40%**。本 Spec 基于 **Shared层22个组件**,规划门户功能的增强开发,**最大化组件复用率(≥90%)**。

### 目标
1. **提升接口覆盖率**: 40% → 85%+ (新增对接 ~87个接口)
2. **最大化组件复用**: 复用Shared层组件,避免重复造轮子
3. **补全核心功能**: 评价、物流、纠纷、社交、推荐
4. **统一代码风格**: 与Admin包保持一致

### 关键数据
- **后端门户接口**: 145个 (不含管理接口40个)
- **已实现接口**: ~58个 (40%覆盖)
- **Shared层组件**: 22个已有 + 3个新增
- **新增服务文件**: 14个
- **新增页面**: 15-20个
- **预计工期**: 6-8周
- **总任务数**: 58个
- **预计工时**: 295小时

---

## 📋 需求文档 (requirements.md)

### 内容结构
1. **需求概述**: 背景、目标、影响范围
2. **Shared层组件盘点**: 22个已有组件 + 3个新增组件
3. **功能需求(按优先级)**:
   - 🔴 P0: 评价系统、物流信息、推荐系统
   - 🟡 P1: 纠纷处理、黑名单、申诉
   - 🟢 P2: 社交功能、隐私合规、通知偏好
   - 🔵 P3: 商品批量操作、订阅管理
4. **组件新增与优化**: 详细设计3个新增组件
5. **技术实现方案**: 服务层架构、状态管理
6. **验收标准**: 功能、性能、测试要求
7. **开发计划**: 4个迭代(每个2周)

### 核心亮点
✅ **每个功能都明确标注复用组件**,开发时一目了然  
✅ **强制组件复用率 ≥90%**,避免重复造轮子  
✅ **服务层按模块重组**,代码结构清晰  

---

## 🏗️ 设计文档 (design.md)

### 内容结构
1. **架构设计**: 整体架构图、技术栈、目录结构
2. **组件设计**: 3个新增组件详细设计
   - StarRating - 星级评分组件
   - Timeline - 时间轴组件
   - FileUploader - 文件上传组件
3. **服务层设计**: 14个新增服务文件架构
4. **状态管理设计**: 4个新增Zustand Store
5. **路由设计**: 新增15+路由配置
6. **数据流设计**: 评价/纠纷数据流图
7. **性能优化设计**: 代码分割、图片优化、缓存策略
8. **错误处理设计**: 全局/组件/网络错误处理

### 技术亮点
✅ **详细的接口设计**: 每个组件/服务都有完整的TypeScript接口  
✅ **数据流可视化**: 清晰展示用户操作到后端API的完整流程  
✅ **性能优化方案**: 代码分割、图片懒加载、列表虚拟化  

---

## 📋 任务文档 (tasks.md)

### 内容结构
1. **任务概览**: 58个任务,295小时,4个迭代
2. **迭代1: 评价与物流** (Week 1-2)
   - 15个任务,80小时
   - StarRating/Timeline组件
   - 评价系统完整实现
   - 物流信息集成
   - 推荐功能上线
3. **迭代2: 纠纷与黑名单** (Week 3-4)
   - 17个任务,85小时
   - FileUploader组件
   - 纠纷处理完整流程
   - 黑名单管理
   - 申诉系统
4. **迭代3: 社交功能** (Week 5-6)
   - 14个任务,70小时
   - 回复/话题/关注
   - 隐私合规
   - 通知偏好
5. **迭代4: 优化与补充** (Week 7-8)
   - 12个任务,60小时
   - 商品批量操作
   - 全面测试与优化

### 任务特点
✅ **任务颗粒度合理**: 每个任务2-12小时,易于跟踪  
✅ **子任务详细**: 每个任务都有详细子任务分解  
✅ **依赖关系明确**: 标注前置任务依赖  
✅ **验收标准清晰**: 每个任务都有明确的完成标准  
✅ **里程碑检查**: 4个里程碑,每个都有详细检查清单  

---

## 🚀 快速开始

### 1. 评审阶段
```bash
# 1. 阅读需求文档
cat docs/specs/11/requirements.md

# 2. 阅读设计文档
cat docs/specs/11/design.md

# 3. 阅读任务文档
cat docs/specs/11/tasks.md

# 4. 团队评审会议
# - 确认优先级
# - 分配负责人
# - 调整预估工时
```

### 2. 开发阶段(迭代1示例)

#### Week 1 Day 1-2: 组件开发
```bash
# Task 1.1: StarRating 组件
cd frontend/packages/shared/src/components
mkdir StarRating
# 参考 design.md 中的接口设计实现

# Task 1.2: Timeline 组件
mkdir Timeline
# 参考 design.md 中的接口设计实现
```

#### Week 1 Day 3-4: 服务层开发
```bash
# Task 1.3: Review 服务层
cd frontend/packages/shared/src/services/goods
touch review.ts
# 参考 design.md 中的服务层设计实现

# Task 1.4: useReviewStore
cd frontend/packages/portal/src/store
touch useReviewStore.ts
# 参考 design.md 中的状态管理设计实现
```

#### Week 1 Day 5 ~ Week 2: 页面开发
```bash
# Task 1.5: 评价发布页
cd frontend/packages/portal/src/pages
mkdir Review
touch Review/Create.tsx

# Task 1.6: 商品详情页集成评价
# 修改 pages/GoodsDetail/index.tsx

# Task 1.7: 我的评价页
touch Review/MyReviews.tsx
```

#### Week 2 末: 测试与审查
```bash
# Task 1.14: 集成测试
npm run test:e2e

# Task 1.15: 文档与代码审查
npm run lint
npm run test:coverage
```

### 3. 质量检查

#### 组件复用率检查
```bash
# 使用 grep 检查是否有重复组件
grep -r "const Button" frontend/packages/portal/src/components/
# 应该为空,所有Button应该从shared导入
```

#### 测试覆盖率检查
```bash
# 运行覆盖率测试
npm run test:coverage

# 要求:
# - 组件测试 ≥70%
# - 服务层测试 ≥85%
# - Hooks测试 ≥80%
```

#### 性能检查
```bash
# Lighthouse 评分
npm run build
# 使用Chrome DevTools Lighthouse运行
# 要求: Performance ≥90, Accessibility ≥90
```

---

## 📊 项目管理

### 进度跟踪
- **每日站会**: 更新任务状态(待开始/进行中/已完成/阻塞)
- **每周总结**: 更新里程碑完成情况
- **迭代回顾**: 每2周一次迭代回顾会议

### 风险管理
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 组件复用率不达标 | Medium | 代码审查严格检查 |
| 后端接口不稳定 | High | 提前联调,Mock兜底 |
| 工期延误 | Medium | 预留buffer,关键路径监控 |

### 质量保证
- ✅ **代码审查**: 每个PR必须经过审查
- ✅ **自动化测试**: CI/CD自动运行测试
- ✅ **性能监控**: 定期Lighthouse评分
- ✅ **用户反馈**: 灰度发布,收集反馈

---

## 🎯 里程碑

### M1: 评价与物流 (Week 2)
**目标**: 实现评价系统和物流信息集成  
**产出**: 
- StarRating 组件
- Timeline 组件
- 评价发布/展示/互动功能
- 物流信息展示
- 推荐功能

**验收**:
- ✅ 可发布评价(星级+文字+图片)
- ✅ 商品详情页显示评价列表
- ✅ 订单详情页显示物流信息
- ✅ 首页显示推荐商品
- ✅ 测试覆盖率 ≥85%
- ✅ 组件复用率 ≥90%

---

### M2: 纠纷与黑名单 (Week 4)
**目标**: 实现纠纷处理和黑名单管理  
**产出**:
- FileUploader 组件
- 纠纷列表/详情/协商页
- 黑名单管理页
- 申诉列表/创建/详情页

**验收**:
- ✅ 可发起纠纷并协商
- ✅ 可上传证据材料
- ✅ 可拉黑/解除拉黑用户
- ✅ 可提交申诉
- ✅ 测试覆盖率 ≥85%

---

### M3: 社交与隐私 (Week 6)
**目标**: 完善社交功能和隐私合规  
**产出**:
- 回复管理功能
- 话题详情/关注功能
- 用户关注/粉丝列表
- 隐私设置页
- 通知偏好设置

**验收**:
- ✅ 可发布/查看回复
- ✅ 可关注话题
- ✅ 可关注用户
- ✅ 可导出数据/注销账号
- ✅ 可设置通知偏好

---

### M4: 全功能完成 (Week 8)
**目标**: 完成所有功能并优化  
**产出**:
- 商品批量操作
- 订阅管理增强
- 全面测试报告
- 性能优化报告
- 完整文档

**验收**:
- ✅ 接口覆盖率 ≥85%
- ✅ 组件复用率 ≥90%
- ✅ 测试覆盖率 ≥85%
- ✅ Lighthouse 评分 ≥90
- ✅ 无P0/P1级别Bug

---

## 📚 参考资料

### 全局规范
- [docs/specs/tech.md](../tech.md) - 技术栈规范
- [docs/specs/structure.md](../structure.md) - 项目结构规范
- [CLAUDE.md](../../../CLAUDE.md) - AI开发规范

### 相关文档
- [docs/API_INTERFACE_CLASSIFICATION.md](../../API_INTERFACE_CLASSIFICATION.md) - 接口分类清单
- [docs/PORTAL_COVERAGE_ANALYSIS.md](../../PORTAL_COVERAGE_ANALYSIS.md) - 覆盖度分析
- [docs/PORTAL_TODO_CHECKLIST.md](../../PORTAL_TODO_CHECKLIST.md) - 任务清单

### Specs 9 & 10
- [docs/specs/9/requirements.md](../9/requirements.md) - 管理端开发需求
- [docs/specs/10/requirements.md](../10/requirements.md) - 门户功能需求(旧版)

---

## 🤝 贡献指南

### 任务认领
1. 在 tasks.md 中找到待认领任务
2. 在任务后标注姓名: `[负责人: 张三]`
3. 更新任务状态为 `[In Progress]`

### 完成任务
1. 完成所有子任务
2. 通过验收标准检查
3. 更新任务状态为 `[✓]`
4. 标注完成日期: `[完成: 2025-11-10]`

### 遇到阻塞
1. 更新任务状态为 `[Blocked]`
2. 添加阻塞原因: `[原因: 等待后端接口]`
3. 及时沟通寻求帮助

---

## ❓ FAQ

### Q1: 为什么要强制组件复用率 ≥90%?
**A**: 避免重复造轮子,保持代码一致性,降低维护成本。Shared层已有22个组件,应该优先复用。

### Q2: 如何计算组件复用率?
**A**: 复用率 = (使用Shared组件的地方数 / 总组件使用数) × 100%

### Q3: 新增组件应该放在哪里?
**A**: 
- 通用组件(Portal和Admin都用) → `shared/src/components`
- Portal专属组件 → `portal/src/components`

### Q4: 服务层为什么要按模块重组?
**A**: 提高代码可维护性,避免单文件过大,方便团队协作。

### Q5: 工时估算是否准确?
**A**: 工时估算基于标准工作效率,实际可能上下浮动20%。如有偏差及时调整。

---

**文档维护**: 每周更新一次  
**最后更新**: 2025-11-06  
**下一次更新**: 2025-11-13 (任务认领完成后)
