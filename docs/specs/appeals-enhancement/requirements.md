# ⚖️ 申诉管理模块高级功能需求文档

> **作者**: BaSui 😎
> **创建日期**: 2025-11-07
> **状态**: 📝 需求定义完成
> **优先级**: P1（高优先级）

---

## 📋 功能概述

基于现有Appeals模块基础功能，添加高级用户体验功能，提升申诉处理效率和用户满意度。

### 🎯 业务目标
- 提高申诉材料上传的便利性和可靠性
- 增强申诉进度的可视化展示
- 实现实时状态通知和提醒
- 提供申诉历史数据分析

### 👥 目标用户
- **普通用户**: 需要提交申诉查看进度的用户
- **管理员**: 处理申诉的后台管理人员

---

## 🚀 核心功能需求

### 1. 📎 材料上传功能增强（Material Upload Enhancement）

#### 1.1 当前状态分析
- ✅ **已实现**: 基础URL添加功能（手动输入URL）
- ❌ **缺失**: 真实的文件上传、预览、验证功能

#### 1.2 需求描述
用户需要能够：
- 直接上传本地文件（图片、PDF、文档等）
- 预览上传的文件内容
- 验证文件格式和大小限制
- 拖拽上传支持
- 上传进度显示

#### 1.3 验收标准
- [ ] 支持图片格式：JPG、PNG、GIF、WebP（最大10MB）
- [ ] 支持文档格式：PDF、DOC、DOCX（最大20MB）
- [ ] 支持多文件同时上传（最多5个文件）
- [ ] 提供文件预览功能（图片直接预览，PDF在线预览）
- [ ] 拖拽上传区域支持
- [ ] 上传进度条显示
- [ ] 文件格式和大小验证
- [ ] 上传失败重试机制

### 2. 📊 申诉进度时间轴可视化（Progress Timeline Visualization）

#### 2.1 当前状态分析
- ✅ **已实现**: 基础状态显示（待处理、审核中、已通过等）
- ❌ **缺失**: 详细的时间轴、处理记录、操作日志

#### 2.2 需求描述
用户需要能够：
- 查看申诉的完整处理时间轴
- 了解每个处理阶段的详细信息
- 查看管理员处理记录和意见
- 预估剩余处理时间

#### 2.3 验收标准
- [ ] 时间轴显示申诉关键节点（提交、审核、决定等）
- [ ] 每个节点显示时间、操作人、操作内容
- [ ] 状态变更的详细描述
- [ ] 管理员处理意见展示
- [ ] 预计完成时间显示
- [ ] 时间轴可交互（点击查看详情）

### 3. 🔔 实时状态通知系统（Real-time Notification System）

#### 3.1 当前状态分析
- ❌ **完全缺失**: 无任何通知功能
- ✅ **技术基础**: 项目已集成WebSocket和通知系统

#### 3.2 需求描述
用户需要能够：
- 接收申诉状态变更的实时通知
- 通过多种渠道收到提醒（页面内、系统通知）
- 查看历史通知记录
- 自定义通知偏好设置

#### 3.3 验收标准
- [ ] 申诉状态变更时实时推送通知
- [ ] 页面内通知弹窗显示
- [ ] 浏览器原生通知支持
- [ ] 通知中心页面（查看历史通知）
- [ ] 通知偏好设置（免打扰时间、通知类型等）
- [ ] 通知已读/未读状态管理
- [ ] 批量操作（全部标记为已读等）

### 4. 📈 申诉数据分析仪表板（Appeal Analytics Dashboard）

#### 4.1 当前状态分析
- ❌ **完全缺失**: 无数据分析功能
- ✅ **数据基础**: 后端有完整的申诉数据

#### 4.2 需求描述
用户需要能够：
- 查看个人申诉统计数据
- 了解申诉处理趋势
- 分析申诉成功率
- 查看常见申诉类型

#### 4.3 验收标准
- [ ] 个人申诉统计卡片（总数、进行中、已通过、已驳回）
- [ ] 申诉类型分布图表
- [ ] 申诉成功率趋势图
- [ ] 平均处理时间统计
- [ ] 常见申诉原因分析
- [ ] 数据导出功能（CSV格式）
- [ ] 时间范围筛选（最近7天、30天、90天）

---

## 🔧 技术需求

### 5.1 前端技术要求
- **文件上传**: 集成现有Upload组件，支持拖拽上传
- **状态管理**: 使用TanStack Query进行数据管理
- **实时通信**: WebSocket连接实现实时通知
- **图表组件**: 使用Chart.js或类似库实现数据可视化
- **时间轴组件**: 自定义时间轴组件开发

### 5.2 后端接口要求
- **文件上传**: POST `/api/appeals/{id}/attachments`
- **进度查询**: GET `/api/appeals/{id}/timeline`
- **通知订阅**: WebSocket endpoint `/ws/notifications`
- **统计数据**: GET `/api/appeals/analytics`

### 5.3 性能要求
- 文件上传响应时间 < 5秒（10MB以内文件）
- 实时通知延迟 < 1秒
- 数据图表加载时间 < 2秒
- 移动端适配良好

---

## 📱 用户体验要求

### 6.1 设计要求
- 遵循现有UI设计规范
- 响应式设计，支持移动端
- 无障碍访问支持（ARIA标签）
- 加载状态和错误处理友好

### 6.2 交互要求
- 操作反馈及时（loading状态、成功/失败提示）
- 支持键盘导航
- 表单验证实时反馈
- 危险操作二次确认

---

## 🎯 优先级划分

### 🔥 P1 - 核心功能（必须实现）
1. 材料上传功能增强
2. 申诉进度时间轴可视化

### ⚡ P2 - 重要功能（应该实现）
3. 实时状态通知系统

### 📋 P3 - 增值功能（可以实现）
4. 申诉数据分析仪表板

---

## 📊 工作量评估

| 功能模块 | 预计工时 | 前端开发 | 后端开发 | 测试 |
|----------|----------|----------|----------|------|
| 材料上传增强 | 3天 | 2天 | 1天 | 1天 |
| 进度时间轴 | 2天 | 1.5天 | 0.5天 | 0.5天 |
| 实时通知 | 2天 | 1天 | 1天 | 1天 |
| 数据分析 | 2天 | 2天 | 0天 | 0.5天 |
| **总计** | **9天** | **6.5天** | **2.5天** | **3天** |

---

## 🎨 设计参考

### 组件设计草图
```
材料上传组件:
┌─────────────────────────────────┐
│ 📎 拖拽文件到此处或点击上传        │
│ ────────────────────────────── │
│ 支持 JPG、PNG、PDF、DOC 格式     │
│ 最大文件大小：10MB              │
└─────────────────────────────────┘

进度时间轴:
2025-11-07 14:30 ✅ 申诉提交
2025-11-07 15:45 🔄 审核中...
2025-11-08 09:20 ⏳ 待处理
```

---

## 📚 相关文档

- [设计文档](./design.md)
- [任务分解](./tasks.md)
- [API文档](../../../backend/api-docs/appeals.md)
- [UI组件库](../../../packages/shared/components/)

---

**文档版本**: v1.0
**最后更新**: 2025-11-07
**审核状态**: 待审核