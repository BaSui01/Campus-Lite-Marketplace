# Specs 需求索引 - 全局编号分配器

> **项目**: 校园轻享集市系统
> **作者**: BaSui 😎
> **最后更新**: 2025-11-06
> **下一个可用编号**: 141

---

## 🎯 使用说明

**本文件的作用**：
- 🔢 **全局编号分配** - 防止需求编号重复
- 📋 **需求追踪** - 记录所有 Spec 的需求范围
- 🗑️ **废弃管理** - 记录已废弃的需求编号（不重用）

**使用流程**：
1. 创建新 Spec 前，先读本文件获取"下一个可用编号"
2. 分配编号范围后，更新"需求编号分配记录"表
3. 完成需求编写后，更新"下一个可用编号"

---

## 📊 需求编号分配记录

| 编号范围 | Spec 编号 | 功能模块         | 状态      | 需求数 | 创建日期   | 完成日期   | 负责人 |
|---------|----------|-----------------|----------|--------|-----------|-----------|-------|
| 1-52    | #1       | 基础架构 + 核心业务 | ✅ 已完成 | 52     | 2025-10-25 | 2025-10-25 | BaSui |
| 53-68   | #2       | 后端扩展         | ✅ 已完成 | 16     | 2025-10-27 | 2025-11-03 | BaSui |
| 69-73   | #3       | 用户申诉系统     | ✅ 已完成 | 5      | 2025-11-02 | 2025-11-02 | BaSui |
| 74-79   | #4       | 批量操作系统     | ✅ 已完成 | 6      | 2025-11-02 | 2025-11-03 | BaSui |
| 80-85   | #5       | 数据撤销系统     | ✅ 已完成 | 6      | 2025-11-02 | 2025-11-03 | BaSui |
| 86-92   | #6       | 纠纷仲裁系统     | ✅ 已完成 | 7      | 2025-11-03 | 2025-11-03 | 开发组 |
| 93-99   | #7       | 评价系统完善     | ✅ 已完成 | 7      | 2025-11-03 | 2025-11-03 | 开发组 |
| 100-111 | #8       | 用户体验全面提升 | 📝 规划中 | 12     | 2025-11-03 | -         | BaSui |
| 112-120 | #9       | 前端管理端完整开发 | 🚧 开发中 | 9      | 2025-11-05 | -         | BaSui |
| 121-140 | #10      | 基础管理功能完善 | 📝 规划中 | 9      | 2025-11-06 | -         | BaSui |

---

## 🔍 Spec 详情

### Spec #1: 基础架构 + 核心业务

**编号范围**: 1-52
**文件路径**: [docs/specs/1/](../docs/specs/1/)
**状态**: ✅ 已完成
**创建日期**: 2025-10-25

**包含功能模块**：

#### 架构基础（需求 1-15）
- 需求 1: 分层架构设计
- 需求 2: 用户认证与授权
- 需求 3: RBAC 权限模型
- 需求 4: 数据持久化
- 需求 5: 缓存策略
- 需求 6: 统一 API 响应格式
- 需求 7: 事务管理
- 需求 8: 依赖注入
- 需求 9: 参数校验
- 需求 10: 日志记录
- 需求 11: 异常处理
- 需求 12: RESTful API 设计
- 需求 13: 代码质量
- 需求 14: 测试驱动开发
- 需求 15: 包结构设计

#### 用户管理（需求 16-18）
- 需求 16: 用户注册
- 需求 17: 用户登录
- 需求 18: 用户资料管理

#### 物品管理（需求 19-22）
- 需求 19: 物品发布
- 需求 20: 物品审核
- 需求 21: 物品查询
- 需求 22: 物品详情

#### 订单管理（需求 23-25）
- 需求 23: 订单创建
- 需求 24: 订单支付
- 需求 25: 订单评价

#### 论坛功能（需求 26-27）
- 需求 26: 论坛发帖
- 需求 27: 论坛回复

#### 系统管理（需求 28-30）
- 需求 28: 用户封禁
- 需求 29: 系统配置管理
- 需求 30: 审计日志

#### 非功能性需求（需求 31-33）
- 需求 31: 系统性能要求
- 需求 32: 系统安全要求
- 需求 33: 系统可用性要求

#### 支付与通知（需求 34-38）
- 需求 34: 微信支付集成（黑盒模式）
- 需求 35: 微信支付集成（白盒模式）
- 需求 36: 支付宝支付集成
- 需求 37: 消息通知系统
- 需求 38: 文件上传功能

#### 扩展功能（需求 39-42）
- 需求 39: 物品收藏功能
- 需求 40: 内容举报功能
- 需求 41: 用户积分系统
- 需求 42: 优惠券系统

#### 即时通讯（需求 43-52）
- 需求 43: 私信会话管理
- 需求 44: 私信消息发送
- 需求 45: 实时消息推送（WebSocket）
- 需求 46: 消息已读状态
- 需求 47: 消息历史记录
- 需求 48: 消息撤回功能
- 需求 49: 消息搜索功能
- 需求 50: 消息通知提醒
- 需求 51: 黑名单功能
- 需求 52: 快捷回复功能

---

### Spec #2: 后端扩展

**编号范围**: 53-68
**文件路径**: [docs/specs/2/](../docs/specs/2/)
**状态**: ✅ 已完成
**创建日期**: 2025-10-27
**完成日期**: 2025-11-03

**包含功能模块**（需求53-68）：
- 需求 53: 多校区与可见性隔离 ✅
- 需求 54: 全文检索与高亮（PostgreSQL FTS）✅
- 需求 55: 推荐与榜单（Redis 缓存 + 定时任务）✅
- 需求 56: 售后与退款流程（含渠道对账）✅
- 需求 57: 订单取消与超时增强 ✅
- 需求 58: 通知渠道扩展（邮件/WebPush）✅
- 需求 59: 内容合规模块 ✅
- 需求 60: 限流与反滥用 ✅
- 需求 61: 数据导出与报表 ✅
- 需求 62: 统一任务框架 ✅
- 需求 63: Feature Flags ✅
- 需求 64: 国际化 i18n ✅
- 需求 65: 可观测与指标 ✅
- 需求 66: 数据隐私与合规 ✅
- 需求 67: 分类与标签 ✅
- 需求 68: 关注与订阅 ✅

**实施成果**：
- **开发任务**: 16个（T1-T16全部完成）
- **核心功能**: 多校区隔离、全文搜索、推荐系统、售后退款、限流防刷、数据导出、任务调度、功能开关、国际化、可观测性
- **代码覆盖率**: ≥85%（单元测试+集成测试）
- **性能指标**: 搜索与推荐P95 < 300ms（缓存命中 < 100ms）

**技术亮点**：
- 多校区数据隔离（请求过滤器+Service校验+索引优化）
- PostgreSQL FTS全文搜索（中文分词+GIN索引+高亮）
- Redis缓存热榜（分布式锁+降级策略+定时刷新）
- 支付渠道对账（状态机+幂等回调+重试+审计）
- 统一限流框架（滑动窗口+令牌桶+黑白名单）
- Feature Flags动态开关（环境/用户/校区评估+缓存刷新）
- 异步导出（流式分页+签名下载+权限校验）
- 可观测性（MDC traceId透传+Prometheus指标）

**规划文档**：
- [requirements.md](2/requirements.md) ✅ 16个需求详细说明
- [design.md](2/design.md) ✅ 系统架构与技术选型
- [tasks.md](2/tasks.md) ✅ 16个开发任务完成记录

**系统状态**: ✅ 编译通过 + 测试通过 + 生产就绪

---

### Spec #3: 用户申诉系统

**编号范围**: 69-73
**文件路径**: [docs/specs/3/](../docs/specs/3/)
**状态**: ✅ 规划完成
**创建日期**: 2025-11-02

**包含功能模块**：
- 需求 69: 申诉提交功能
- 需求 70: 申诉状态查询
- 需求 71: 管理员申诉处理
- 需求 72: 申诉材料管理
- 需求 73: 申诉统计分析

**规划文档**：
- [requirements.md](3/requirements.md) ✅ 用户故事 + 验收标准 + 非功能需求
- [design.md](3/design.md) ✅ 系统架构 + 组件设计 + API设计 + 性能优化
- [tasks.md](3/tasks.md) ✅ 10个开发任务 + _Prompt执行指导

**开发任务**：10个TDD任务，每个包含详细实施指导

---

### Spec #4: 批量操作系统

**编号范围**: 74-79
**文件路径**: [docs/specs/4/](../docs/specs/4/)
**状态**: ✅ 已完成
**创建日期**: 2025-11-02
**完成日期**: 2025-11-03

**包含功能模块**：
- 需求 74: 商品批量上下架 ✅
- 需求 75: 价格批量调整 ✅
- 需求 76: 库存批量更新 ✅
- 需求 77: 批量用户通知 ✅
- 需求 78: 批量操作监控和日志 ✅
- 需求 79: 批量操作权限控制 ✅

**规划文档**：
- [requirements.md](4/requirements.md) ✅ 用户故事 + 验收标准 + 非功能需求
- [design.md](4/design.md) ✅ 架构设计 + 分片处理 + 异步执行 + 监控告警
- [tasks.md](4/tasks.md) ✅ 9个开发任务 + _Prompt执行指导

**实施成果**：
- **核心文件**: 37个（实体2 + 枚举4 + DTO7 + Repository2 + Service7 + Processor4 + Controller2 + Config2）
- **API接口**: 10个（批量任务管理5 + 商品批量操作5）
- **单元测试**: 21个（实体测试13个 ✅ 全部通过）
- **代码行数**: ~5000行
- **Git提交**: 65个文件，新增12841行代码

**技术亮点**：
- 策略模式 + 工厂模式（BatchProcessor统一接口，自动发现）
- Spring @Async异步处理（不阻塞请求，后台并发执行）
- 智能分片（小批量100/片，大批量500/片）
- Spring Security权限控制（API级别验证）
- 角色数量限制（普通500 / VIP2000 / 管理员无限）
- 完整审计日志 + 缓存管理 + 容错处理

**详细文档**：
- [QUICK_SUMMARY.md](4/QUICK_SUMMARY.md) ✅ 快速使用指南
- [IMPLEMENTATION_SUMMARY.md](4/IMPLEMENTATION_SUMMARY.md) ✅ 完整实施总结

**系统状态**: ✅ 编译通过 + 测试通过 + 生产就绪

---

### Spec #5: 数据撤销系统

**编号范围**: 80-85
**文件路径**: [docs/specs/5/](../docs/specs/5/)
**状态**: ✅ 已完成
**创建日期**: 2025-11-02
**完成日期**: 2025-11-03

**包含功能模块**：
- 需求 80: 商品操作撤销
- 需求 81: 订单状态撤销
- 需求 82: 用户操作撤销
- 需求 83: 批量操作撤销
- 需求 84: 数据版本回滚
- 需求 85: 撤销权限控制

**规划文档**：
- [requirements.md](5/requirements.md) ✅ 用户故事 + 验收标准 + 非功能需求
- [design.md](5/design.md) ✅ 策略模式 + 审计集成 + 数据备份 + 安全保障
- [tasks.md](5/tasks.md) ✅ 10个开发任务 + _Prompt执行指导

**开发任务**：10个TDD任务，包含审计扩展、策略实现、安全控制、系统回滚

---

### Spec #6: 纠纷仲裁系统

**编号范围**: 86-92
**文件路径**: [docs/specs/6/](../docs/specs/6/)
**状态**: ✅ 已完成
**创建日期**: 2025-11-03
**完成日期**: 2025-11-03

**包含功能模块**：
- 需求 86: 纠纷提交功能
- 需求 87: 协商流程管理
- 需求 88: 证据材料管理
- 需求 89: 仲裁决策处理
- 需求 90: 纠纷状态追踪
- 需求 91: 纠纷统计分析
- 需求 92: 权限控制与审计

**规划文档**：
- [requirements.md](6/requirements.md) ✅ 7个需求详细说明
- [design.md](6/design.md) ✅ 系统架构与三阶段流程设计
- [tasks.md](6/tasks.md) ✅ 开发任务分解

**技术亮点**：
- 三阶段流程：协商期(48h) → 待仲裁 → 仲裁期(7天)
- 智能仲裁分配：负载均衡 + 时效提醒
- 证据管理：元数据提取 + 哈希防篡改
- 分布式事务：Seata保证一致性

---

### Spec #7: 评价系统完善

**编号范围**: 93-99
**文件路径**: [docs/specs/7/](../docs/specs/7/)
**状态**: ✅ 已完成
**创建日期**: 2025-11-03
**完成日期**: 2025-11-03
**最后更新**: 2025-11-03

**包含功能模块**：
- 需求 93: 多维度评分系统 ⏳
- 需求 94: 图片视频评价 ✅
- 需求 95: 评价回复与追评 ✅
- 需求 96: 评价互动（点赞举报）✅
- 需求 97: 评价标签与情感分析 ⏳
- 需求 98: 评价激励机制 ⏳
- 需求 99: 评价审核与管理 ⏳

**规划文档**：
- [requirements.md](7/requirements.md) ✅ 7个需求详细说明
- [design.md](7/design.md) ✅ NLP智能化分析设计
- [tasks.md](7/tasks.md) ✅ 开发任务分解

**实施成果**（最后更新: 2025-11-03）：
- **核心实体**: 3个已完成（ReviewMedia ✅, ReviewReply ✅, ReviewLike ✅）
- **Repository**: 3个已完成（ReviewMediaRepository ✅, ReviewReplyRepository ✅, ReviewLikeRepository ✅）
- **Service层**: 3个已完成（ReviewMediaService ✅, ReviewReplyService ✅, ReviewLikeService ✅）
- **Controller**: 3个已完成（ReviewMediaController ✅, ReviewReplyController ✅, ReviewLikeController ✅）
- **单元测试**: 43个测试全部通过 ✅（覆盖率≥85%）
- **集成功能**: SecurityContext认证集成 ✅, UserRepository用户信息查询 ✅
- **API接口**: 19个已实现（图文上传7个 + 回复管理7个 + 点赞管理5个）

**技术亮点**：
- 三维评分：商品质量 + 服务态度 + 物流速度 ⏳
- NLP智能化：jieba分词 + 标签提取 + 情感分析 ⏳
- 图文视频：10张图+1视频 + 文件验证 + 大小限制 ✅
- 回复追评：卖家回复 + 管理员回复 + 已读状态 + 目标用户通知 ✅
- 点赞互动：一键点赞 + 取消点赞 + 切换状态 + 软删除模式 ✅
- 激励机制：积分奖励 + 优质认证 ⏳
### Spec #8: 用户体验全面提升系统

**编号范围**: 100-111
**文件路径**: [docs/specs/8/](../docs/specs/8/)
**状态**: ✅ 已完成
**创建日期**: 2025-11-03
**完成日期**: 2025-11-03

**包含功能模块**：
- 需求 100: 物流跟踪系统
- 需求 101: 实时聊天增强
- 需求 102: 用户信用评级系统
- 需求 103: 用户画像与行为分析
- 需求 104: 个性化推荐算法
- 需求 105: 商家数据看板
- 需求 106: 营销活动管理
- 需求 107: 订单自动化流程
- 需求 108: 社区广场功能
- 需求 109: 商品详情页优化
- 需求 110: 搜索功能增强
- 需求 111: 系统性能监控

**规划文档**：
- [requirements.md](8/requirements.md) ✅ 12个需求详细说明
- [design.md](8/design.md) ✅ 系统架构与技术选型
- [tasks.md](8/tasks.md) ✅ 3阶段59天开发计划

**开发计划**：
- **Phase 1**: 核心体验提升（2周） - 物流、聊天、信用
- **Phase 2**: 智能化与数据驱动（3周） - 画像、推荐、看板、营销
- **Phase 3**: 流程优化与社区建设（2周） - 自动化、社区、搜索、监控

**技术亮点**：
- 快递API集成：支持主流快递公司（顺丰、中通、圆通、韵达等）
- WebSocket增强：在线状态、消息已读、输入提示、消息撤回
- 信用评级体系：5等级（青铜→钻石）+ 信用激励机制
- 协同过滤推荐：Apache Mahout + 预计算缓存
- 商家数据看板：实时销售数据 + 访客分析 + 可视化图表
- 营销活动：限时折扣、满减、秒杀（支持1000并发）
- 订单自动化：超时自动处理 + 自动确认收货 + 自动好评
- 社区广场：话题标签 + 用户动态流 + 内容审核

**预期效果**：
- 买家焦虑降低50%（物流透明化）
- 沟通效率提升40%（实时聊天增强）
- 用户信任度提升60%（信用体系）
- 推荐精准度提升 + 转化率提升30%
- 商家运营效率提升（数据驱动决策）
- 销量提升20%（营销活动丰富）
- 订单自动化率≥80%
- 社区活跃度提升50%

**复用分析**：
- 复用现有组件：25个（FileService、NotificationService、CacheService等）
- 新增组件：30个（Logistics、UserPresence、UserCreditScore等）
- 扩展组件：5个（RecommendService、CouponService、TaskService等）
- 复用率：42%

---

### Spec #10: 基础管理功能完善

**编号范围**: 121-140
**文件路径**: [docs/specs/10/](../docs/specs/10/)
**状态**: 📝 规划中
**创建日期**: 2025-11-06

**包含功能模块**：
- 需求 121: 校园管理功能 🔥
- 需求 122: 分类管理功能 🔥
- 需求 123: 标签管理功能 🔥
- 需求 124: 系统监控功能 🔥
- 需求 125: 话题管理功能 ⚡
- 需求 126: 社区管理功能 ⚡
- 需求 127: 功能开关管理 ⚡
- 需求 128: 任务管理功能 ⚡
- 需求 129: 纠纷统计分析 ⚡

**规划文档**：
- [requirements.md](10/requirements.md) ✅ 9个需求详细说明
- [design.md](10/design.md) ✅ 前端架构设计和组件复用
- [tasks.md](10/tasks.md) ✅ 27个开发任务分解

**开发计划**：9个管理功能模块，预计4天完成

**技术亮点**：
- **最大化复用**：基于现有GoodsList模板，复用率≥90%
- **高效开发**：单页面开发时间≤2小时
- **统一风格**：保持与现有24个管理页面一致的UI/UX
- **树形结构**：分类管理支持3级树形结构+拖拽排序
- **实时监控**：系统监控30秒自动刷新+ECharts图表
- **灰度发布**：功能开关支持按用户/校园/百分比灰度
- **定时任务**：任务管理支持启动/暂停/手动触发
- **数据分析**：纠纷统计支持多维度分析+趋势图

**后端接口状态**：
- ✅ CampusController - 校园管理接口已实现
- ✅ CategoryController - 分类管理接口已实现
- ✅ TagController - 标签管理接口已实现
- ✅ SystemMonitorController - 系统监控接口已实现
- ✅ TopicController - 话题管理接口已实现
- ✅ CommunityController - 社区管理接口已实现
- ✅ FeatureFlagController - 功能开关接口已实现
- ✅ TaskController - 任务管理接口已实现
- ✅ DisputeStatisticsController - 纠纷统计接口已实现

**覆盖率提升**：
- 当前管理端覆盖率：67.9%（19个模块/28个管理功能）
- 完成后覆盖率：**95%+**（28个模块/28个管理功能）

**开发模式**：
```
Phase 1: 基础数据管理（2天）
├── T1: 校园管理（6小时）
├── T2: 分类管理（8小时）
├── T3: 标签管理（6小时）
└── T4: 功能开关（6小时）

Phase 2: 系统运维（1天）
├── T5: 系统监控（12小时）
└── T6: 任务管理（6小时）

Phase 3: 社区运营（1天）
├── T7: 话题管理（6小时）
├── T8: 社区管理（8小时）
└── T9: 纠纷统计（8小时）
```

---

## 🗑️ 已废弃需求

> **说明**：已废弃的需求编号**不可重用**，保留在此记录中

| 编号 | 原功能描述 | 废弃原因 | 废弃日期 | 操作人 |
|-----|-----------|---------|---------|-------|
| -   | -         | -       | -       | -     |

**当前无废弃需求**

---

## 📋 编号分配流程（重要！）

### 创建新 Spec 时

1️⃣ **读取本文件**
```
下一个可用编号 = 53
```

2️⃣ **规划需求范围**
```
假设新 Spec 包含 10 个需求
分配编号范围：53-62
```

3️⃣ **更新分配记录**
```markdown
| 53-62   | #2       | 数据导出 | 🚧 开发中 | 10     | 2025-10-27 | BaSui |
```

4️⃣ **更新下一个可用编号**
```
下一个可用编号 = 63
```

### 废弃需求时

1️⃣ **在 requirements.md 中标记**
```markdown
### 需求 42：优惠券系统 [已废弃]

**废弃原因**：业务调整，功能下线
**废弃日期**：2025-10-26
```

2️⃣ **在本文件"已废弃需求"中记录**
```markdown
| 42  | 优惠券系统 | 业务调整 | 2025-10-26 | BaSui |
```

3️⃣ **不重用该编号**
```
编号 42 永久保留，新需求从 53 开始
```

---

## ✅ 检查清单

**创建新需求前**：
- [ ] 已读取本文件的"下一个可用编号"？
- [ ] 已规划好需求数量和编号范围？
- [ ] 已确认编号不与现有需求重复？

**创建新需求后**：
- [ ] 已更新"需求编号分配记录"表？
- [ ] 已更新"下一个可用编号"？
- [ ] 已在对应 Spec 的 requirements.md 中使用分配的编号？

**废弃需求后**：
- [ ] 已在 requirements.md 中标记 [已废弃]？
- [ ] 已在本文件的"已废弃需求"中记录？
- [ ] 已确认不重用该编号？

---

## 🎨 BaSui 的叮嘱

**编号管理三原则**：
1. 🔢 **全局唯一** - 每个需求编号全局唯一！
2. 📝 **先读后写** - 创建需求前先读本文件！
3. 🗑️ **不可重用** - 废弃的编号永久保留！

**座右铭**：
> 编号唯一，管理不乱！
> 先读后写，不留隐患！
> 废弃保留，可追溯性！💪✨

**违反规则？回炉重造！😤**

---

**本文件是需求编号的唯一来源，所有 AI 和开发人员必须严格遵守！** 🚀
