# æ•°æ®æ’¤é”€ç³»ç»Ÿä»»åŠ¡åˆ†è§£

## Overview

åŸºäºæ•°æ®æ’¤é”€ç³»ç»Ÿçš„è®¾è®¡æ–‡æ¡£ï¼Œå°†ç³»ç»Ÿå¼€å‘åˆ†è§£ä¸ºç‹¬ç«‹çš„ã€åŸå­æ€§çš„å¼€å‘ä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡éµå¾ªTDDåŸåˆ™ï¼ŒåŒ…å«å®Œæ•´çš„æµ‹è¯•ã€å®ç°å’ŒéªŒè¯æ­¥éª¤ï¼Œç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚

## Task Breakdown

### ğŸ”„ ä»»åŠ¡ 1: å®¡è®¡æ—¥å¿—æ‰©å±•å’Œæ•°æ®å¤‡ä»½

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: æ•°æ®åŸºç¡€å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„å®¡è®¡æ—¥å¿—æ‰©å±•å’Œæ•°æ®å¤‡ä»½åŠŸèƒ½ï¼ŒåŒ…æ‹¬AuditLogå®ä½“æ‰©å±•ã€æ•°æ®å¤‡ä»½æœºåˆ¶ã€å¤‡ä»½ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰åŠŸèƒ½ï¼Œä¸ºæ’¤é”€æ“ä½œæä¾›å®Œæ•´çš„æ•°æ®æ”¯æŒã€‚
**Constraints**:
- å®¡è®¡æ—¥å¿—æ‰©å±•ä¸èƒ½å½±å“ç°æœ‰ç³»ç»ŸåŠŸèƒ½
- æ•°æ®å¤‡ä»½å¿…é¡»é«˜æ•ˆä¸”ä¸å½±å“ä¸»ä¸šåŠ¡æ€§èƒ½
- å¤‡ä»½æ•°æ®å¿…é¡»å®Œæ•´ä¸”å¯éªŒè¯
- å¤‡ä»½å­˜å‚¨å¿…é¡»æ”¯æŒå‹ç¼©å’ŒåŠ å¯†
- å¤‡ä»½ç”Ÿå‘½å‘¨æœŸå¿…é¡»è‡ªåŠ¨ç®¡ç†
**_Leverage**: ç°æœ‰çš„AuditLogå®ä½“ã€æ•°æ®å¤‡ä»½ç³»ç»Ÿã€å‹ç¼©å·¥å…·ã€åŠ å¯†æœåŠ¡ã€å®šæ—¶ä»»åŠ¡æ¡†æ¶
**_Requirements**: éœ€æ±‚80(å•†å“æ“ä½œæ’¤é”€)ã€éœ€æ±‚81(è®¢å•çŠ¶æ€æ’¤é”€)ã€éœ€æ±‚82(ç”¨æˆ·æ“ä½œæ’¤é”€)ã€éœ€æ±‚84(æ•°æ®ç‰ˆæœ¬å›æ»š)
**Success**:
- å®¡è®¡æ—¥å¿—æ‰©å±•åŠŸèƒ½æ­£å¸¸
- æ•°æ®å¤‡ä»½æœºåˆ¶ç¨³å®šå¯é 
- å¤‡ä»½æ•°æ®å®Œæ•´å‡†ç¡®
- å¤‡ä»½æ€§èƒ½æ»¡è¶³è¦æ±‚
- å¤‡ä»½ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™æ•°æ®å¤‡ä»½çš„å¤±è´¥æµ‹è¯•
2. æ‰©å±•AuditLogå®ä½“æ”¯æŒæ’¤é”€è·Ÿè¸ª
3. å®ç°DataBackupæ•°æ®å¤‡ä»½å®ä½“
4. å®ç°è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
5. å®ç°å¤‡ä»½ç”Ÿå‘½å‘¨æœŸç®¡ç†
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 1.1 æ‰©å±•AuditLogå®ä½“
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/common/entity/AuditLog.java` (æ‰©å±•)
**ä¾èµ–**: `BaseEntity.java`, `ç°æœ‰AuditLogå­—æ®µ`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ–°å¢æ’¤é”€ç›¸å…³å­—æ®µï¼šisReversibleã€revertDeadlineã€revertedByLogIdã€revertedAtã€revertCount
- [ ] å®ä½“æ˜ å°„é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬å®Œæ•´
- [ ] ç´¢å¼•ä¼˜åŒ–é…ç½®
- [ ] å‘åå…¼å®¹æ€§ä¿è¯

#### 1.2 åˆ›å»ºDataBackupå®ä½“
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/common/entity/DataBackup.java`
**ä¾èµ–**: `BaseEntity.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ•°æ®å¤‡ä»½å­—æ®µå®Œæ•´ï¼šentityTypeã€entityIdã€backupDataã€backupVersionã€expireAt
- [ ] å¤‡ä»½æ•°æ®å‹ç¼©å­˜å‚¨
- [ ] å¤‡ä»½ç‰ˆæœ¬ç®¡ç†æ­£ç¡®
- [ ] è¿‡æœŸæ—¶é—´è®¾ç½®åˆç†
- [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯

#### 1.3 å®ç°DataBackupService
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/DataBackupService.java`
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/impl/DataBackupServiceImpl.java`
**ä¾èµ–**: `AuditLogService.java`, `DataBackupRepository.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ•°æ®å¤‡ä»½åˆ›å»ºæœºåˆ¶
- [ ] å¤‡ä»½æ•°æ®å‹ç¼©å’Œå­˜å‚¨
- [ ] å¤‡ä»½å®Œæ•´æ€§å’Œæ ¡éªŒ
- [ ] å¤‡ä»½æ•°æ®æŸ¥è¯¢å’ŒéªŒè¯
- [ ] å¤‡ä»½æ€§èƒ½ä¼˜åŒ–

#### 1.4 å®ç°å¤‡ä»½ç”Ÿå‘½å‘¨æœŸç®¡ç†
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/task/BackupCleanupTask.java`
**ä¾èµ–**: `DataBackupService.java`, `TimedScheduler.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] è¿‡æœŸå¤‡ä»½è‡ªåŠ¨æ¸…ç†
- [ ] æ¸…ç†ä»»åŠ¡è°ƒåº¦é…ç½®
- [ ] æ¸…ç†å¼‚å¸¸å¤„ç†
- [ ] æ¸…ç†è®°å½•å’Œæ—¥å¿—
- [ ] æ¸…ç†ç›‘æ§å’Œå‘Šè­¦

---

### ğŸ”„ ä»»åŠ¡ 2: æ’¤é”€ç­–ç•¥å·¥å‚å’Œæ ¸å¿ƒæ¥å£

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: æ¶æ„è®¾è®¡å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„ç­–ç•¥å·¥å‚å’Œæ ¸å¿ƒæ¥å£ï¼ŒåŒ…æ‹¬æ’¤é”€ç­–ç•¥æ¥å£ã€ç­–ç•¥å·¥å‚ã€æ’¤é”€è¯·æ±‚ç®¡ç†ç­‰åŸºç¡€è®¾æ–½ï¼Œä¸ºå„ç§å®ä½“ç±»å‹çš„æ’¤é”€æ“ä½œæä¾›ç»Ÿä¸€çš„æ¶æ„æ”¯æŒã€‚
**Constraints**:
- ç­–ç•¥å·¥å‚å¿…é¡»æ”¯æŒæ’ä»¶åŒ–æ‰©å±•
- æ’¤é”€æ¥å£è®¾è®¡å¿…é¡»ç®€æ´ç»Ÿä¸€
- ç­–ç•¥æ³¨å†Œå’Œå‘ç°å¿…é¡»è‡ªåŠ¨åŒ–
- ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†å¿…é¡»å®Œæ•´
- ç­–ç•¥æ€§èƒ½å¿…é¡»æ»¡è¶³è¦æ±‚
**_Leverage**: ç­–ç•¥æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€Springé…ç½®ã€ä¾èµ–æ³¨å…¥ã€æ¥å£è®¾è®¡
**_Requirements**: æ‰€æœ‰æ’¤é”€åŠŸèƒ½éƒ½éœ€è¦ç»Ÿä¸€æ¶æ„æ”¯æŒ
**Success**:
- æ’¤é”€ç­–ç•¥æ¶æ„æ¸…æ™°ç¨³å®š
- ç­–ç•¥å·¥å‚åŠŸèƒ½å®Œå–„
- æ¥å£è®¾è®¡åˆç†æ˜“ç”¨
- ç­–ç•¥æ‰©å±•æœºåˆ¶çµæ´»
- æ¶æ„æ€§èƒ½è¾¾æ ‡
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™ç­–ç•¥å·¥å‚çš„å¤±è´¥æµ‹è¯•
2. è®¾è®¡æ’¤é”€ç­–ç•¥æ¥å£
3. å®ç°æ’¤é”€ç­–ç•¥å·¥å‚
4. åˆ›å»ºæ’¤é”€è¯·æ±‚ç®¡ç†
5. é…ç½®ç­–ç•¥æ³¨å†Œæœºåˆ¶
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 2.1 è®¾è®¡æ’¤é”€ç­–ç•¥æ¥å£
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/strategy/RevertStrategy.java`
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/dto/RevertValidationResult.java`
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/dto/RevertExecutionResult.java`
**ä¾èµ–**: ç°æœ‰DTOå’ŒExceptionæ¡†æ¶
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€ç­–ç•¥æ¥å£æ–¹æ³•å®Œæ•´
- [ ] éªŒè¯ç»“æœç»“æ„åˆç†
- [ ] æ‰§è¡Œç»“æœç»“æ„å‡†ç¡®
- [ ] å¼‚å¸¸å¤„ç†æœºåˆ¶å®Œå–„
- [ ] æ¥å£æ–‡æ¡£æ¸…æ™°

#### 2.2 å®ç°æ’¤é”€ç­–ç•¥å·¥å‚
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/factory/RevertStrategyFactory.java`
**ä¾èµ–**: `ApplicationContext.java`, `RevertStrategy.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] ç­–ç•¥è‡ªåŠ¨æ³¨å†Œå‘ç°
- [ ] ç­–ç•¥è·å–å’ŒéªŒè¯
- [ ] ä¸æ”¯æŒå¼‚å¸¸å¤„ç†
- [ ] å·¥å‚æ€§èƒ½ä¼˜åŒ–
- [ ] ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### 2.3 åˆ›å»ºæ’¤é”€è¯·æ±‚ç®¡ç†
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/RevertRequestManager.java`
**ä¾èµ–**: `RevertRequestRepository.java`, `WorkflowEngine.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€è¯·æ±‚åˆ›å»ºå’ŒéªŒè¯
- [ ] è¯·æ±‚çŠ¶æ€æµè½¬ç®¡ç†
- [ ] å®¡æ‰¹æµç¨‹é›†æˆ
- [ ] è¯·æ±‚æƒé™æ£€æŸ¥
- [ ] è¯·æ±‚ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

### ğŸ”„ ä»»åŠ¡ 3: å•†å“æ’¤é”€ç­–ç•¥å®ç°

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: å•†å“ä¸šåŠ¡å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„å•†å“æ’¤é”€ç­–ç•¥ï¼Œå®ç°å•†å“åˆ é™¤æ’¤é”€ã€å•†å“æ›´æ–°æ’¤é”€ã€æ–‡ä»¶èµ„æºæ¢å¤ç­‰åŠŸèƒ½ï¼Œç¡®ä¿å•†å“ç›¸å…³æ“ä½œçš„å¯æ’¤é”€æ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚
**Constraints**:
- å•†å“æ’¤é”€å¿…é¡»è€ƒè™‘äº¤æ˜“å½±å“
- æ–‡ä»¶èµ„æºæ¢å¤å¿…é¡»éªŒè¯æ–‡ä»¶å­˜åœ¨æ€§
- æ’¤é”€åå•†å“çŠ¶æ€å¿…é¡»åˆç†æ§åˆ¶
- æ’¤é”€æ“ä½œå¿…é¡»è®°å½•è¯¦ç»†æ—¥å¿—
- å¿…é¡»æ”¯æŒæ‰¹é‡å•†å“æ’¤é”€
**_Leverage**: ç°æœ‰çš„GoodsServiceã€FileStorageServiceã€OrderServiceã€AuditLogServiceã€ç¼“å­˜ç³»ç»Ÿ
**_Requirements**: éœ€æ±‚80(å•†å“æ“ä½œæ’¤é”€)
**Success**:
- å•†å“åˆ é™¤æ’¤é”€åŠŸèƒ½å®Œæ•´
- å•†å“æ›´æ–°æ’¤é”€å‡†ç¡®å¯é 
- æ–‡ä»¶èµ„æºæ¢å¤æ­£å¸¸
- å•†å“çŠ¶æ€ç®¡ç†æ­£ç¡®
- äº¤æ˜“å½±å“å¤„ç†æœ‰æ•ˆ
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™å•†å“æ’¤é”€çš„å¤±è´¥æµ‹è¯•
2. å®ç°GoodsRevertStrategyç­–ç•¥
3. å®ç°å•†å“åˆ é™¤æ’¤é”€åŠŸèƒ½
4. å®ç°å•†å“æ›´æ–°æ’¤é”€åŠŸèƒ½
5. å®ç°æ–‡ä»¶èµ„æºæ¢å¤
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 3.1 å®ç°GoodsRevertStrategy
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/strategy/GoodsRevertStrategy.java`
**ä¾èµ–**: `RevertStrategy.java`, `GoodsRepository.java`, `FileStorageService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] å•†å“åˆ é™¤æ’¤é”€é€»è¾‘å®Œæ•´
- [ ] å•†å“æ›´æ–°æ’¤é”€å‡†ç¡®
- [ ] æ’¤é”€éªŒè¯ä¸¥æ ¼
- [ ] å¼‚å¸¸å¤„ç†å®Œå–„
- [ ] æ—¥å¿—è®°å½•è¯¦ç»†

#### 3.2 å®ç°å•†å“æ–‡ä»¶æ¢å¤
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/GoodsFileRecoveryService.java`
**ä¾èµ–**: `FileStorageService.java`, `BackupStorageService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ–‡ä»¶å­˜åœ¨æ€§éªŒè¯
- [ ] æ–‡ä»¶æ¢å¤è¿‡ç¨‹å®‰å…¨
- [ ] ç¼©ç•¥å›¾æ¢å¤æ”¯æŒ
- [ ] æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ
- [ ] æ¢å¤å¤±è´¥å¤„ç†

#### 3.3 å®ç°å•†å“çŠ¶æ€æ¢å¤
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/GoodsStatusRecoveryService.java`
**ä¾èµ–**: `GoodsRepository.java`, `CacheService.java`, `AuditLogService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] å•†å“çŠ¶æ€æ¢å¤æ­£ç¡®
- [ ] ç¼“å­˜æ›´æ–°åŠæ—¶
- [ ] å®¡è®¡è®°å½•å®Œæ•´
- [ ] çŠ¶æ€æµè½¬éªŒè¯
- [ ] å¹¶å‘æ§åˆ¶æœ‰æ•ˆ

---

### ğŸ”„ ä»»åŠ¡ 4: è®¢å•æ’¤é”€ç­–ç•¥å®ç°

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: è®¢å•ä¸šåŠ¡å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„è®¢å•æ’¤é”€ç­–ç•¥ï¼Œå®ç°è®¢å•çŠ¶æ€æ’¤é”€ã€èµ„é‡‘é€€æ¬¾å¤„ç†ã€äº¤æ˜“è®°å½•å›æ»šç­‰åŠŸèƒ½ï¼Œç¡®ä¿è®¢å•æ“ä½œçš„å¯æ’¤é”€æ€§å’Œèµ„é‡‘å®‰å…¨ã€‚
**Constraints**:
- è®¢å•æ’¤é”€å¿…é¡»æ£€æŸ¥æ—¶é—´é™åˆ¶
- èµ„é‡‘é€€æ¬¾å¿…é¡»éªŒè¯ç»“ç®—çŠ¶æ€
- è®¢å•çŠ¶æ€å›æ»šå¿…é¡»ä¿è¯æ•°æ®ä¸€è‡´æ€§
- é€€æ¬¾æµç¨‹å¿…é¡»ä¸æ”¯ä»˜ç³»ç»Ÿé›†æˆ
- å¿…é¡»è®°å½•è¯¦ç»†çš„æ’¤é”€åŸå› 
**_Leverage**: ç°æœ‰çš„OrderServiceã€PaymentServiceã€RefundServiceã€AuditLogServiceã€äº‹åŠ¡ç®¡ç†
**_Requirements**: éœ€æ±‚81(è®¢å•çŠ¶æ€æ’¤é”€)
**Success**:
- è®¢å•çŠ¶æ€æ’¤é”€åŠŸèƒ½å®Œæ•´
- èµ„é‡‘é€€æ¬¾æµç¨‹å®‰å…¨
- äº¤æ˜“è®°å½•å›æ»šæ­£ç¡®
- è®¢å•çŠ¶æ€æµè½¬å‡†ç¡®
- èµ„é‡‘å®‰å…¨ä¿éšœæœ‰æ•ˆ
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™è®¢å•æ’¤é”€çš„å¤±è´¥æµ‹è¯•
2. å®ç°OrderRevertStrategyç­–ç•¥
3. å®ç°è®¢å•çŠ¶æ€æ’¤é”€åŠŸèƒ½
4. å®ç°èµ„é‡‘é€€æ¬¾å¤„ç†
5. å®ç°äº¤æ˜“è®°å½•å›æ»š
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 4.1 å®ç°OrderRevertStrategy
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/strategy/OrderRevertStrategy.java`
**ä¾èµ–**: `RevertStrategy.java`, `OrderRepository.java`, `PaymentService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] è®¢å•çŠ¶æ€æ’¤é”€é€»è¾‘æ­£ç¡®
- [ ] æ—¶é—´é™åˆ¶éªŒè¯ä¸¥æ ¼
- [ ] èµ„é‡‘çŠ¶æ€æ£€æŸ¥å‡†ç¡®
- [ ] æ’¤é”€æƒé™éªŒè¯æœ‰æ•ˆ
- [ ] æ“ä½œæ—¥å¿—è®°å½•è¯¦ç»†

#### 4.2 å®ç°èµ„é‡‘é€€æ¬¾å¤„ç†
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/OrderRefundRevertService.java`
**ä¾èµ–**: `PaymentService.java`, `RefundService.java`, `AccountService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] é€€æ¬¾ç”³è¯·æµç¨‹æ­£ç¡®
- [ ] èµ„é‡‘ç»“ç®—çŠ¶æ€éªŒè¯
- [ ] é€€æ¬¾çŠ¶æ€è·Ÿè¸ªå‡†ç¡®
- [ ] é€€æ¬¾å¼‚å¸¸å¤„ç†å®Œå–„
- [ ] èµ„é‡‘å®‰å…¨ä¿éšœæœ‰æ•ˆ

#### 4.3 å®ç°è®¢å•çŠ¶æ€å›æ»š
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/OrderStatusRecoveryService.java`
**ä¾èµ–**: `OrderRepository.java`, `OrderStatusHistoryRepository.java`, `NotificationService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] è®¢å•çŠ¶æ€å›æ»šå‡†ç¡®
- [ ] çŠ¶æ€å†å²è®°å½•å®Œæ•´
- [ ] ç›¸å…³æ–¹é€šçŸ¥åŠæ—¶
- [ ] åº“å­˜å’Œè®¢å•æ›´æ–°
- [ ] æ•°æ®ä¸€è‡´æ€§ä¿è¯

---

### ğŸ”„ ä»»åŠ¡ 5: ç”¨æˆ·æ“ä½œæ’¤é”€ç­–ç•¥

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: ç”¨æˆ·ç®¡ç†å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„ç”¨æˆ·æ“ä½œæ’¤é”€ç­–ç•¥ï¼Œå®ç°ç”¨æˆ·å¤„ç½šæ’¤é”€ã€è´¦æˆ·çŠ¶æ€æ¢å¤ã€æƒé™é‡ç½®ç­‰åŠŸèƒ½ï¼Œç¡®ä¿ç”¨æˆ·ç®¡ç†æ“ä½œçš„å¯æ’¤é”€æ€§å’Œæ“ä½œåˆè§„æ€§ã€‚
**Constraints**:
- ç”¨æˆ·æ’¤é”€å¿…é¡»æ£€æŸ¥æ“ä½œæƒé™
- è´¦æˆ·çŠ¶æ€æ¢å¤å¿…é¡»å®‰å…¨å¯æ§
- æƒé™é‡ç½®å¿…é¡»å½±å“å‡†ç¡®
- æ’¤é”€æ“ä½œå¿…é¡»é«˜çº§å®¡æ‰¹
- å¿…é¡»è€ƒè™‘ç”¨æˆ·å½±å“è¯„ä¼°
**_Leverage**: ç°æœ‰çš„UserServiceã€PermissionServiceã€RoleServiceã€AuditLogServiceã€å®¡æ‰¹å·¥ä½œæµ
**_Requirements**: éœ€æ±‚82(ç”¨æˆ·æ“ä½œæ’¤é”€)
**Success**:
- ç”¨æˆ·å¤„ç½šæ’¤é”€åŠŸèƒ½å®Œæ•´
- è´¦æˆ·çŠ¶æ€æ¢å¤å®‰å…¨
- æƒé™é‡ç½®æ“ä½œå‡†ç¡®
- å½±å“è¯„ä¼°æœºåˆ¶å®Œå–„
- æ’¤é”€å®¡æ‰¹æµç¨‹è§„èŒƒ
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™ç”¨æˆ·æ’¤é”€çš„å¤±è´¥æµ‹è¯•
2. å®ç°UserRevertStrategyç­–ç•¥
3. å®ç°ç”¨æˆ·å¤„ç½šæ’¤é”€åŠŸèƒ½
4. å®ç°è´¦æˆ·çŠ¶æ€æ¢å¤
5. å®ç°æƒé™é‡ç½®æ“ä½œ
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 5.1 å®ç°UserRevertStrategy
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/strategy/UserRevertStrategy.java`
**ä¾èµ–**: `RevertStrategy.java`, `UserService.java`, `PermissionService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] ç”¨æˆ·å¤„ç½šæ’¤é”€é€»è¾‘æ­£ç¡®
- [ ] æ’¤é”€æƒé™éªŒè¯ä¸¥æ ¼
- [ ] å½±å“è¯„ä¼°æœºåˆ¶å®Œå–„
- [ ] å®¡æ‰¹æµç¨‹é›†æˆæ­£å¸¸
- [ ] æ“ä½œè®°å½•è¯¦ç»†

#### 5.2 å®ç°è´¦æˆ·çŠ¶æ€æ¢å¤
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/UserAccountRecoveryService.java`
**ä¾èµ–**: `UserService.java`, `SecurityService.java`, `CacheService.java`
**éªŒè¯æ ‡å‡†**:
- [ ] è´¦æˆ·çŠ¶æ€æ¢å¤å‡†ç¡®
- [ ] ç™»å½•çŠ¶æ€å¤„ç†æ­£ç¡®
- [ ] ç¼“å­˜å’Œä¼šè¯æ›´æ–°
- [ ] å®‰å…¨éªŒè¯ä¸¥æ ¼
- [ ] æ¢å¤é€šçŸ¥å‘é€åŠæ—¶

#### 5.3 å®ç°æƒé™é‡ç½®æ“ä½œ
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/UserPermissionRecoveryService.java`
**ä¾èµ–**: `PermissionService.java`, `RoleService.java`, `CacheService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æƒé™é‡ç½®æ“ä½œå‡†ç¡®
- [ ] è§’è‰²å…³è”å¤„ç†æ­£ç¡®
- [ ] ç¼“å­˜æƒé™æ›´æ–°åŠæ—¶
- [ ] æƒé™éªŒè¯æœºåˆ¶æœ‰æ•ˆ
- [ ] æ“ä½œæ—¥å¿—è®°å½•è¯¦ç»†

---

### ğŸ”„ ä»»åŠ¡ 6: æ‰¹é‡æ“ä½œæ’¤é”€ç­–ç•¥

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the:
```text
**Role**: æ‰¹é‡å¤„ç†å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„æ‰¹é‡æ“ä½œæ’¤é”€ç­–ç•¥ï¼Œå®ç°æ‰¹é‡æ“ä½œå›æ»šã€åˆ†å¸ƒå¼æ’¤é”€å¤„ç†ã€äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯ç­‰åŠŸèƒ½ï¼Œç¡®ä¿æ‰¹é‡æ“ä½œçš„å¯æ’¤é”€æ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚
**Constraints**:
- æ‰¹é‡æ’¤é”€å¿…é¡»æ”¯æŒåˆ†ç‰‡å¤„ç†
- äº‹åŠ¡ä¸€è‡´æ€§å¿…é¡»ä¸¥æ ¼ä¿è¯
- æ’¤é”€è¿‡ç¨‹å¿…é¡»æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- å›æ»šé¡ºåºå¿…é¡»æ­£ç¡®
- å¿…é¡»æ”¯æŒå¤§è§„æ¨¡æ•°æ®å›æ»š
**_Leverage**: ç°æœ‰çš„BatchTaskOrchestratorã€åˆ†å¸ƒå¼é”ã€äº‹åŠ¡ç®¡ç†ã€åˆ†ç‰‡å¤„ç†ã€æ‰¹é‡æ“ä½œæ¡†æ¶
**_Requirements**: éœ€æ±‚83(æ‰¹é‡æ“ä½œæ’¤é”€)
**Success**:
- æ‰¹é‡æ“ä½œæ’¤é”€åŠŸèƒ½å®Œæ•´
- åˆ†å¸ƒå¼æ’¤é”€å¤„ç†ç¨³å®š
- äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯æœ‰æ•ˆ
- æ–­ç‚¹ç»­ä¼ æœºåˆ¶å®Œå–„
- å¤§è§„æ¨¡å›æ»šæ€§èƒ½è¾¾æ ‡
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™æ‰¹é‡æ’¤é”€çš„å¤±è´¥æµ‹è¯•
2. å®ç°BatchRevertStrategyç­–ç•¥
3. å®ç°æ‰¹é‡æ“ä½œå›æ»šåŠŸèƒ½
4. å®ç°åˆ†å¸ƒå¼æ’¤é”€å¤„ç†
5. å®ç°äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 6.1 å®ç°BatchRevertStrategy
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/revert/strategy/BatchRevertStrategy.java`
**ä¾èµ–**: `RevertStrategy.java`, `BatchTaskOrchestrator.java`, `DistributedLockService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰¹é‡æ’¤é”€ç­–ç•¥å®Œæ•´
- [ ] åˆ†ç‰‡å¤„ç†é€»è¾‘æ­£ç¡®
- [ ] åˆ†å¸ƒå¼é”ä½¿ç”¨åˆç†
- [ ] å›æ»šé¡ºåºæ§åˆ¶å‡†ç¡®
- [ ] æ€§èƒ½ä¼˜åŒ–æœ‰æ•ˆ

#### 6.2 å®ç°æ‰¹é‡æ“ä½œå›æ»š
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/BatchOperationRevertService.java`
**ä¾èµ–**: `BatchTaskRepository.java`, `RevertStrategyFactory.java`, `TransactionManager.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰¹é‡æ“ä½œå›æ»šå®ç°
- [ ] å›æ»šçŠ¶æ€è·Ÿè¸ªå‡†ç¡®
- [ ] éƒ¨åˆ†å¤±è´¥å¤„ç†æœºåˆ¶
- [ ] é‡è¯•å’Œæ¢å¤ç­–ç•¥
- [ ] æ€§èƒ½ç›‘æ§å®Œå–„

#### 6.3 å®ç°åˆ†å¸ƒå¼æ’¤é”€å¤„ç†
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/DistributedRevertService.java`
**ä¾èµ–**: `MessageQueue.java`, `ClusterCoordinator.java`, `TaskScheduler.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] åˆ†å¸ƒå¼ä»»åŠ¡åˆ†é…
- [ ] èŠ‚ç‚¹é—´é€šä¿¡å¯é 
- [ ] æ•…éšœè½¬ç§»æœºåˆ¶å®Œå–„
- [ ] è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰æ•ˆ
- [ ] çŠ¶æ€åŒæ­¥åŠæ—¶

---

### ğŸ”„ ä»»åŠ¡ 7: æ’¤é”€æ§åˆ¶å™¨å’ŒAPIæ¥å£

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: APIæ¶æ„å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„æ§åˆ¶å™¨å’ŒAPIæ¥å£ï¼Œå®ç°æ’¤é”€ç”³è¯·APIã€æ’¤é”€æ‰§è¡ŒAPIã€æ’¤é”€æŸ¥è¯¢APIã€ç³»ç»Ÿå›æ»šAPIç­‰åŠŸèƒ½ï¼Œç¡®ä¿APIçš„è§„èŒƒæ€§ã€å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ã€‚
**Constraints**:
- APIè®¾è®¡å¿…é¡»éµå¾ªRESTfulè§„èŒƒ
- æ’¤é”€æƒé™éªŒè¯å¿…é¡»ä¸¥æ ¼
- APIå“åº”å¿…é¡»ç»Ÿä¸€è§„èŒƒ
- å®¡æ‰¹æµç¨‹å¿…é¡»å®Œå–„é›†æˆ
- æ•°æ®å®‰å…¨å¿…é¡»ä¸¥æ ¼ä¿éšœ
**_Leverage**: ç°æœ‰çš„BaseControllerã€æƒé™éªŒè¯ã€å…¨å±€å¼‚å¸¸å¤„ç†ã€APIæ–‡æ¡£ã€å®¡æ‰¹ç³»ç»Ÿ
**_Requirements**: éœ€æ±‚80(å•†å“æ“ä½œæ’¤é”€)ã€éœ€æ±‚81(è®¢å•çŠ¶æ€æ’¤é”€)ã€éœ€æ±‚82(ç”¨æˆ·æ“ä½œæ’¤é”€)ã€éœ€æ±‚84(æ•°æ®ç‰ˆæœ¬å›æ»š)ã€éœ€æ±‚85(æ’¤é”€æƒé™æ§åˆ¶)
**Success**:
- æ’¤é”€APIåŠŸèƒ½å®Œæ•´å¯ç”¨
- æƒé™éªŒè¯ä¸¥æ ¼æœ‰æ•ˆ
- APIå“åº”æ ¼å¼ç»Ÿä¸€
- å®¡æ‰¹æµç¨‹é›†æˆæ­£å¸¸
- æ•°æ®å®‰å…¨ä¿éšœåˆ°ä½
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™æ’¤é”€APIçš„å¤±è´¥æµ‹è¯•
2. å®ç°RevertControllerç”¨æˆ·API
3. å®ç°RevertAdminControllerç®¡ç†API
4. å®ç°SystemRollbackControllerç³»ç»ŸAPI
5. é…ç½®æƒé™éªŒè¯å’Œå®‰å…¨æ§åˆ¶
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 7.1 åˆ›å»ºæ’¤é”€è¯·æ±‚å“åº”DTO
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/common/dto/request/RevertRequest.java`
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/common/dto/response/RevertResult.java`
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/common/dto/response/RevertPreviewResponse.java`
**ä¾èµ–**: `BaseRequest.java`, `BaseResponse.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€è¯·æ±‚DTOå­—æ®µå®Œæ•´
- [ ] å‚æ•°éªŒè¯æ³¨è§£é…ç½®æ­£ç¡®
- [ ] å“åº”ç»“æ„ç»Ÿä¸€è§„èŒƒ
- [ ] åºåˆ—åŒ–ååºåˆ—åŒ–æ­£å¸¸
- [ ] æ–‡æ¡£æ³¨é‡Šè¯¦ç»†

#### 7.2 å®ç°RevertController
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/controller/RevertController.java`
**ä¾èµ–**: `RevertService.java`, `BaseController.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€ç”³è¯·APIåŠŸèƒ½å®Œæ•´
- [ ] æ’¤é”€å†å²æŸ¥è¯¢APIå‡†ç¡®
- [ ] æ’¤é”€é¢„è§ˆAPIå®æ—¶æœ‰æ•ˆ
- [ ] æƒé™éªŒè¯ä¸¥æ ¼
- [ ] é”™è¯¯å¤„ç†å‹å¥½

#### 7.3 å®ç°RevertAdminController
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/controller/RevertAdminController.java`
**ä¾èµ–**: `RevertAdminService.java`, `BaseController.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€ç®¡ç†APIåŠŸèƒ½å®Œæ•´
- [ ] æ’¤é”€å®¡æ‰¹æµç¨‹æ­£å¸¸
- [ ] ç³»ç»Ÿå›æ»šAPIå®‰å…¨
- [ ] ç®¡ç†å‘˜æƒé™éªŒè¯ä¸¥æ ¼
- [ ] æ“ä½œå®¡è®¡è®°å½•è¯¦ç»†

#### 7.4 å®ç°SystemRollbackController
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/controller/SystemRollbackController.java`
**ä¾èµ–**: `DataRevertService.java`, `SystemAdminController.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] ç³»ç»Ÿå›æ»šAPIåŠŸèƒ½å®Œæ•´
- [ ] å›æ»šç‚¹ç®¡ç†APIå‡†ç¡®
- [ ] ç³»ç»ŸçŠ¶æ€éªŒè¯APIæœ‰æ•ˆ
- [ ] è¶…çº§æƒé™éªŒè¯ä¸¥æ ¼
- [ ] å›æ»šæ“ä½œå®‰å…¨ä¿éšœ

---

### ğŸ”„ ä»»åŠ¡ 8: æ’¤é”€æƒé™æ§åˆ¶å’Œå®¡æ‰¹æµç¨‹

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: æƒé™å®‰å…¨å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„æƒé™æ§åˆ¶å’Œå®¡æ‰¹æµç¨‹ï¼Œå®ç°æ’¤é”€æƒé™éªŒè¯ã€æ’¤é”€å®¡æ‰¹åˆ†çº§ã€é«˜çº§æ“ä½œå¤šå› å­è®¤è¯ç­‰åŠŸèƒ½ï¼Œç¡®ä¿æ’¤é”€æ“ä½œçš„å®‰å…¨æ€§å’Œåˆè§„æ€§ã€‚
**Constraints**:
- æƒé™éªŒè¯å¿…é¡»åˆ†å±‚åˆ†çº§
- å®¡æ‰¹æµç¨‹å¿…é¡»çµæ´»å¯é…ç½®
- å¤šå› å­è®¤è¯å¿…é¡»å®‰å…¨å¯é 
- æƒé™å§”æ‰˜å¿…é¡»å—æ§ç®¡ç†
- å®¡è®¡æ—¥å¿—å¿…é¡»å®Œæ•´è®°å½•
**_Leverage**: ç°æœ‰çš„PermissionServiceã€æƒé™ç¼–ç ã€å®¡æ‰¹ç³»ç»Ÿã€å¤šå› å­è®¤è¯ã€å®¡è®¡æœåŠ¡
**_Requirements**: éœ€æ±‚85(æ’¤é”€æƒé™æ§åˆ¶)
**Success**:
- æƒé™éªŒè¯æœºåˆ¶å®Œå–„
- å®¡æ‰¹æµç¨‹è§„èŒƒæœ‰æ•ˆ
- å¤šå› å­è®¤è¯å®‰å…¨
- æƒé™å§”æ‰˜ç®¡ç†ä¸¥æ ¼
- å®¡è®¡è®°å½•å®Œæ•´å‡†ç¡®
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™æƒé™æ§åˆ¶çš„å¤±è´¥æµ‹è¯•
2. å®ç°RevertPermissionServiceæƒé™æœåŠ¡
3. å®ç°å®¡æ‰¹æµç¨‹ç®¡ç†
4. å®ç°å¤šå› å­è®¤è¯
5. å®ç°æƒé™å§”æ‰˜ç®¡ç†
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 8.1 åˆ›å»ºRevertPermissionService
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/RevertPermissionService.java`
**ä¾èµ–**: `PermissionService.java`, `UserService.java`, `RoleService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€æƒé™éªŒè¯é€»è¾‘å‡†ç¡®
- [ ] æƒé™åˆ†çº§ç®¡ç†åˆç†
- [ ] æƒé™å§”æ‰˜æœºåˆ¶å®Œå–„
- [ ] æƒé™éªŒè¯æ€§èƒ½ä¼˜åŒ–
- [ ] æƒé™é…ç½®çµæ´»

#### 8.2 å®ç°å®¡æ‰¹æµç¨‹ç®¡ç†
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/ApprovalFlowService.java`
**ä¾èµ–**: `WorkflowEngine.java`, `NotificationService.java`, `ApprovalTaskService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] å®¡æ‰¹æµç¨‹é…ç½®çµæ´»
- [ ] å®¡æ‰¹è·¯ç”±ç­–ç•¥åˆç†
- [ ] å®¡æ‰¹çŠ¶æ€è·Ÿè¸ªå‡†ç¡®
- [ ] å®¡æ‰¹è¶…æ—¶å¤„ç†å®Œå–„
- [ ] å®¡æ‰¹é€šçŸ¥åŠæ—¶

#### 8.3 å®ç°å¤šå› å­è®¤è¯
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/security/MfaRevertService.java`
**ä¾èµ–**: `MfaService.java`, `SecurityContext.java`, `AuthenticationService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] å¤šå› å­è®¤è¯æµç¨‹æ­£ç¡®
- [ ] è®¤è¯æ–¹å¼é…ç½®çµæ´»
- [ ] è®¤è¯å®‰å…¨æ§åˆ¶ä¸¥æ ¼
- [ ] è®¤è¯å¤±è´¥å¤„ç†å®Œå–„
- [ ] è®¤è¯è®°å½•è¯¦ç»†

#### 8.4 å®ç°æƒé™å§”æ‰˜ç®¡ç†
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/PermissionDelegationService.java`
**ä¾èµ–**: `PermissionService.java`, `UserRoleService.java`, `AuditService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æƒé™å§”æ‰˜ç”³è¯·æµç¨‹
- [ ] å§”æ‰˜æƒé™èŒƒå›´æ§åˆ¶
- [ ] å§”æ‰˜æ—¶æ•ˆç®¡ç†ä¸¥æ ¼
- [ ] å§”æ‰˜å®¡è®¡è®°å½•è¯¦ç»†
- [ ] å§”æ‰˜æ’¤é”€æœºåˆ¶æœ‰æ•ˆ

---

### ğŸ”„ ä»»åŠ¡ 9: ç³»ç»Ÿç‰ˆæœ¬å›æ»šåŠŸèƒ½

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: ç³»ç»Ÿæ¶æ„å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„ç³»ç»Ÿç‰ˆæœ¬å›æ»šåŠŸèƒ½ï¼Œå®ç°æ—¶é—´ç‚¹å›æ»šã€æ•°æ®è¡¨å›æ»šã€ç³»ç»ŸçŠ¶æ€æ¢å¤ã€ç¾éš¾æ¢å¤ç­‰åŠŸèƒ½ï¼Œç¡®ä¿ç³»ç»Ÿæ•…éšœæ—¶çš„å¿«é€Ÿæ¢å¤èƒ½åŠ›ã€‚
**Constraints**:
- ç³»ç»Ÿå›æ»šå¿…é¡»ä¿è¯æ•°æ®ä¸€è‡´æ€§
- å›æ»šç‚¹ç®¡ç†å¿…é¡»å®Œæ•´å‡†ç¡®
- ç¾éš¾æ¢å¤å¿…é¡»åŠæ—¶æœ‰æ•ˆ
- å›æ»šæ“ä½œå¿…é¡»å¯ç›‘æ§å¯å›æº¯
- æ•°æ®å®‰å…¨å¿…é¡»ä¸¥æ ¼ä¿éšœ
**_Leverage**: ç°æœ‰çš„æ•°æ®åº“ç®¡ç†å·¥å…·ã€å¤‡ä»½æ¢å¤ç³»ç»Ÿã€ç›‘æ§ç³»ç»Ÿã€ç¾éš¾æ¢å¤æ–¹æ¡ˆ
**_Requirements**: éœ€æ±‚84(æ•°æ®ç‰ˆæœ¬å›æ»š)
**Success**:
- ç³»ç»Ÿç‰ˆæœ¬å›æ»šåŠŸèƒ½å®Œæ•´
- æ—¶é—´ç‚¹å›æ»šå‡†ç¡®å¯é 
- ç¾éš¾æ¢å¤æœºåˆ¶å®Œå–„
- æ•°æ®å®‰å…¨ä¿éšœåˆ°ä½
- å›æ»šç›‘æ§å¥å…¨
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. ç¼–å†™ç³»ç»Ÿå›æ»šçš„å¤±è´¥æµ‹è¯•
2. å®ç°ç³»ç»Ÿå›æ»šç­–ç•¥
3. å®ç°æ—¶é—´ç‚¹å›æ»šåŠŸèƒ½
4. å®ç°ç¾éš¾æ¢å¤æœºåˆ¶
5. å®ç°å›æ»šç›‘æ§å‘Šè­¦
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 9.1 åˆ›å»ºSystemRollbackService
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/SystemRollbackService.java`
**ä¾èµ–**: `DataRevertService.java`, `BackupManager.java`, `DatabaseManager.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] ç³»ç»Ÿå›æ»šç­–ç•¥å®Œæ•´
- [ ] å›æ»šæ“ä½œå®‰å…¨æ§åˆ¶
- [ ] å›æ»šçŠ¶æ€è·Ÿè¸ªå‡†ç¡®
- [ ] å›æ»šæ€§èƒ½ä¼˜åŒ–
- [ ] å›æ»šæ—¥å¿—è®°å½•è¯¦ç»†

#### 9.2 å®ç°æ—¶é—´ç‚¹å›æ»š
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/PointInTimeRollbackService.java`
**ä¾èµ–**: `DatabaseBackupService.java`, `TransactionManager.java`, `AuditService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ—¶é—´ç‚¹é€‰æ‹©çµæ´»
- [ ] å›æ»šèŒƒå›´å¯é…ç½®
- [ ] å›æ»šä¸€è‡´æ€§ä¿è¯
- [ ] å›æ»šé€Ÿåº¦ä¼˜åŒ–
- [ ] å›æ»šéªŒè¯ä¸¥æ ¼

#### 9.3 å®ç°ç¾éš¾æ¢å¤
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/DisasterRecoveryService.java`
**ä¾èµ–**: `BackupStorageService.java`, `ReplicationService.java`, `MonitoringService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] ç¾éš¾æ£€æµ‹æœºåˆ¶
- [ ] å¿«é€Ÿæ¢å¤æµç¨‹
- [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯
- [ ] ç³»ç»ŸçŠ¶æ€æ¢å¤
- [ ] æ¢å¤ç»“æœéªŒè¯

#### 9.4 å®ç°å›æ»šç›‘æ§å‘Šè­¦
**æ–‡ä»¶**: `backend/src/main/java/com/campus/marketplace/service/RollbackMonitorService.java`
**ä¾èµ–**: `MonitorService.java`, `AlertService.java`, `NotificationService.java`
**éªŒæ”¶æ ‡å‡†**:
- [ ] å›æ»šè¿‡ç¨‹ç›‘æ§
- [ ] çŠ¶æ€æŒ‡æ ‡æ”¶é›†
- [ ] å¼‚å¸¸å‘Šè­¦åŠæ—¶
- [ ] è¿›åº¦æŠ¥å‘Šå‡†ç¡®
- [ ] ç›‘æ§æ•°æ®å­˜å‚¨

---

### ğŸ”„ ä»»åŠ¡ 10: æ’¤é”€ç³»ç»Ÿæµ‹è¯•å’Œè´¨é‡ä¿è¯

**_Prompt**: Implement the task for spec data-revert-system, first run spec-workflow-guide to get the workflow guide then implement the task:
```text
**Role**: æµ‹è¯•è´¨é‡å·¥ç¨‹å¸ˆ
**Task**: å¼€å‘æ•°æ®æ’¤é”€ç³»ç»Ÿçš„æµ‹è¯•å’Œè´¨é‡ä¿è¯åŠŸèƒ½ï¼ŒåŒ…æ‹¬åŠŸèƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€ç¾éš¾æ¢å¤æµ‹è¯•ç­‰åŠŸèƒ½ï¼Œç¡®ä¿æ’¤é”€ç³»ç»Ÿçš„å¯é æ€§å’Œå®‰å…¨æ€§ã€‚
**Constraints**:
- æµ‹è¯•è¦†ç›–ç‡å¿…é¡»â‰¥90%
- å®‰å…¨æµ‹è¯•å¿…é¡»è¦†ç›–æ‰€æœ‰æ”»å‡»åœºæ™¯
- æ€§èƒ½æµ‹è¯•å¿…é¡»æ»¡è¶³è®¾è®¡è¦æ±‚
- ç¾éš¾æ¢å¤æµ‹è¯•å¿…é¡»éªŒè¯æœ‰æ•ˆæ€§
- è´¨é‡é—¨ç¦å¿…é¡»ä¸¥æ ¼æ‰§è¡Œ
**_Leverage**: ç°æœ‰çš„æµ‹è¯•æ¡†æ¶ã€å®‰å…¨æµ‹è¯•å·¥å…·ã€æ€§èƒ½æµ‹è¯•å·¥å…·ã€ç¾éš¾æ¢å¤æ¼”ç»ƒ
**_Requirements**: è¦†ç›–æ‰€æœ‰æ’¤é”€åŠŸèƒ½çš„æµ‹è¯•
**Success**:
- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- å®‰å…¨æµ‹è¯•æ— é«˜å±æ¼æ´
- æ€§èƒ½æŒ‡æ ‡æ»¡è¶³è¦æ±‚
- è´¨é‡é—¨ç¦æœ‰æ•ˆ
**Instructions**: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®æ–½ï¼š
1. è®¾è®¡æµ‹è¯•ç­–ç•¥å’Œç”¨ä¾‹
2. å®ç°åŠŸèƒ½æµ‹è¯•
3. å®ç°å®‰å…¨æµ‹è¯•
4. å®ç°æ€§èƒ½æµ‹è¯•
5. å®ç°ç¾éš¾æ¢å¤æµ‹è¯•
6. åœ¨tasks.mdä¸­å°†æ­¤ä»»åŠ¡æ ‡è®°ä¸º[-]è¿›è¡Œä¸­ï¼Œå®Œæˆåæ ‡è®°ä¸º[x]
```

#### 10.1 åˆ›å»ºåŠŸèƒ½æµ‹è¯•å¥—ä»¶
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/revert/RevertServiceTest.java`
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/revert/GoodsRevertStrategyTest.java`
**ä¾èµ–**: `JUnit5.java`, `Mockito.java`, `Spring Boot Test`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€åŠŸèƒ½æµ‹è¯•å®Œæ•´
- [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•è¦†ç›–
- [ ] å¼‚å¸¸åœºæ™¯æµ‹è¯•æœ‰æ•ˆ
- [ ] é›†æˆæµ‹è¯•è¦†ç›–å…¨é¢
- [ ] æµ‹è¯•æ‰§è¡Œæ•ˆç‡é«˜

#### 10.2 åˆ›å»ºå®‰å…¨æµ‹è¯•å¥—ä»¶
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/security/RevertSecurityTest.java`
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/security/RevertPermissionTest.java`
**ä¾èµ–**: `Spring Security Test.java`, `å®‰å…¨æµ‹è¯•å·¥å…·`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æƒé™éªŒè¯æµ‹è¯•ä¸¥æ ¼
- [ ] æ•°æ®å®‰å…¨æµ‹è¯•å®Œå–„
- [ ] è®¤è¯æµ‹è¯•å‡†ç¡®
- [ ] æ”»å‡»é˜²å¾¡æµ‹è¯•æœ‰æ•ˆ
- [ ] å®‰å…¨æ¼æ´æ‰«æé€šè¿‡

#### 10.3 åˆ›å»ºæ€§èƒ½æµ‹è¯•å¥—ä»¶
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/performance/RevertPerformanceTest.java`
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/performance/SystemRollbackTest.java`
**ä¾èµ–**: `JMH.java`, `æ€§èƒ½æµ‹è¯•å·¥å…·`
**éªŒæ”¶æ ‡å‡†**:
- [ ] æ’¤é”€æ“ä½œæ€§èƒ½è¾¾æ ‡
- [ ] ç³»ç»Ÿå›æ»šæ€§èƒ½æ»¡è¶³è¦æ±‚
- [ ] å¤§æ‰¹é‡æ•°æ®å¤„ç†èƒ½åŠ›
- [ ] å¹¶å‘æ’¤é”€æ€§èƒ½ç¨³å®š
- [ ] èµ„æºä½¿ç”¨æ§åˆ¶åˆç†

#### 10.4 åˆ›å»ºç¾éš¾æ¢å¤æµ‹è¯•
**æ–‡ä»¶**: `backend/src/test/java/com/campus/marketplace/disaster/DisasterRecoveryTest.java`
**ä¾èµ–**: `ç¾éš¾æ¢å¤æ¼”ç»ƒç¯å¢ƒ`, `æµ‹è¯•æ•°æ®ç®¡ç†`
**éªŒæ”¶æ ‡å‡†**:
- [ ] ç¾éš¾åœºæ™¯è¦†ç›–å…¨é¢
- [ ] æ¢å¤æµç¨‹éªŒè¯æœ‰æ•ˆ
- [ ] æ•°æ®å®Œæ•´æ€§ä¿è¯
- [ ] æ¢å¤æ—¶é—´è¾¾æ ‡
- [ ] æ¢å¤æ–¹æ¡ˆå¯é 

---

## ä»»åŠ¡ä¾èµ–å…³ç³»

```mermaid
gantt
    title æ•°æ®æ’¤é”€ç³»ç»Ÿå¼€å‘æ—¶é—´çº¿
    dateFormat  YYYY-MM-DD
    section åŸºç¡€æ¶æ„
    ä»»åŠ¡1ï¼šå®¡è®¡æ—¥å¿—æ‰©å±•å¤‡ä»½     :done, task1, 2025-11-05, 2d
    section ç­–ç•¥æ¶æ„
    ä»»åŠ¡2ï¼šæ’¤é”€ç­–ç•¥å·¥å‚         :active, task2, after task1, 2d
    section ä¸šåŠ¡ç­–ç•¥
    ä»»åŠ¡3ï¼šå•†å“æ’¤é”€ç­–ç•¥         :task3, after task2, 2d
    ä»»åŠ¡4ï¼šè®¢å•æ’¤é”€ç­–ç•¥         :task4, after task2, 2d
    ä»»åŠ¡5ï¼šç”¨æˆ·æ’¤é”€ç­–ç•¥         :task5, after task2, 2d
    section æ‰¹é‡å¤„ç†
    ä»»åŠ¡6ï¼šæ‰¹é‡æ“ä½œæ’¤é”€         :task6, after task3, 2d
    section APIæ¥å£
    ä»»åŠ¡7ï¼šæ’¤é”€æ§åˆ¶å™¨API        :task7, after task6, 2d
    section å®‰å…¨æ§åˆ¶
    ä»»åŠ¡8ï¼šæƒé™æ§åˆ¶å®¡æ‰¹         :task8, after task7, 2d
    section ç³»ç»Ÿå›æ»š
    ä»»åŠ¡9ï¼šç³»ç»Ÿç‰ˆæœ¬å›æ»š         :task9, after task8, 2d
    section è´¨é‡ä¿è¯
    ä»»åŠ¡10ï¼šæµ‹è¯•è´¨é‡ä¿è¯       :task10, after task9, 3d
```

## è´¨é‡æ£€æŸ¥æ¸…å•

### æ•°æ®å®‰å…¨æ£€æŸ¥
- [ ] **ç¬¬0æ­¥å¤ç”¨æ£€æŸ¥**: å¤ç”¨ç°æœ‰å…³é”®ç»„ä»¶ï¼Œé¿å…å®‰å…¨æ¼æ´
- [ ] **ç¬¬1æ­¥æµ‹è¯•å…ˆè¡Œ**: æ‰€æœ‰å®‰å…¨åŠŸèƒ½å…ˆå†™æµ‹è¯•ç”¨ä¾‹
- [ ] **æ•°æ®å®Œæ•´æ€§**: æ’¤é”€æ“ä½œå¿…é¡»ä¿è¯æ•°æ®ä¸€è‡´æ€§
- [ ] **è®¿é—®æ§åˆ¶**: æ’¤é”€æ“ä½œæƒé™éªŒè¯å¿…é¡»ä¸¥æ ¼
- [ ] **å®¡è®¡å®Œå–„**: æ‰€æœ‰æ’¤é”€æ“ä½œå¿…é¡»å®Œæ•´è®°å½•

### å¯é æ€§æ£€æŸ¥
- [ ] **å¤‡ä»½æœºåˆ¶**: æ•°æ®å¤‡ä»½å¿…é¡»å®Œæ•´ä¸”å¯éªŒè¯
- [ ] **äº‹åŠ¡ç®¡ç†**: æ’¤é”€æ“ä½œäº‹åŠ¡å¿…é¡»ä¸¥æ ¼æ§åˆ¶
- [ ] **å¼‚å¸¸å¤„ç†**: æ’¤é”€å¤±è´¥å¿…é¡»ä¸å½±å“ç³»ç»Ÿç¨³å®š
- [ ] **å›æ»šé¡ºåº**: æ‰¹é‡æ’¤é”€å¿…é¡»æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œ
- [ ] **çŠ¶æ€ç®¡ç†**: æ’¤é”€çŠ¶æ€å¿…é¡»å‡†ç¡®è·Ÿè¸ª

### æ€§èƒ½æ£€æŸ¥
- [ ] **å“åº”æ—¶é—´**: æ’¤é”€æ“ä½œå¯åŠ¨æ—¶é—´<500ms
- [ ] **å¤„ç†èƒ½åŠ›**: å•æ¬¡æ’¤é”€å¤„ç†é€Ÿåº¦â‰¥100æ¡/ç§’
- [ ] **å¹¶å‘æ”¯æŒ**: æ”¯æŒ100+å¹¶å‘æ’¤é”€è¯·æ±‚
- [ ] **èµ„æºä½¿ç”¨**: å†…å­˜å’ŒCPUä½¿ç”¨ç‡åˆç†å¯æ§
- [ ] **ç¼“å­˜ä¼˜åŒ–**: çƒ­ç‚¹æ•°æ®ç¼“å­˜å‘½ä¸­ç‡â‰¥80%

### å¯æ‰©å±•æ€§æ£€æŸ¥
- [ ] **ç­–ç•¥æ‰©å±•**: æ–°æ’¤é”€ç±»å‹æ˜“äºæ·»åŠ 
- [ ] **é…ç½®çµæ´»**: æ’¤é”€ç­–ç•¥é…ç½®å¯åŠ¨æ€è°ƒæ•´
- [ ] **æ¥å£è§„èŒƒ**: æ’¤é”€æ¥å£è®¾è®¡æ˜“äºæ‰©å±•
- [ ] **æ’ä»¶åŒ–**: æ”¯æŒç¬¬ä¸‰æ–¹æ’¤é”€ç­–ç•¥æ’ä»¶
- [ ] **ç‰ˆæœ¬å…¼å®¹**: ç³»ç»Ÿå‡çº§ä¸å½±å“ç°æœ‰æ’¤é”€åŠŸèƒ½

### åˆè§„æ€§æ£€æŸ¥
- [ ] **æƒé™åˆ†çº§**: æ’¤é”€æƒé™æŒ‰é£é™©ç­‰çº§åˆ†çº§
- [ ] **å®¡æ‰¹æµç¨‹**: é«˜é£é™©æ’¤é”€å¿…é¡»æœ‰å®¡æ‰¹
- [ ] **å¤šå› å­è®¤è¯**: æ•æ„Ÿæ’¤é”€å¿…é¡»å¤šå› å­è®¤è¯
- [ ] **æ•°æ®éšç§**: æ’¤é”€è¿‡ç¨‹ä¸èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯
- [ ] **æ“ä½œå¯è¿½æº¯**: æ¯ä¸ªæ’¤é”€æ“ä½œéƒ½å¯å®¡è®¡è¿½è¸ª

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- âœ… æ‰€æœ‰å®ä½“ç±»å‹æ”¯æŒæ’¤é”€æ“ä½œ
- âœ… æ’¤é”€æ“ä½œåŠŸèƒ½å®Œæ•´ä¸”å‡†ç¡®
- âœ… æ‰¹é‡æ’¤é”€æœºåˆ¶ç¨³å®šå¯é 
- âœ… ç³»ç»Ÿå›æ»šåŠŸèƒ½å®‰å…¨æœ‰æ•ˆ
- âœ… æƒé™æ§åˆ¶å’Œå®¡æ‰¹æµç¨‹å®Œå–„

### å®‰å…¨éªŒæ”¶
- âœ… æ’¤é”€æƒé™éªŒè¯ä¸¥æ ¼æœ‰æ•ˆ
- âœ… æ•°æ®å®‰å…¨ä¿éšœåˆ°ä½
- âœ… è®¿é—®æ§åˆ¶æœºåˆ¶å®Œå–„
- âœ… å®¡è®¡æ—¥å¿—è®°å½•å®Œæ•´
- âœ… å®‰å…¨æµ‹è¯•æ— é«˜å±æ¼æ´

### æ€§èƒ½éªŒæ”¶
- âœ… æ’¤é”€æ“ä½œå“åº”æ—¶é—´<500ms
- âœ… å¤§æ‰¹é‡æ’¤é”€å¤„ç†èƒ½åŠ›è¾¾æ ‡
- âœ… å¹¶å‘æ’¤é”€æ”¯æŒç¨³å®š
- âœ… ç³»ç»Ÿèµ„æºä½¿ç”¨åˆç†
- âœ… ç¼“å­˜ä¼˜åŒ–æ•ˆæœæ˜æ˜¾

### å¯é æ€§éªŒæ”¶
- âœ… æ’¤é”€æˆåŠŸç‡â‰¥99.9%
- âœ… æ•°æ®ä¸€è‡´æ€§ä¿è¯æœ‰æ•ˆ
- âœ… å¼‚å¸¸æ¢å¤æœºåˆ¶å®Œå–„
- âœ… ç¾éš¾æ¢å¤èƒ½åŠ›å¯é 
- âœ… ç³»ç»Ÿé«˜å¯ç”¨æ€§ä¿éšœ

### å¯ç»´æŠ¤æ€§éªŒæ”¶
- âœ… ç­–ç•¥æ¶æ„æ¸…æ™°æ˜“æ‰©å±•
- âœ… é…ç½®ç®¡ç†çµæ´»è§„èŒƒ
- âœ… ç›‘æ§å‘Šè­¦åŠæ—¶å‡†ç¡®
- âœ… æ–‡æ¡£èµ„æ–™å®Œæ•´è¯¦ç»†
- âœ… æµ‹è¯•è´¨é‡è¾¾æ ‡è¦†ç›–å…¨é¢

---

**å®æ–½è¯´æ˜**: æ•°æ®æ’¤é”€ç³»ç»Ÿæ¶‰åŠæ•°æ®å®‰å…¨ï¼Œæ¯ä¸ªä»»åŠ¡å®Œæˆåå¿…é¡»è¿›è¡Œä¸¥æ ¼çš„å®‰å…¨æµ‹è¯•å’Œæ•°æ®éªŒè¯ã€‚ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»å¿…é¡»ä¸¥æ ¼éµå¾ªï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨å¯é ã€‚æ’¤é”€æ“ä½œæ˜¯ä¸å¯é€†æ“ä½œï¼Œè¯·åœ¨å®æ–½è¿‡ç¨‹ä¸­ä¸¥æ ¼æŠŠæ§è´¨é‡ã€‚
