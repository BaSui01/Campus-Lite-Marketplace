# Spec 14: 黑名单功能 - 需求文档

> **功能**: 用户黑名单管理  
> **作者**: BaSui 😎  
> **日期**: 2025-11-06  
> **优先级**: P3 → P2（用户体验提升）  
> **预计工时**: 1-2天

---

## 📋 功能概述

为用户提供**黑名单管理**功能，允许用户自主：
- 🚫 拉黑骚扰用户
- 👀 查看黑名单列表
- ✅ 解除拉黑
- 🛡️ 自动屏蔽黑名单用户的消息和互动

**目标**：提升用户体验，减少骚扰，增强平台安全感。

---

## 🎯 用户故事

### 故事1：拉黑用户
**作为** 用户  
**我想要** 拉黑发送垃圾消息的用户  
**这样** 我不会再收到Ta的任何消息

**验收标准**：
- ✅ 可以在用户主页点击"拉黑"按钮
- ✅ 可以在消息页面直接拉黑
- ✅ 拉黑后立即生效
- ✅ 有二次确认弹窗

---

### 故事2：查看黑名单
**作为** 用户  
**我想要** 查看我拉黑的所有用户  
**这样** 我可以管理我的黑名单

**验收标准**：
- ✅ 展示黑名单用户列表
- ✅ 显示用户头像、昵称、拉黑时间
- ✅ 支持搜索和筛选
- ✅ 分页展示

---

### 故事3：解除拉黑
**作为** 用户  
**我想要** 解除对某用户的拉黑  
**这样** 我可以重新与Ta互动

**验收标准**：
- ✅ 可以在黑名单列表中解除拉黑
- ✅ 有二次确认弹窗
- ✅ 解除后立即生效

---

### 故事4：屏蔽效果
**作为** 用户  
**我想要** 拉黑后不再看到Ta的任何内容  
**这样** 我的使用体验更清净

**验收标准**：
- ✅ 不会收到Ta的站内消息
- ✅ 不会看到Ta的评论和回复
- ✅ 不会收到Ta的点赞/关注通知
- ✅ Ta的帖子不会出现在我的动态流

---

## 🔧 功能需求

### 1. 拉黑用户

**入口**：
- 用户主页：用户信息卡片右上角
- 消息页面：聊天界面头部
- 举报页面：举报成功后推荐拉黑

**操作流程**：
```
1. 点击"拉黑"按钮
2. 弹出确认对话框："确定要拉黑该用户吗？"
3. 点击"确定"
4. 提示"已拉黑"
5. 按钮变为"已拉黑"状态
```

**业务规则**：
- 拉黑后双向生效（对方也无法给我发消息）
- 拉黑不会通知对方
- 拉黑记录永久保存（除非主动解除）

---

### 2. 查看黑名单

**页面路径**：`/settings/blacklist`

**展示内容**：
- 用户头像
- 用户昵称
- 用户ID（小字）
- 拉黑时间
- "解除拉黑"按钮

**功能**：
- 搜索用户（按昵称/ID）
- 按拉黑时间排序
- 分页加载（每页20条）

---

### 3. 解除拉黑

**操作流程**：
```
1. 在黑名单列表点击"解除拉黑"
2. 弹出确认对话框："确定要解除拉黑吗？"
3. 点击"确定"
4. 提示"已解除拉黑"
5. 从列表中移除
```

**业务规则**：
- 解除后立即生效
- 可以重新拉黑同一用户
- 解除不会通知对方

---

### 4. 黑名单屏蔽效果

**自动屏蔽**：
- 📬 **站内消息**：对方无法给我发消息
- 💬 **评论回复**：我看不到对方的评论和回复
- 👍 **点赞关注**：不会收到对方的点赞/关注通知
- 📰 **动态流**：对方的帖子不会出现在我的动态流
- 🔍 **搜索**：搜索结果中不显示对方的内容

**双向屏蔽**：
- 对方也无法给我发消息
- 对方看不到我的部分内容（可配置）

---

### 5. 检查拉黑状态

**场景**：
- 访问用户主页时检查是否已拉黑
- 发送消息前检查是否被拉黑
- 点赞/评论前检查状态

**API**：
```
GET /api/blacklist/check/{userId}
Response: { isBlocked: true/false }
```

---

## 📊 数据模型（前端）

### BlacklistUser（黑名单用户）

```typescript
interface BlacklistUser {
  id: number;                    // 黑名单记录ID
  blockedUserId: number;         // 被拉黑的用户ID
  blockedUserName: string;       // 被拉黑的用户昵称
  blockedUserAvatar?: string;    // 被拉黑的用户头像
  createdAt: string;             // 拉黑时间
  reason?: string;               // 拉黑原因（可选）
}
```

### BlacklistListResponse（黑名单列表响应）

```typescript
interface BlacklistListResponse {
  content: BlacklistUser[];
  totalElements: number;
  totalPages: number;
  number: number;
  size: number;
}
```

---

## 🎨 UI/UX 设计

### 页面1：黑名单管理

**路径**：`/settings/blacklist`

**布局**：
```
┌─────────────────────────────────────┐
│ 🚫 黑名单管理                        │
├─────────────────────────────────────┤
│                                      │
│ 搜索: [___________] 🔍              │
│                                      │
│ ┌─────────────────────────────────┐ │
│ │ 👤 [头像] 张三 (ID: 12345)      │ │
│ │    拉黑时间: 2025-11-05 14:30  │ │
│ │    [解除拉黑]                   │ │
│ └─────────────────────────────────┘ │
│                                      │
│ ┌─────────────────────────────────┐ │
│ │ 👤 [头像] 李四 (ID: 67890)      │ │
│ │    拉黑时间: 2025-11-03 10:15  │ │
│ │    [解除拉黑]                   │ │
│ └─────────────────────────────────┘ │
│                                      │
│ [ 1 ] 2  3  下一页 >                │
│                                      │
│ 💡 提示：拉黑后对方无法给你发消息    │
└─────────────────────────────────────┘
```

---

### 组件1：拉黑按钮（用户主页）

**位置**：用户信息卡片右上角

**状态**：
- 未拉黑：显示"拉黑"按钮（红色边框）
- 已拉黑：显示"已拉黑"（灰色背景，禁用状态）

**交互**：
```
点击"拉黑" → 弹窗确认 → 提示成功 → 按钮变为"已拉黑"
```

---

### 组件2：确认对话框

**拉黑确认**：
```
┌─────────────────────────────────────┐
│ ⚠️  确认拉黑                         │
├─────────────────────────────────────┤
│                                      │
│ 确定要拉黑用户 "张三" 吗？          │
│                                      │
│ 拉黑后：                            │
│ • 对方无法给你发消息                │
│ • 你看不到对方的评论和回复          │
│ • 你不会收到对方的通知              │
│                                      │
│ [取消]  [确定拉黑]                  │
└─────────────────────────────────────┘
```

**解除拉黑确认**：
```
┌─────────────────────────────────────┐
│ ℹ️  解除拉黑                         │
├─────────────────────────────────────┤
│                                      │
│ 确定要解除对 "张三" 的拉黑吗？      │
│                                      │
│ 解除后对方可以重新与你互动。        │
│                                      │
│ [取消]  [确定解除]                  │
└─────────────────────────────────────┘
```

---

## 🔌 后端API对接

### 已有API（BlacklistController）

```typescript
// 1. 拉黑用户
POST /api/blacklist/block/{blockedUserId}
Response: { success: true, message: "拉黑成功" }

// 2. 解除拉黑
DELETE /api/blacklist/unblock/{blockedUserId}
Response: { success: true, message: "已解除拉黑" }

// 3. 查看黑名单
GET /api/blacklist/list?page=0&size=20
Response: {
  content: [
    {
      id: 1,
      blockedUserId: 123,
      blockedUserName: "张三",
      blockedUserAvatar: "https://...",
      createdAt: "2025-11-05T14:30:00Z"
    }
  ],
  totalElements: 10,
  totalPages: 1,
  number: 0,
  size: 20
}

// 4. 检查是否已拉黑
GET /api/blacklist/check/{blockedUserId}
Response: { isBlocked: true }
```

---

## ✅ 验收标准

### 功能验收

- ✅ 可以拉黑用户
- ✅ 可以查看黑名单列表
- ✅ 可以解除拉黑
- ✅ 可以搜索黑名单用户
- ✅ 拉黑后看不到对方的消息和内容

### 体验验收

- ✅ 拉黑/解除拉黑有二次确认
- ✅ 操作成功有Toast提示
- ✅ 黑名单列表加载快速（< 1秒）
- ✅ 响应式设计（手机/平板/桌面）

### 安全验收

- ✅ 只能拉黑其他用户（不能拉黑自己）
- ✅ 拉黑后对方无法绕过限制
- ✅ 黑名单数据不会泄露

---

## 🚫 非功能性需求

### 安全性
- 🔒 用户只能管理自己的黑名单
- 🔒 拉黑操作需要登录
- 🔒 黑名单列表不可被他人查看

### 可用性
- 📱 响应式设计
- ♿ 无障碍支持（键盘导航）
- 🌍 国际化支持（中英文）

### 性能
- ⚡ 黑名单列表加载 < 1秒
- ⚡ 拉黑/解除操作响应 < 1秒
- ⚡ 黑名单检查 < 500ms

---

## 📝 边界与限制

### 包含范围
- ✅ 拉黑/解除拉黑用户
- ✅ 查看黑名单列表
- ✅ 搜索黑名单用户
- ✅ 检查拉黑状态
- ✅ 自动屏蔽黑名单用户的消息和内容

### 不包含范围
- ❌ 拉黑群组/话题（只针对用户）
- ❌ 黑名单原因管理（后续扩展）
- ❌ 黑名单统计分析（管理端功能）
- ❌ 自动拉黑规则（AI功能）

---

## 🔄 未来扩展

### Phase 2（可选）
- 📝 拉黑原因标注
- 📊 黑名单统计（被拉黑次数）
- 🤖 智能推荐拉黑（AI识别骚扰用户）
- 🔔 拉黑提醒（对方多次尝试联系时提醒）

---

## 🎯 成功指标

### 业务指标
- 📊 黑名单功能使用率 > 20%
- 📊 用户投诉（骚扰）减少 > 40%
- 📊 用户留存率提升 > 5%

### 技术指标
- ⚡ 黑名单列表加载 < 1秒
- ✅ API成功率 > 99%
- 🐛 Bug率 < 1%

---

## 🔗 关联功能

- **举报功能**：举报成功后推荐拉黑
- **消息功能**：拉黑后自动屏蔽消息
- **通知功能**：拉黑后不再收到通知
- **社区功能**：拉黑后看不到对方的帖子/评论

---

**需求确认**: ✅ 待评审  
**下一步**: 创建设计文档 (design.md)
