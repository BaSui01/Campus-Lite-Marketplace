# 开发工作流规范

> **项目标准化开发流程** - 全局配置 + 功能规格 + TDD实现  
> **更新**: 2025-11-02

---

## 📋 工作流概览

### 核心理念
- **分层设计**：全局配置与功能实现分离
- **避免重复**：通用内容集中管理，功能文档专一专注  
- **规范驱动**：文档先行，测试验证，质量为本
- **持续交付**：小步快跑，频繁集成，快速反馈

### 工作流结构
```
全局配置（一次性） → 功能规格（每个功能） → TDD实现（每个任务）
     ↓                ↓                      ↓
tech.md           docs/specs/N/           十步TDD流程
structure.md       ├── requirements.md    编写测试 → 实现 → 重构
                   ├── design.md
                   └── tasks.md
```

---

## 📁 文档结构规范

### 全局配置文件（项目级，只需配置一次）

#### tech.md - 技术规范
```
🛠️ 技术栈：Spring Boot + Vue3 + MySQL + Redis
📦 依赖管理：统一依赖版本，避免重复功能
🔧 开发工具：IDE配置、代码检查、自动化脚本  
📊 性能指标：响应时间、并发能力、资源占用
🧪 测试策略：测试分层和工具栈选择
```

#### structure.md - 结构规范
```
📂 目录组织：标准化的项目目录结构
🏷️ 命名规范：文件、包、类的命名约定
📥 导入模式：Java/Vue的导入顺序规则
🎯 模块边界：核心vs扩展、稳定vs实验模块划分
📏 代码组织：单一职责、高内聚低耦合原则
```

### 功能规格文件（每个新功能）

#### requirements.md - 需求规格书
```
📋 功能需求：用户故事、业务场景、核心功能
🎯 验收标准：可测试的具体验收条件
🔒 业务规则：业务逻辑约束和限制条件  
🎨 用户体验：界面交互和用户体验需求
```
**注意**：不包含技术选型、性能要求等全局内容

#### design.md - 设计文档
```
🏗️ 功能架构：这个功能的具体模块设计
📦 组件复用：如何利用现有组件实现功能
🔄 数据流：功能内部的数据流转设计
🐛 异常处理：功能相关的异常场景处理
```
**注意**：引用全局 tech.md 中的技术栈，不要重复说明

#### tasks.md - 任务分解
```
📝 开发任务：具体的实现步骤和子任务
🎯 实现细节：每个任务的具体实现要点
📁 文件清单：需要创建/修改的具体文件
🔄 依赖关系：任务间的先后顺序和依赖
```
**注意**：引用全局 structure.md 中的结构规范

---

## 🔄 完整开发流程

### 阶段1：全局初始化（项目启动时）

#### 1.1 配置全局技术规范
```bash
# 创建根目录技术规范文件
touch tech.md structure.md
```

#### 1.2 设定技术栈和标准
- 选择 Spring Boot + Vue3 技术栈
- 定义依赖管理原则（Jackson统一JSON，Logback统一日志等）
- 确定代码质量标准（测试覆盖率≥85%）

#### 1.3 规范项目结构
- 定义标准目录组织方式
- 设定命名规范和导入顺序
- 划分模块边界和依赖方向

### 阶段2：功能开发（每个新功能）

#### 2.1 需求分析 - 编写 requirements.md
```
用户故事：As a 用户, I want 发布二手物品, so that 能方便交易
验收标准：WHEN 用户填写完整表单 THEN 系统 SHALL 保存物品信息
业务规则：物品标题必填、价格大于0、至少上传一张图片
```

#### 2.2 架构设计 - 编写 design.md
```
功能架构：GoodsController → GoodsService → GoodsMapper
组件复用：继承 BaseEntity，复用 ValidationUtil，引用 UserService
数据流：前端请求 → 参数校验 → 业务处理 → 数据库保存 → 响应返回
```

#### 2.3 任务分解 - 编写 tasks.md
```
[ ] 1. 编写 GoodsServiceTest 测试用例
[ ] 2. 创建 Goods 实体类（继承 BaseEntity）
[ ] 3. 实现 GoodsMapper 接口
[ ] 4. 开发 GoodsService 业务逻辑
[ ] 5. 创建 GoodsController API
```

#### 2.4 获取审批
```
使用审批工具提交：
- 标题：Goods功能开发审批
- 文件：docs/specs/3/requirements.md, design.md, tasks.md
- 类型：文档审批
```

### 阶段3：TDD实现（遵循十步流程）

#### 3.1 复用检查（第0步）
```
🔍 搜索现有组件：是否已有 BaseEntity？
📦 依赖检查：是否需要新的依赖？
🔄 重复检测：是否存在相似功能？
```

#### 3.2 十步TDD开发
```
🔴 第1步：编写测试 → 定义预期行为
🟢 第2步：编写实体 → 数据结构基础
🟢 第3步：编写DTO → 数据传输对象
🟢 第4步：编写Mapper → 数据库查询接口
🟢 第5步：编写Service接口 → 业务逻辑契约
🟢 第6步：编写Service实现 → 业务逻辑实现
🟢 第7步：编写Controller → API接口层
🔵 第8步：运行测试 → 验证功能完整性
🔵 第9步：重构优化 → 提升代码质量
```

---

## 📊 质量保障

### 文档质量检查
- [ ] requirements.md 专注功能需求，不含技术选型
- [ ] design.md 专注功能架构，引用全局技术栈
- [ ] tasks.md 专注实现任务，遵循结构规范
- [ ] 无重复内容，通用信息已集中管理

### 开发质量检查  
- [ ] 复用检查完成，90%以上代码复用现有组件
- [ ] TDD流程遵循，测试覆盖率≥85%
- [ ] 全局规范引用，技术栈和结构保持一致
- [ ] 文档同步更新，实现与规格保持一致

---

## 🚀 实战示例

### 示例：开发商品发布功能

#### 步骤1：创建功能规格
```bash
mkdir docs/specs/3
cd docs/specs/3
```

编写 requirements.md（只关注功能需求）：
```markdown
# 商品发布功能需求

## 用户故事
As a 用户, I want 发布二手物品, so that 能方便交易

## 验收标准
1. WHEN 用户填写完整表单 THEN 系统 SHALL 保存物品信息
2. WHEN 价格小于等于0 THEN 系统 SHALL 提示错误
3. WHEN 未上传图片 THEN 系统 SHALL 要求至少一张图片
```

编写 design.md（只关注功能设计）：
```markdown
# 商品发布功能设计

## 功能架构
GoodsController → GoodsService → GoodsMapper

## 组件复用  
- 继承 BaseEntity 获得基础字段
- 使用 ValidationUtil 进行参数校验
- 引用 UserService 获取用户信息
```

编写 tasks.md（只关注实现任务）：
```markdown
# 商品发布功能任务

## 实现任务
[ ] 1. 编写 GoodsServiceTest 测试用例
[ ] 2. 创建 Goods 实体类（继承 BaseEntity）  
[ ] 3. 实现 GoodsMapper 接口（参考基础Mapper模式）
[ ] 4. 开发 GoodsService 业务逻辑
[ ] 5. 创建 GoodsController API（遵循API规范）
```

#### 步骤2：获取审批
```
提交审批请求，引用三个文档文件
```

#### 步骤3：TDD实现
```bash
# 遵循十步流程开发
# 第0步：复用检查
# 第1步：编写测试
# ...
# 第9步：重构优化
```

---

## 💡 最佳实践

### 规范原则
- 📁 **关注点分离**：全局配置与功能需求分离
- 🔄 **避免重复**：通用信息集中管理，禁止在各功能中重复
- 🎯 **专一专注**：每个文档只关注自己的职责范围
- 📚 **引用明确**：通过明确的引用链接到全局文档

### 开发节奏
- 🚀 **小步快跑**：每个功能独立开发和测试
- 📊 **质量优先**：先写文档，再做开发，最后测试
- 🔄 **持续集成**：完成功能立即提交，保持代码同步
- 📝 **文档同步**：代码变更时同步更新相关文档

---

## 🔗 相关文档

- [CLAUDE.md](../../CLAUDE.md) - AI开发规范和TDD流程
- [tech.md](../../tech.md) - 全局技术规范  
- [structure.md](../../structure.md) - 全局结构规范
- [SPEC_INDEX.md](SPEC_INDEX.md) - 需求编号分配器

---

## 📝 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| 1.0.0 | 2025-11-02 | 初始版本，定义分层开发工作流 |

---

**遵循此工作流，确保项目开发规范有序，质量可追溯！** 🎯✨
