# 前端管理端 - 手动测试指南

> **测试日期**: 2025-11-08  
> **测试人**: BaSui 😎  
> **测试目标**: 验证所有新增功能正常工作  
> **测试类型**: 手动测试 + 功能验证

---

## 📋 测试清单总览

| 测试项 | 状态 | 优先级 | 预计时间 |
|--------|------|--------|---------|
| **1. 项目启动** | ⏳ | 🔴 P0 | 5 分钟 |
| **2. 新增页面** | ⏳ | 🔴 P0 | 20 分钟 |
| **3. Token 刷新** | ⏳ | 🔴 P0 | 10 分钟 |
| **4. 多 Tab 同步** | ⏳ | 🔴 P0 | 10 分钟 |
| **5. 错误处理** | ⏳ | 🔴 P0 | 10 分钟 |
| **6. 权限缓存** | ⏳ | 🟡 P1 | 5 分钟 |

**总预计时间**: 约 60 分钟

---

## 🚀 测试准备

### 前置条件

- ✅ 后端服务已启动（`http://localhost:8200`）
- ✅ 数据库已初始化
- ✅ 测试账号已创建
- ✅ 前端依赖已安装

### 启动项目

```bash
# 1. 启动后端（新终端）
cd D:\code\campus-lite-marketplace\backend
mvn spring-boot:run

# 2. 启动前端（新终端）
cd D:\code\campus-lite-marketplace\frontend\packages\admin
npm run dev

# 3. 打开浏览器
# 访问：http://localhost:5173/admin/login
```

### 测试账号

| 账号类型 | 用户名 | 密码 | 权限 |
|---------|--------|------|------|
| **管理员** | admin | admin123 | 所有权限 |
| **普通用户** | user | user123 | 基础权限 |

---

## 🧪 测试步骤

### 1️⃣ 项目启动测试 ✅

#### 测试目标
- 验证项目能正常编译和启动
- 验证没有编译错误和警告

#### 测试步骤

1. **启动前端开发服务器**
   ```bash
   cd D:\code\campus-lite-marketplace\frontend\packages\admin
   npm run dev
   ```

2. **检查控制台输出**
   - ✅ 没有编译错误
   - ✅ 没有 TypeScript 错误
   - ✅ 显示本地地址（如 `http://localhost:5173`）

3. **打开浏览器**
   - 访问 `http://localhost:5173/admin/login`
   - ✅ 页面正常加载
   - ✅ 没有控制台错误

4. **检查浏览器控制台**
   - 打开开发者工具（F12）
   - 查看 Console 标签
   - ✅ 应该看到初始化日志：
     ```
     [App] ✅ 全局拦截器初始化完成
     [App] ✅ 登录状态恢复完成
     [Tab Sync] 初始化成功
     ```

#### 验收标准
- [ ] 项目成功启动
- [ ] 登录页正常显示
- [ ] 无编译错误
- [ ] 控制台显示初始化成功日志

---

### 2️⃣ 新增页面测试 📄

#### 测试目标
- 验证 9 个新增页面都能正常访问
- 验证页面布局和功能完整

#### 测试清单

##### P0 优先级页面（5个）

**1. 支付记录列表**
- **路由**: `/admin/payments/list`
- **测试步骤**:
  1. 点击侧边栏 "支付管理" → "支付记录"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（总交易金额、总交易笔数、成功交易、退款金额）
  4. ✅ 显示搜索栏（订单号搜索、状态筛选、支付方式筛选、日期范围）
  5. ✅ 显示数据表格（订单号、商品名、买家、支付方式、金额、状态、时间）
  6. ✅ 点击订单号能跳转详情页
- **验收标准**:
  - [ ] 页面布局正常
  - [ ] 统计数据显示
  - [ ] 搜索筛选功能
  - [ ] 表格数据显示
  - [ ] 详情跳转正常

**2. 支付详情页**
- **路由**: `/admin/payments/:orderNo`
- **测试步骤**:
  1. 从支付列表点击某个订单号
  2. ✅ 跳转到支付详情页
  3. ✅ 显示支付状态卡片（大图标 + 状态标签 + 金额）
  4. ✅ 显示支付信息（订单号、支付方式、金额、状态、交易号、时间）
  5. ✅ 显示订单信息（商品、买家、卖家、价格、地址）
  6. ✅ 显示交易流水（时间线）
  7. ✅ 返回按钮正常工作
- **验收标准**:
  - [ ] 页面正常显示
  - [ ] 支付信息完整
  - [ ] 时间线展示正常
  - [ ] 返回按钮有效

**3. 消息管理列表**
- **路由**: `/admin/messages/list`
- **测试步骤**:
  1. 点击侧边栏 "消息管理" → "消息列表"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（总会话数、活跃会话、总未读数、今日消息）
  4. ✅ 显示搜索栏
  5. ✅ 显示会话列表（会话ID、用户、最后消息、类型、未读数、时间）
  6. ✅ 点击"查看"能跳转详情
- **验收标准**:
  - [ ] 页面布局正常
  - [ ] 统计数据显示
  - [ ] 会话列表显示
  - [ ] 详情跳转正常

**4. 消息详情页**
- **路由**: `/admin/messages/:conversationId`
- **测试步骤**:
  1. 从消息列表点击"查看"
  2. ✅ 跳转到消息详情页
  3. ✅ 显示会话信息
  4. ✅ 显示聊天记录列表
  5. ✅ 支持图片预览
  6. ✅ 支持商品卡片点击跳转
  7. ✅ 返回按钮正常工作
- **验收标准**:
  - [ ] 聊天记录正常显示
  - [ ] 图片可以预览
  - [ ] 商品卡片可点击
  - [ ] 返回按钮有效

**5. 导出中心**
- **路由**: `/admin/export/center`
- **测试步骤**:
  1. 点击侧边栏 "导出中心"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（总任务数、进行中、已完成、失败）
  4. ✅ 显示"创建导出任务"按钮
  5. ✅ 显示导出任务列表
  6. ✅ 点击"创建导出任务"弹出对话框
  7. ✅ 填写表单并提交
  8. ✅ 任务列表刷新显示新任务
- **测试步骤（创建任务）**:
  1. 点击"创建导出任务"
  2. 选择导出类型（如：订单数据）
  3. 选择时间范围（如：最近7天）
  4. 点击"确定"
  5. ✅ 显示成功提示
  6. ✅ 任务列表中出现新任务（状态：待处理）
- **验收标准**:
  - [ ] 页面正常显示
  - [ ] 创建任务成功
  - [ ] 任务状态更新
  - [ ] 下载功能正常（任务完成后）

##### P1 优先级页面（4个）

**6. 物流管理列表**
- **路由**: `/admin/logistics/list`
- **测试步骤**:
  1. 点击侧边栏 "物流管理"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（总订单数、待发货、运输中、已送达、异常、平均时长）
  4. ✅ 显示搜索栏
  5. ✅ 显示数据表格（订单ID、快递公司、单号、状态、时间）
  6. ✅ 点击"查看轨迹"显示物流详情弹窗
- **验收标准**:
  - [ ] 页面布局正常
  - [ ] 统计数据显示
  - [ ] 轨迹查询正常

**7. 行为分析仪表盘**
- **路由**: `/admin/behavior/dashboard`
- **测试步骤**:
  1. 点击侧边栏 "行为分析"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（总用户数、活跃用户、总行为数、人均行为）
  4. ✅ 显示图表（行为类型分布饼图、活跃用户趋势图）
  5. ✅ 显示行为日志列表
  6. ✅ 日期范围筛选功能
- **验收标准**:
  - [ ] 页面正常显示
  - [ ] 图表渲染正常
  - [ ] 数据表格显示
  - [ ] 筛选功能正常

**8. 推荐管理配置**
- **路由**: `/admin/recommend/config`
- **测试步骤**:
  1. 点击侧边栏 "推荐管理"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（推荐总数、点击率、转化率、平均评分）
  4. ✅ 显示效果趋势图
  5. ✅ 显示配置表单（算法选择、权重配置、参数配置）
  6. ✅ 修改配置并保存
  7. ✅ 显示成功提示
- **验收标准**:
  - [ ] 页面正常显示
  - [ ] 表单可编辑
  - [ ] 保存功能正常
  - [ ] 图表渲染正常

**9. 搜索统计分析**
- **路由**: `/admin/search/statistics`
- **测试步骤**:
  1. 点击侧边栏 "搜索管理"
  2. ✅ 页面正常加载
  3. ✅ 显示统计卡片（总搜索次数、独立用户、平均结果数、无结果搜索、热门关键词数、点击率、转化率）
  4. ✅ 显示搜索趋势图
  5. ✅ 显示热门关键词列表（排名、关键词、搜索次数、结果数、点击率、转化率、趋势）
  6. ✅ 日期范围筛选功能
- **验收标准**:
  - [ ] 页面正常显示
  - [ ] 统计数据显示
  - [ ] 图表渲染正常
  - [ ] 热词列表显示

---

### 3️⃣ Token 刷新机制测试 🔄

#### 测试目标
- 验证 Token 自动刷新功能
- 验证刷新失败后的处理

#### 测试步骤

**场景1：Token 自动刷新**

1. **登录系统**
   - 使用管理员账号登录
   - 打开浏览器开发者工具（F12）
   - 切换到 Application 标签 → Local Storage
   - 找到 `auth-token` 键

2. **模拟 Token 过期**
   - 方法1：删除 `auth-token` 值
   - 方法2：修改 Token 为无效值（如：`invalid-token`）

3. **触发 API 请求**
   - 切换到任意页面（如：支付列表）
   - 观察网络请求（Network 标签）

4. **验证刷新流程**
   - ✅ 应该看到 401 错误
   - ✅ 应该看到自动发起 `/api/auth/refresh` 请求
   - ✅ 如果有 refreshToken，应该刷新成功
   - ✅ 刷新成功后，原请求自动重试
   - ✅ 页面数据正常显示

5. **验证刷新失败**
   - 删除 `refresh-token`
   - 刷新页面，触发请求
   - ✅ 应该跳转到登录页
   - ✅ 显示"登录已过期"提示
   - ✅ 当前路径被保存（redirect 参数）

#### 验收标准
- [ ] Token 刷新成功自动重试
- [ ] 刷新失败跳转登录页
- [ ] 当前路径被保存

---

### 4️⃣ 多 Tab 同步测试 🔄

#### 测试目标
- 验证多个标签页登录状态同步
- 验证多个标签页登出状态同步

#### 测试步骤

**场景1：登录同步**

1. **打开两个标签页**
   - Tab A: `http://localhost:5173/admin/login`（未登录）
   - Tab B: `http://localhost:5173/admin/login`（未登录）

2. **在 Tab A 登录**
   - 输入用户名和密码
   - 点击登录
   - ✅ Tab A 跳转到管理后台

3. **切换到 Tab B**
   - ✅ Tab B 应该自动跳转到管理后台
   - ✅ 显示提示："其他标签页已登录，当前页面已同步"
   - ✅ 用户信息已同步
   - ✅ 权限数据已同步

**场景2：登出同步**

1. **保持两个标签页都已登录**
   - Tab A: `/admin/dashboard`
   - Tab B: `/admin/payments/list`

2. **在 Tab A 登出**
   - 点击右上角用户菜单
   - 点击"退出登录"
   - ✅ Tab A 跳转到登录页

3. **切换到 Tab B**
   - ✅ Tab B 应该自动跳转到登录页
   - ✅ 显示提示："其他标签页已登出，当前页面即将跳转"
   - ✅ 本地存储已清空

**场景3：Token 刷新同步**

1. **打开两个标签页**
   - Tab A: `/admin/dashboard`
   - Tab B: `/admin/payments/list`

2. **在 Tab A 触发 Token 刷新**
   - 修改 Local Storage 中的 Token 为无效值
   - 刷新 Tab A
   - ✅ 应该自动刷新 Token

3. **观察 Tab B**
   - ✅ Tab B 的 Token 应该自动更新
   - ✅ 无需刷新页面
   - ✅ 后续请求使用新 Token

#### 验收标准
- [ ] 登录状态同步正常
- [ ] 登出状态同步正常
- [ ] Token 刷新同步正常
- [ ] 提示消息正确显示

---

### 5️⃣ 错误处理测试 ❌

#### 测试目标
- 验证各种错误场景的处理
- 验证错误提示友好

#### 测试步骤

**场景1：401 未授权**

1. **删除 Token**
   - 打开 Local Storage
   - 删除 `auth-token`

2. **触发请求**
   - 访问任意需要登录的页面
   - ✅ 应该自动跳转到登录页
   - ✅ 显示提示（通过拦截器处理，不应显示 error）

**场景2：403 无权限**

1. **访问无权限的页面**
   - 使用普通用户登录
   - 尝试访问管理员专属页面

2. **验证错误处理**
   - ✅ 应该显示 403 页面或跳转首页
   - ✅ 显示提示："您没有权限执行此操作"

**场景3：500 服务器错误**

1. **关闭后端服务**
   - 停止后端 Spring Boot 应用

2. **触发请求**
   - 刷新页面或切换页面
   - ✅ 应该显示错误提示："服务器内部错误"
   - ✅ 页面不应崩溃
   - ✅ 可以返回上一页

**场景4：网络错误**

1. **断开网络**
   - 关闭 Wi-Fi 或断开网线

2. **触发请求**
   - 刷新页面
   - ✅ 应该显示错误提示："网络连接失败，请检查网络"
   - ✅ 页面不应崩溃

#### 验收标准
- [ ] 401 错误正确处理
- [ ] 403 错误正确处理
- [ ] 500 错误正确处理
- [ ] 网络错误正确处理
- [ ] 错误提示友好

---

### 6️⃣ 权限缓存测试 💾

#### 测试目标
- 验证权限数据持久化
- 验证页面刷新后权限保持

#### 测试步骤

1. **登录系统**
   - 使用管理员账号登录
   - 打开 Local Storage
   - ✅ 应该看到 `admin-auth-storage` 键
   - ✅ 值包含 `user`、`token`、`permissions` 字段

2. **刷新页面**
   - 按 F5 刷新页面
   - ✅ 保持登录状态
   - ✅ 用户信息正确显示
   - ✅ 权限数据正确加载

3. **关闭浏览器重新打开**
   - 关闭浏览器
   - 重新打开并访问系统
   - ✅ 保持登录状态（如果 Token 未过期）
   - ✅ 权限数据正确加载

4. **登出清除缓存**
   - 点击退出登录
   - 打开 Local Storage
   - ✅ `admin-auth-storage` 应该被清空
   - ✅ 所有权限数据被清除

#### 验收标准
- [ ] 权限数据正确保存
- [ ] 页面刷新后权限保持
- [ ] 登出后缓存清除

---

## 📊 测试结果记录

### 测试执行记录表

| 测试项 | 测试人 | 测试时间 | 状态 | 备注 |
|--------|--------|---------|------|------|
| 项目启动 | | | ⏳ | |
| 支付列表 | | | ⏳ | |
| 支付详情 | | | ⏳ | |
| 消息列表 | | | ⏳ | |
| 消息详情 | | | ⏳ | |
| 导出中心 | | | ⏳ | |
| 物流管理 | | | ⏳ | |
| 行为分析 | | | ⏳ | |
| 推荐配置 | | | ⏳ | |
| 搜索统计 | | | ⏳ | |
| Token 刷新 | | | ⏳ | |
| 多 Tab 同步 | | | ⏳ | |
| 错误处理 | | | ⏳ | |
| 权限缓存 | | | ⏳ | |

### Bug 记录表

| Bug ID | 页面/功能 | 问题描述 | 严重程度 | 状态 | 备注 |
|--------|-----------|---------|---------|------|------|
| | | | | | |

---

## 🐛 常见问题排查

### 问题1：页面无法访问（404）

**症状**: 访问新增页面时显示 404

**排查步骤**:
1. 检查路由配置（`router/index.tsx`）
2. 确认页面组件已导入
3. 检查权限守卫配置
4. 检查浏览器控制台错误

### 问题2：Token 刷新不生效

**症状**: Token 过期后没有自动刷新

**排查步骤**:
1. 检查拦截器是否安装（App.tsx 中 setupInterceptors）
2. 检查 `refreshEndpoint` 配置是否正确
3. 检查后端 refresh Token API 是否正常
4. 查看网络请求是否发送

### 问题3：多 Tab 不同步

**症状**: 一个标签页登录/登出，其他标签页没反应

**排查步骤**:
1. 检查浏览器是否支持 BroadcastChannel
2. 检查 Tab Sync 是否初始化（控制台日志）
3. 检查 channelName 是否一致
4. 尝试强制刷新页面

### 问题4：错误提示不显示

**症状**: API 错误时没有提示消息

**排查步骤**:
1. 检查错误处理拦截器是否安装
2. 检查 Ant Design message 组件是否正常
3. 查看浏览器控制台错误日志
4. 检查 showError 函数是否正确配置

---

## ✅ 测试完成标准

### 必须通过的测试（P0）

- [ ] 项目成功启动
- [ ] 9 个新页面全部可访问
- [ ] Token 刷新机制正常工作
- [ ] 多 Tab 同步正常工作
- [ ] 错误处理正常工作
- [ ] 无致命 Bug

### 建议完成的测试（P1）

- [ ] 权限缓存正常工作
- [ ] 所有图表正常渲染
- [ ] 所有表单可正常提交
- [ ] 所有搜索筛选正常工作

---

## 📝 测试报告模板

### 测试总结

**测试日期**: _____  
**测试人**: _____  
**测试用时**: _____

**测试结果**:
- ✅ 通过: _____ 项
- ❌ 失败: _____ 项
- ⏭️ 跳过: _____ 项

**主要问题**:
1. _____
2. _____
3. _____

**建议**:
1. _____
2. _____

---

**文档版本**: v1.0.0  
**最后更新**: 2025-11-08  
**测试状态**: ⏳ 待执行
