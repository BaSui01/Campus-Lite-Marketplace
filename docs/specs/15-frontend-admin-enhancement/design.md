# å‰ç«¯ç®¡ç†ç«¯å®Œå–„ - æ¶æ„è®¾è®¡æ–‡æ¡£

> **åŠŸèƒ½ç¼–å·**: 15  
> **åŠŸèƒ½åç§°**: å‰ç«¯ç®¡ç†ç«¯å®Œå–„ï¼ˆæ¶æ„è®¾è®¡ï¼‰  
> **ä½œè€…**: BaSui ğŸ˜  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-08  
> **ç‰ˆæœ¬**: v1.0.0  

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€ç³»ç»Ÿæ¶æ„è®¾è®¡](#ä¸€ç³»ç»Ÿæ¶æ„è®¾è®¡)
- [äºŒã€æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡](#äºŒæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡)
- [ä¸‰ã€æ•°æ®æµè®¾è®¡](#ä¸‰æ•°æ®æµè®¾è®¡)
- [å››ã€ç»„ä»¶è®¾è®¡](#å››ç»„ä»¶è®¾è®¡)
- [äº”ã€API è®¾è®¡](#äº”api-è®¾è®¡)
- [å…­ã€çŠ¶æ€ç®¡ç†è®¾è®¡](#å…­çŠ¶æ€ç®¡ç†è®¾è®¡)
- [ä¸ƒã€è·¯ç”±è®¾è®¡](#ä¸ƒè·¯ç”±è®¾è®¡)
- [å…«ã€æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ](#å…«æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ)
- [ä¹ã€å®‰å…¨è®¾è®¡](#ä¹å®‰å…¨è®¾è®¡)
- [åã€éƒ¨ç½²æ–¹æ¡ˆ](#åéƒ¨ç½²æ–¹æ¡ˆ)

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯ç®¡ç†ç«¯ï¼ˆ@campus/adminï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Pages Layer  â”‚  â”‚  Layout Layer â”‚  â”‚  Router Layer â”‚   â”‚
â”‚  â”‚  (é¡µé¢å±‚)      â”‚  â”‚  (å¸ƒå±€å±‚)      â”‚  â”‚  (è·¯ç”±å±‚)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                  â”‚                  â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Components Layer (ç»„ä»¶å±‚)                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Data    â”‚ â”‚ Form    â”‚ â”‚ Feedbackâ”‚ â”‚ Media   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Display â”‚ â”‚ Input   â”‚ â”‚ Message â”‚ â”‚ Upload  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           Hooks Layer (é€»è¾‘å±‚)                     â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚
â”‚  â”‚  â”‚ useAuth  â”‚ â”‚ useTable â”‚ â”‚ useForm  â”‚  ...    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚       State Management Layer (çŠ¶æ€ç®¡ç†å±‚)          â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚
â”‚  â”‚  â”‚  Jotai   â”‚ â”‚  Zustand â”‚ â”‚React Queryâ”‚        â”‚     â”‚
â”‚  â”‚  â”‚ (åŸå­çŠ¶æ€)â”‚ â”‚(å…¨å±€çŠ¶æ€)â”‚ â”‚(æœåŠ¡å™¨çŠ¶æ€)â”‚        â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚          Service Layer (æœåŠ¡å±‚)                    â”‚     â”‚
â”‚  â”‚  åŸºäº OpenAPI ç”Ÿæˆçš„ API Client + ä¸šåŠ¡å°è£…         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              Shared Layer (@campus/shared)          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Types   â”‚ â”‚ Utils   â”‚ â”‚ API     â”‚ â”‚Componentsâ”‚  â”‚
  â”‚  â”‚ (ç±»å‹)   â”‚ â”‚(å·¥å…·å‡½æ•°)â”‚ â”‚(APIå®¢æˆ·ç«¯)â”‚ â”‚(å…±äº«ç»„ä»¶)â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚            Backend API (@campus/backend)            â”‚
  â”‚  Spring Boot REST API + WebSocket + PostgreSQL      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 åˆ†å±‚èŒè´£

| å±‚çº§ | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **Pages Layer** | é¡µé¢çº§ç»„ä»¶ï¼Œç»„è£…ä¸šåŠ¡é€»è¾‘ | React Functional Components |
| **Layout Layer** | å¸ƒå±€ç»„ä»¶ï¼ˆä¾§è¾¹æ ã€é¡¶æ ã€é¢åŒ…å±‘ï¼‰ | Ant Design Layout |
| **Router Layer** | è·¯ç”±é…ç½®å’Œæƒé™æ§åˆ¶ | React Router 6 + åŠ¨æ€è·¯ç”± |
| **Components Layer** | å¯å¤ç”¨çš„UIç»„ä»¶ | Ant Design + è‡ªå®šä¹‰ç»„ä»¶ |
| **Hooks Layer** | ä¸šåŠ¡é€»è¾‘æŠ½è±¡å’Œå¤ç”¨ | React Hooks |
| **State Management** | å…¨å±€çŠ¶æ€å’ŒæœåŠ¡å™¨çŠ¶æ€ç®¡ç† | Jotai + Zustand + React Query |
| **Service Layer** | API è°ƒç”¨å’Œæ•°æ®è½¬æ¢ | Axios + OpenAPI ç”Ÿæˆä»£ç  |
| **Shared Layer** | è·¨åŒ…å…±äº«çš„ä»£ç  | TypeScript Library |

---

## äºŒã€æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### 2.1 ç™»å½•çŠ¶æ€ç®¡ç†ä¼˜åŒ–

#### **2.1.1 Token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶**

```typescript
// src/utils/http/interceptors.ts
import axios from 'axios';
import { message } from 'antd';
import { useAuthStore } from '@/stores/auth';

// Token åˆ·æ–°é˜Ÿåˆ—ï¼ˆé¿å…å¹¶å‘åˆ·æ–°ï¼‰
let isRefreshing = false;
let refreshQueue: Array<(token: string) => void> = [];

// å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    // 401 é”™è¯¯ä¸”æœªé‡è¯•è¿‡
    if (error.response?.status === 401 && !originalRequest._retry) {
      // å¦‚æœæ­£åœ¨åˆ·æ–°ï¼Œå°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—
      if (isRefreshing) {
        return new Promise((resolve) => {
          refreshQueue.push((token: string) => {
            originalRequest.headers['Authorization'] = `Bearer ${token}`;
            resolve(axios(originalRequest));
          });
        });
      }

      originalRequest._retry = true;
      isRefreshing = true;

      try {
        // è°ƒç”¨åˆ·æ–° Token API
        const { data } = await authApi.refreshToken();
        const newToken = data.data.accessToken;

        // æ›´æ–°æœ¬åœ° Token
        useAuthStore.getState().setToken(newToken);

        // é‡è¯•é˜Ÿåˆ—ä¸­çš„è¯·æ±‚
        refreshQueue.forEach((callback) => callback(newToken));
        refreshQueue = [];

        // é‡è¯•åŸå§‹è¯·æ±‚
        originalRequest.headers['Authorization'] = `Bearer ${newToken}`;
        return axios(originalRequest);
      } catch (refreshError) {
        // åˆ·æ–°å¤±è´¥ï¼Œæ¸…é™¤ç™»å½•çŠ¶æ€ï¼Œè·³è½¬ç™»å½•é¡µ
        useAuthStore.getState().logout();
        window.location.href = '/login';
        message.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
        return Promise.reject(refreshError);
      } finally {
        isRefreshing = false;
      }
    }

    // 403 æ— æƒé™
    if (error.response?.status === 403) {
      message.error('æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ');
    }

    // 500 æœåŠ¡å™¨é”™è¯¯
    if (error.response?.status === 500) {
      message.error('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
    }

    return Promise.reject(error);
  }
);
```

#### **2.1.2 å¤š Tab ç™»å½•çŠ¶æ€åŒæ­¥**

```typescript
// src/utils/auth/syncTab.ts
import { useAuthStore } from '@/stores/auth';

// ä½¿ç”¨ BroadcastChannel å®ç°å¤š Tab åŒæ­¥
const authChannel = new BroadcastChannel('auth-sync');

// ç›‘å¬å…¶ä»– Tab çš„ç™»å½•/ç™»å‡ºäº‹ä»¶
authChannel.onmessage = (event) => {
  const { type, payload } = event.data;

  switch (type) {
    case 'LOGIN':
      // å…¶ä»– Tab ç™»å½•ï¼ŒåŒæ­¥ç”¨æˆ·ä¿¡æ¯
      useAuthStore.getState().setUser(payload.user);
      useAuthStore.getState().setToken(payload.token);
      break;

    case 'LOGOUT':
      // å…¶ä»– Tab ç™»å‡ºï¼Œæ¸…é™¤å½“å‰ Tab çŠ¶æ€
      useAuthStore.getState().logout();
      window.location.href = '/login';
      break;

    case 'TOKEN_REFRESH':
      // å…¶ä»– Tab åˆ·æ–° Tokenï¼ŒåŒæ­¥æ›´æ–°
      useAuthStore.getState().setToken(payload.token);
      break;
  }
};

// ç™»å½•æˆåŠŸåå¹¿æ’­
export const broadcastLogin = (user: User, token: string) => {
  authChannel.postMessage({ type: 'LOGIN', payload: { user, token } });
};

// ç™»å‡ºåå¹¿æ’­
export const broadcastLogout = () => {
  authChannel.postMessage({ type: 'LOGOUT' });
};

// Token åˆ·æ–°åå¹¿æ’­
export const broadcastTokenRefresh = (token: string) => {
  authChannel.postMessage({ type: 'TOKEN_REFRESH', payload: { token } });
};
```

#### **2.1.3 æƒé™æ•°æ®ç¼“å­˜**

```typescript
// src/stores/auth.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  user: User | null;
  token: string | null;
  permissions: string[]; // æƒé™ç åˆ—è¡¨
  setUser: (user: User) => void;
  setToken: (token: string) => void;
  setPermissions: (permissions: string[]) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      permissions: [],
      setUser: (user) => set({ user }),
      setToken: (token) => set({ token }),
      setPermissions: (permissions) => set({ permissions }),
      logout: () => {
        set({ user: null, token: null, permissions: [] });
        localStorage.clear();
        sessionStorage.clear();
      },
    }),
    {
      name: 'auth-storage', // LocalStorage key
      partialize: (state) => ({
        // åªæŒä¹…åŒ–éƒ¨åˆ†å­—æ®µ
        user: state.user,
        token: state.token,
        permissions: state.permissions,
      }),
    }
  )
);
```

---

### 2.2 ç¼ºå¤±é¡µé¢å®ç°æ–¹æ¡ˆ

#### **2.2.1 é¡µé¢æ¨¡æ¿**

**æ‰€æœ‰æ–°é¡µé¢éµå¾ªç»Ÿä¸€æ¨¡æ¿ï¼š**

```typescript
// src/pages/[Module]/[PageName]/index.tsx
import React from 'react';
import { Card, Space, Button } from 'antd';
import { PlusOutlined } from '@ant-design/icons';
import { PageHeader, DataTable, SearchBar } from '@/components';
import { use[Module]List } from '@/hooks';

const [PageName]Page: React.FC = () => {
  const {
    data,
    loading,
    pagination,
    handleSearch,
    handleCreate,
    handleEdit,
    handleDelete,
  } = use[Module]List();

  return (
    <div className="page-container">
      {/* é¡µé¢å¤´éƒ¨ */}
      <PageHeader
        title="[é¡µé¢æ ‡é¢˜]"
        extra={
          <Button type="primary" icon={<PlusOutlined />} onClick={handleCreate}>
            æ–°å¢
          </Button>
        }
      />

      {/* æœç´¢æ  */}
      <Card>
        <SearchBar onSearch={handleSearch} />
      </Card>

      {/* æ•°æ®è¡¨æ ¼ */}
      <Card style={{ marginTop: 16 }}>
        <DataTable
          dataSource={data}
          loading={loading}
          pagination={pagination}
          columns={columns}
          rowKey="id"
          onEdit={handleEdit}
          onDelete={handleDelete}
        />
      </Card>
    </div>
  );
};

export default [PageName]Page;
```

#### **2.2.2 Hooks æ¨¡æ¿**

```typescript
// src/hooks/use[Module]List.ts
import { useState } from 'react';
import { message } from 'antd';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { [module]Api } from '@campus/shared/api';

export const use[Module]List = () => {
  const queryClient = useQueryClient();
  const [searchParams, setSearchParams] = useState({});
  const [pagination, setPagination] = useState({ current: 1, pageSize: 10 });

  // æŸ¥è¯¢åˆ—è¡¨
  const { data, isLoading } = useQuery({
    queryKey: ['[module]-list', searchParams, pagination],
    queryFn: () =>
      [module]Api.list({
        ...searchParams,
        page: pagination.current - 1,
        size: pagination.pageSize,
      }),
  });

  // åˆ é™¤
  const deleteMutation = useMutation({
    mutationFn: (id: number) => [module]Api.delete(id),
    onSuccess: () => {
      message.success('åˆ é™¤æˆåŠŸ');
      queryClient.invalidateQueries({ queryKey: ['[module]-list'] });
    },
    onError: () => {
      message.error('åˆ é™¤å¤±è´¥');
    },
  });

  const handleSearch = (values: any) => {
    setSearchParams(values);
    setPagination({ ...pagination, current: 1 });
  };

  const handleDelete = (id: number) => {
    deleteMutation.mutate(id);
  };

  return {
    data: data?.data?.records || [],
    loading: isLoading,
    pagination: {
      ...pagination,
      total: data?.data?.total || 0,
      onChange: (page: number, pageSize: number) => {
        setPagination({ current: page, pageSize });
      },
    },
    handleSearch,
    handleDelete,
  };
};
```

---

### 2.3 ä»£ç å¤ç”¨æ–¹æ¡ˆ

#### **2.3.1 é€šç”¨ç»„ä»¶åº“**

| ç»„ä»¶åç§° | æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½æè¿° |
|---------|---------|---------|
| **DataTable** | `@/components/DataTable` | é€šç”¨æ•°æ®è¡¨æ ¼ï¼ˆåˆ†é¡µã€æ’åºã€ç­›é€‰ã€æ“ä½œåˆ—ï¼‰ |
| **FormModal** | `@/components/FormModal` | é€šç”¨è¡¨å•å¼¹çª—ï¼ˆæ–°å¢/ç¼–è¾‘ï¼‰ |
| **ConfirmDialog** | `@/components/ConfirmDialog` | ç¡®è®¤å¯¹è¯æ¡†ï¼ˆåˆ é™¤/æ“ä½œç¡®è®¤ï¼‰ |
| **ImageUpload** | `@/components/ImageUpload` | å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼ˆæ”¯æŒè£å‰ªã€å‹ç¼©ï¼‰ |
| **SearchBar** | `@/components/SearchBar` | æœç´¢æ ï¼ˆå…³é”®è¯æœç´¢ã€é«˜çº§ç­›é€‰ï¼‰ |
| **PageHeader** | `@/components/PageHeader` | é¡µé¢å¤´éƒ¨ï¼ˆæ ‡é¢˜ã€é¢åŒ…å±‘ã€æ“ä½œæŒ‰é’®ï¼‰ |
| **StatusBadge** | `@/components/StatusBadge` | çŠ¶æ€å¾½ç« ï¼ˆè®¢å•çŠ¶æ€ã€å®¡æ ¸çŠ¶æ€ï¼‰ |
| **ExportButton** | `@/components/ExportButton` | å¯¼å‡ºæŒ‰é’®ï¼ˆExcel/CSVï¼‰ |

#### **2.3.2 é€šç”¨ Hooks åº“**

| Hook åç§° | æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½æè¿° |
|---------|---------|---------|
| **useTable** | `@/hooks/useTable` | è¡¨æ ¼çŠ¶æ€ç®¡ç†ï¼ˆåˆ†é¡µã€æ’åºã€ç­›é€‰ï¼‰ |
| **useForm** | `@/hooks/useForm` | è¡¨å•çŠ¶æ€ç®¡ç†ï¼ˆæ ¡éªŒã€æäº¤ï¼‰ |
| **useModal** | `@/hooks/useModal` | å¼¹çª—çŠ¶æ€ç®¡ç†ï¼ˆæ‰“å¼€/å…³é—­ï¼‰ |
| **usePermission** | `@/hooks/usePermission` | æƒé™åˆ¤æ–­ï¼ˆæŒ‰é’®çº§åˆ«æƒé™ï¼‰ |
| **useDebounce** | `@/hooks/useDebounce` | é˜²æŠ–ï¼ˆæœç´¢è¾“å…¥ï¼‰ |
| **useThrottle** | `@/hooks/useThrottle` | èŠ‚æµï¼ˆæ»šåŠ¨äº‹ä»¶ï¼‰ |

---

### 2.4 UI ç¾åŒ–æ–¹æ¡ˆ

#### **2.4.1 éª¨æ¶å±å®ç°**

```typescript
// src/components/TableSkeleton/index.tsx
import React from 'react';
import { Skeleton, Table } from 'antd';

interface TableSkeletonProps {
  rows?: number; // éª¨æ¶å±è¡Œæ•°
  columns?: number; // éª¨æ¶å±åˆ—æ•°
}

export const TableSkeleton: React.FC<TableSkeletonProps> = ({
  rows = 5,
  columns = 5,
}) => {
  return (
    <Table
      dataSource={Array.from({ length: rows }).map((_, index) => ({
        key: index,
      }))}
      columns={Array.from({ length: columns }).map((_, index) => ({
        key: index,
        dataIndex: `col${index}`,
        render: () => <Skeleton.Input active style={{ width: '100%' }} />,
      }))}
      pagination={false}
    />
  );
};
```

#### **2.4.2 è™šæ‹Ÿæ»šåŠ¨å®ç°**

```typescript
// ä½¿ç”¨ antd çš„ virtual å±æ€§
<Table
  dataSource={data}
  columns={columns}
  virtual // å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
  scroll={{ y: 600 }} // å›ºå®šé«˜åº¦
/>
```

#### **2.4.3 ä¸»é¢˜åˆ‡æ¢å®ç°**

```typescript
// src/stores/theme.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { theme } from 'antd';

interface ThemeState {
  isDark: boolean;
  toggleTheme: () => void;
}

export const useThemeStore = create<ThemeState>()(
  persist(
    (set) => ({
      isDark: false,
      toggleTheme: () => set((state) => ({ isDark: !state.isDark })),
    }),
    {
      name: 'theme-storage',
    }
  )
);

// App.tsx
import { ConfigProvider } from 'antd';
import { useThemeStore } from '@/stores/theme';

const App = () => {
  const { isDark } = useThemeStore();

  return (
    <ConfigProvider
      theme={{
        algorithm: isDark ? theme.darkAlgorithm : theme.defaultAlgorithm,
      }}
    >
      {/* åº”ç”¨å†…å®¹ */}
    </ConfigProvider>
  );
};
```

---

## ä¸‰ã€æ•°æ®æµè®¾è®¡

### 3.1 æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Interaction (ç”¨æˆ·æ“ä½œ)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Handler (äº‹ä»¶å¤„ç†)                                    â”‚
â”‚  - handleSearch / handleCreate / handleEdit / handleDelete  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Custom Hook (ä¸šåŠ¡é€»è¾‘)                                      â”‚
â”‚  - useQuery / useMutation (React Query)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer (æœåŠ¡å±‚)                                      â”‚
â”‚  - API å°è£… (åŸºäº OpenAPI ç”Ÿæˆä»£ç )                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP Request (Axios)                                       â”‚
â”‚  - Interceptors (è¯·æ±‚æ‹¦æˆªã€å“åº”æ‹¦æˆªã€Token åˆ·æ–°)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend API (åç«¯æ¥å£)                                      â”‚
â”‚  - Spring Boot REST API                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response Data (å“åº”æ•°æ®)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Query Cache (æ•°æ®ç¼“å­˜)                               â”‚
â”‚  - è‡ªåŠ¨ç¼“å­˜ã€è‡ªåŠ¨åˆ·æ–°ã€ä¹è§‚æ›´æ–°                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component Re-render (ç»„ä»¶é‡æ–°æ¸²æŸ“)                          â”‚
â”‚  - å±•ç¤ºæœ€æ–°æ•°æ®                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŠ¶æ€ç®¡ç†ç­–ç•¥

| çŠ¶æ€ç±»å‹ | ç®¡ç†æ–¹å¼ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|---------|---------|---------|------|
| **æœåŠ¡å™¨çŠ¶æ€** | React Query | API æ•°æ®ã€åˆ—è¡¨ã€è¯¦æƒ… | å•†å“åˆ—è¡¨ã€è®¢å•è¯¦æƒ… |
| **å…¨å±€çŠ¶æ€** | Zustand | ç”¨æˆ·ä¿¡æ¯ã€Tokenã€æƒé™ | ç™»å½•çŠ¶æ€ã€æƒé™ç¼“å­˜ |
| **åŸå­çŠ¶æ€** | Jotai | ç»†ç²’åº¦çŠ¶æ€ï¼ˆç®¡ç†ç«¯å¤æ‚è¡¨å•ï¼‰ | å¤šæ­¥éª¤è¡¨å•ã€ç­›é€‰å™¨ |
| **æœ¬åœ°çŠ¶æ€** | useState | ç»„ä»¶å†…éƒ¨çŠ¶æ€ | å¼¹çª—æ‰“å¼€/å…³é—­ã€è¾“å…¥æ¡†å€¼ |
| **URL çŠ¶æ€** | React Router | è·¯ç”±å‚æ•°ã€æŸ¥è¯¢å‚æ•° | åˆ†é¡µå‚æ•°ã€æœç´¢å…³é”®è¯ |

---

## å››ã€ç»„ä»¶è®¾è®¡

### 4.1 DataTable ç»„ä»¶

```typescript
// src/components/DataTable/index.tsx
import React from 'react';
import { Table, Button, Space, Popconfirm } from 'antd';
import { EditOutlined, DeleteOutlined } from '@ant-design/icons';
import type { TableProps, ColumnsType } from 'antd/es/table';

interface DataTableProps<T> extends TableProps<T> {
  onEdit?: (record: T) => void;
  onDelete?: (record: T) => void;
  editPermission?: string; // ç¼–è¾‘æƒé™ç 
  deletePermission?: string; // åˆ é™¤æƒé™ç 
}

export const DataTable = <T extends { id: number }>({
  onEdit,
  onDelete,
  editPermission,
  deletePermission,
  columns,
  ...restProps
}: DataTableProps<T>) => {
  const { hasPermission } = usePermission();

  // è‡ªåŠ¨æ·»åŠ æ“ä½œåˆ—
  const actionColumn: ColumnsType<T>[0] = {
    title: 'æ“ä½œ',
    key: 'action',
    fixed: 'right',
    width: 150,
    render: (_, record) => (
      <Space size="small">
        {onEdit && (!editPermission || hasPermission(editPermission)) && (
          <Button
            type="link"
            size="small"
            icon={<EditOutlined />}
            onClick={() => onEdit(record)}
          >
            ç¼–è¾‘
          </Button>
        )}
        {onDelete && (!deletePermission || hasPermission(deletePermission)) && (
          <Popconfirm
            title="ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ"
            onConfirm={() => onDelete(record)}
            okText="ç¡®å®š"
            cancelText="å–æ¶ˆ"
          >
            <Button
              type="link"
              size="small"
              danger
              icon={<DeleteOutlined />}
            >
              åˆ é™¤
            </Button>
          </Popconfirm>
        )}
      </Space>
    ),
  };

  return (
    <Table
      columns={[...columns!, actionColumn]}
      scroll={{ x: 'max-content' }}
      {...restProps}
    />
  );
};
```

### 4.2 FormModal ç»„ä»¶

```typescript
// src/components/FormModal/index.tsx
import React from 'react';
import { Modal, Form, message } from 'antd';
import type { FormInstance } from 'antd';

interface FormModalProps {
  title: string;
  open: boolean;
  initialValues?: any;
  onCancel: () => void;
  onSubmit: (values: any) => Promise<void>;
  children: React.ReactNode;
}

export const FormModal: React.FC<FormModalProps> = ({
  title,
  open,
  initialValues,
  onCancel,
  onSubmit,
  children,
}) => {
  const [form] = Form.useForm();
  const [loading, setLoading] = React.useState(false);

  const handleOk = async () => {
    try {
      const values = await form.validateFields();
      setLoading(true);
      await onSubmit(values);
      message.success('æ“ä½œæˆåŠŸ');
      form.resetFields();
      onCancel();
    } catch (error) {
      console.error('è¡¨å•æäº¤å¤±è´¥', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Modal
      title={title}
      open={open}
      onCancel={onCancel}
      onOk={handleOk}
      confirmLoading={loading}
      destroyOnClose
    >
      <Form
        form={form}
        layout="vertical"
        initialValues={initialValues}
      >
        {children}
      </Form>
    </Modal>
  );
};
```

---

## äº”ã€API è®¾è®¡

### 5.1 API æœåŠ¡å°è£…

```typescript
// src/services/[module].service.ts
import { [Module]Api } from '@campus/shared/api';
import type { [Module]DTO } from '@campus/shared/api/models';

/**
 * [æ¨¡å—]æœåŠ¡å±‚
 * åŸºäº OpenAPI ç”Ÿæˆä»£ç çš„äºŒæ¬¡å°è£…
 */
export class [Module]Service {
  /**
   * è·å–åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰
   */
  static async getList(params: {
    page: number;
    size: number;
    keyword?: string;
  }) {
    const response = await [Module]Api.list({
      page: params.page - 1, // åç«¯ä» 0 å¼€å§‹
      size: params.size,
      keyword: params.keyword,
    });
    return response.data;
  }

  /**
   * è·å–è¯¦æƒ…
   */
  static async getDetail(id: number) {
    const response = await [Module]Api.getById(id);
    return response.data;
  }

  /**
   * åˆ›å»º
   */
  static async create(data: Partial<[Module]DTO>) {
    const response = await [Module]Api.create(data);
    return response.data;
  }

  /**
   * æ›´æ–°
   */
  static async update(id: number, data: Partial<[Module]DTO>) {
    const response = await [Module]Api.update(id, data);
    return response.data;
  }

  /**
   * åˆ é™¤
   */
  static async delete(id: number) {
    const response = await [Module]Api.delete(id);
    return response.data;
  }
}
```

---

## å…­ã€çŠ¶æ€ç®¡ç†è®¾è®¡

### 6.1 Auth Storeï¼ˆå…¨å±€çŠ¶æ€ï¼‰

```typescript
// src/stores/auth.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { authApi } from '@/services/auth.service';

interface User {
  id: number;
  username: string;
  email: string;
  roles: string[];
}

interface AuthState {
  user: User | null;
  token: string | null;
  permissions: string[];
  isAuthenticated: boolean;

  // Actions
  setUser: (user: User) => void;
  setToken: (token: string) => void;
  setPermissions: (permissions: string[]) => void;
  login: (username: string, password: string) => Promise<void>;
  logout: () => void;
  refreshToken: () => Promise<void>;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      user: null,
      token: null,
      permissions: [],
      isAuthenticated: false,

      setUser: (user) => set({ user, isAuthenticated: true }),
      setToken: (token) => set({ token }),
      setPermissions: (permissions) => set({ permissions }),

      login: async (username, password) => {
        const response = await authApi.login({ username, password });
        const { user, token, permissions } = response.data;
        set({ user, token, permissions, isAuthenticated: true });
      },

      logout: () => {
        set({ user: null, token: null, permissions: [], isAuthenticated: false });
        localStorage.clear();
        sessionStorage.clear();
      },

      refreshToken: async () => {
        const response = await authApi.refreshToken();
        const { token } = response.data;
        set({ token });
      },
    }),
    {
      name: 'auth-storage',
      partialize: (state) => ({
        user: state.user,
        token: state.token,
        permissions: state.permissions,
      }),
    }
  )
);
```

---

## ä¸ƒã€è·¯ç”±è®¾è®¡

### 7.1 è·¯ç”±é…ç½®

```typescript
// src/router/routes.tsx
import { lazy } from 'react';
import type { RouteObject } from 'react-router-dom';

// æ‡’åŠ è½½é¡µé¢
const PaymentList = lazy(() => import('@/pages/Payment/List'));
const MessageList = lazy(() => import('@/pages/Message/List'));
const ExportCenter = lazy(() => import('@/pages/Export/Center'));
// ... å…¶ä»–é¡µé¢

export const routes: RouteObject[] = [
  {
    path: '/',
    element: <AdminLayout />,
    children: [
      // æ”¯ä»˜ç®¡ç†
      {
        path: 'payments',
        children: [
          { path: 'list', element: <PaymentList />, meta: { permission: 'payment:view' } },
        ],
      },
      // æ¶ˆæ¯ç®¡ç†
      {
        path: 'messages',
        children: [
          { path: 'list', element: <MessageList />, meta: { permission: 'message:view' } },
        ],
      },
      // å¯¼å‡ºä¸­å¿ƒ
      {
        path: 'export',
        children: [
          { path: 'center', element: <ExportCenter />, meta: { permission: 'export:view' } },
        ],
      },
      // ... å…¶ä»–è·¯ç”±
    ],
  },
];
```

### 7.2 è·¯ç”±å®ˆå«

```typescript
// src/router/guard.tsx
import { Navigate, useLocation } from 'react-router-dom';
import { useAuthStore } from '@/stores/auth';
import { usePermission } from '@/hooks/usePermission';

export const RouteGuard: React.FC<{ children: React.ReactNode; permission?: string }> = ({
  children,
  permission,
}) => {
  const location = useLocation();
  const { isAuthenticated } = useAuthStore();
  const { hasPermission } = usePermission();

  // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // æ— æƒé™ï¼Œè·³è½¬403é¡µé¢
  if (permission && !hasPermission(permission)) {
    return <Navigate to="/403" replace />;
  }

  return <>{children}</>;
};
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 8.1 ä»£ç åˆ†å‰²

```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
import { lazy, Suspense } from 'react';
import { TableSkeleton } from '@/components';

const PaymentList = lazy(() => import('@/pages/Payment/List'));

// ä½¿ç”¨ Suspense åŒ…è£¹
<Suspense fallback={<TableSkeleton />}>
  <PaymentList />
</Suspense>
```

### 8.2 å›¾ç‰‡æ‡’åŠ è½½

```typescript
// src/components/LazyImage/index.tsx
import React, { useState, useEffect, useRef } from 'react';

export const LazyImage: React.FC<{ src: string; alt: string }> = ({ src, alt }) => {
  const [isVisible, setIsVisible] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.disconnect();
        }
      },
      { threshold: 0.1 }
    );

    if (imgRef.current) {
      observer.observe(imgRef.current);
    }

    return () => observer.disconnect();
  }, []);

  return (
    <img
      ref={imgRef}
      src={isVisible ? src : ''}
      alt={alt}
      loading="lazy"
      style={{ opacity: isVisible ? 1 : 0, transition: 'opacity 0.3s' }}
    />
  );
};
```

### 8.3 è™šæ‹Ÿæ»šåŠ¨

```typescript
// ä½¿ç”¨ antd Table çš„ virtual å±æ€§
<Table
  dataSource={data}
  columns={columns}
  virtual // å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
  scroll={{ y: 600 }} // å›ºå®šé«˜åº¦
  pagination={false} // ç¦ç”¨åˆ†é¡µ
/>
```

---

## ä¹ã€å®‰å…¨è®¾è®¡

### 9.1 XSS é˜²æŠ¤

```typescript
// ä½¿ç”¨ DOMPurify æ¸…ç† HTML
import DOMPurify from 'dompurify';

const SafeHTML: React.FC<{ html: string }> = ({ html }) => {
  const cleanHTML = DOMPurify.sanitize(html);
  return <div dangerouslySetInnerHTML={{ __html: cleanHTML }} />;
};
```

### 9.2 CSRF é˜²æŠ¤

```typescript
// Axios è‡ªåŠ¨æºå¸¦ CSRF Token
axios.interceptors.request.use((config) => {
  const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
  if (csrfToken) {
    config.headers['X-CSRF-Token'] = csrfToken;
  }
  return config;
});
```

### 9.3 æƒé™æ§åˆ¶

```typescript
// æŒ‰é’®çº§åˆ«æƒé™æ§åˆ¶
import { usePermission } from '@/hooks/usePermission';

const MyComponent = () => {
  const { hasPermission } = usePermission();

  return (
    <>
      {hasPermission('user:delete') && (
        <Button danger onClick={handleDelete}>
          åˆ é™¤ç”¨æˆ·
        </Button>
      )}
    </>
  );
};
```

---

## åã€éƒ¨ç½²æ–¹æ¡ˆ

### 10.1 æ„å»ºé…ç½®

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    outDir: 'dist',
    sourcemap: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­ source map
    rollupOptions: {
      output: {
        manualChunks: {
          // ä»£ç åˆ†å‰²
          vendor: ['react', 'react-dom', 'react-router-dom'],
          antd: ['antd', '@ant-design/icons'],
          charts: ['echarts'],
        },
      },
    },
    chunkSizeWarningLimit: 1000, // å¢å¤§è­¦å‘Šé˜ˆå€¼
  },
});
```

### 10.2 Nginx é…ç½®

```nginx
server {
  listen 80;
  server_name admin.campus-marketplace.com;

  root /var/www/admin/dist;
  index index.html;

  # Gzip å‹ç¼©
  gzip on;
  gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

  # SPA è·¯ç”±
  location / {
    try_files $uri $uri/ /index.html;
  }

  # API ä»£ç†
  location /api/ {
    proxy_pass http://localhost:8200;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }

  # é™æ€èµ„æºç¼“å­˜
  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
  }
}
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [å…¨å±€æŠ€æœ¯æ ˆæ–‡æ¡£](../tech.md)
- [å…¨å±€é¡¹ç›®ç»“æ„æ–‡æ¡£](../structure.md)
- [å‰ç«¯å¼€å‘è§„èŒƒ](../../../frontend/CLAUDE.md)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [Ant Design å®˜æ–¹æ–‡æ¡£](https://ant.design/)
- [React Query å®˜æ–¹æ–‡æ¡£](https://tanstack.com/query/latest)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-11-08  
**å®¡æ‰¹çŠ¶æ€**: å¾…å®¡æ‰¹ â³
