# å‰åç«¯é›†æˆæ£€æŸ¥æŠ¥å‘Š

> **æ£€æŸ¥æ—¥æœŸ**: 2025-11-10  
> **æ£€æŸ¥èŒƒå›´**: è®¢å•ç®¡ç†ã€é€€æ¬¾ç®¡ç†ã€æ”¯ä»˜ç®¡ç†ã€ç‰©æµç®¡ç†  
> **æ£€æŸ¥ç»´åº¦**: APIä½¿ç”¨ã€å­—æ®µåŒ¹é…ã€CRUDåŠŸèƒ½ã€é¡µé¢å±•ç¤º

---

## ğŸ“Š æ€»ä½“è¯„åˆ†

| æ¨¡å— | APIä½¿ç”¨ | å­—æ®µåŒ¹é… | CRUDåŠŸèƒ½ | é¡µé¢å±•ç¤º | æ€»è¯„ |
|------|---------|----------|----------|----------|------|
| è®¢å•ç®¡ç† | âœ… ä¼˜ç§€ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å®Œç¾ | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ |
| é€€æ¬¾ç®¡ç† | âš ï¸ è‰¯å¥½ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âš ï¸ è‰¯å¥½ | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ |
| æ”¯ä»˜ç®¡ç† | âš ï¸ éœ€å®Œå–„ | âš ï¸ éƒ¨åˆ†ç¼ºå¤± | âš ï¸ éƒ¨åˆ†ç¼ºå¤± | âš ï¸ åŸºç¡€å®Œæˆ | ğŸŒŸğŸŒŸğŸŒŸ |
| ç‰©æµç®¡ç† | âŒ æœªé›†æˆ | âœ… å­—æ®µå®Œæ•´ | âœ… åç«¯å®Œæ•´ | âš ï¸ å‰ç«¯ç©ºå£³ | ğŸŒŸğŸŒŸ |

---

## 1ï¸âƒ£ è®¢å•ç®¡ç†æ¨¡å— ğŸ¯

### âœ… **æ€»ä½“è¯„ä»·ï¼šä¼˜ç§€**

è®¢å•ç®¡ç†æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­é›†æˆæœ€å®Œå–„çš„æ¨¡å—ï¼Œå‰åç«¯ç´§å¯†é…åˆï¼ŒåŠŸèƒ½å®Œæ•´ã€‚

### ğŸ“¡ **APIä½¿ç”¨æƒ…å†µ**

#### åç«¯APIï¼ˆå®Œæ•´å®ç°ï¼‰
```java
// Controllerå±‚
GET  /api/orders/buyer     - ä¹°å®¶è®¢å•åˆ—è¡¨ âœ…
GET  /api/orders/seller    - å–å®¶è®¢å•åˆ—è¡¨ âœ…
GET  /api/orders/{orderNo} - è®¢å•è¯¦æƒ… âœ…
POST /api/orders           - åˆ›å»ºè®¢å• âœ…
PUT  /api/orders/{orderNo}/cancel - å–æ¶ˆè®¢å• âœ…
```

#### å‰ç«¯è°ƒç”¨ï¼ˆå®Œç¾é›†æˆï¼‰
```typescript
// Portalç«¯ - ç”¨æˆ·è®¢å•é¡µé¢
frontend/packages/portal/src/pages/Orders/index.tsx
- orderService.getBuyerOrders()  âœ… è°ƒç”¨ä¹°å®¶è®¢å•åˆ—è¡¨
- orderService.getSellerOrders() âœ… è°ƒç”¨å–å®¶è®¢å•åˆ—è¡¨
- ä½¿ç”¨ React Query ç¼“å­˜å’Œè½®è¯¢ âœ…

// Adminç«¯ - ç®¡ç†å‘˜è®¢å•åˆ—è¡¨
frontend/packages/admin/src/pages/Orders/OrderList.tsx
- orderService.listOrdersAdmin() âœ… è°ƒç”¨ç®¡ç†å‘˜è®¢å•åˆ—è¡¨
- æ”¯æŒå¤šç»´åº¦æœç´¢å’Œç­›é€‰ âœ…
```

### ğŸ”— **å­—æ®µåŒ¹é…åº¦ï¼š100%**

#### åç«¯è¿”å›å­—æ®µ
```java
// OrderResponse.java
{
  "id": Long,
  "orderNo": String,
  "goodsId": Long,
  "goodsTitle": String,
  "goodsImage": String,
  "buyerId": Long,
  "buyerUsername": String,
  "sellerId": Long,
  "sellerUsername": String,
  "amount": BigDecimal,
  "discountAmount": BigDecimal,
  "actualAmount": BigDecimal,
  "status": OrderStatus,
  "paymentMethod": String,
  "paymentTime": LocalDateTime,
  "createdAt": LocalDateTime
}
```

#### å‰ç«¯ä½¿ç”¨å­—æ®µ
```typescript
// frontend/packages/shared/src/api/models/order-response.ts
interface OrderResponse {
  id?: number;
  orderNo?: string;
  goodsId?: number;
  goodsTitle?: string;
  goodsImage?: string;
  buyerName?: string;      // âœ… å¯¹åº” buyerUsername
  sellerName?: string;     // âœ… å¯¹åº” sellerUsername
  amount?: number;
  discountAmount?: number;
  actualAmount?: number;
  status?: OrderStatus;
  paymentMethod?: string;
  paymentTime?: string;
  createdAt?: string;
}
```

**âœ… å­—æ®µå®Œå…¨åŒ¹é…ï¼ŒOpenAPIè‡ªåŠ¨ç”Ÿæˆä¿è¯ç±»å‹ä¸€è‡´æ€§**

### ğŸ› ï¸ **CRUDåŠŸèƒ½å®Œæ•´æ€§**

| æ“ä½œ | åç«¯å®ç° | å‰ç«¯è°ƒç”¨ | çŠ¶æ€ |
|------|---------|----------|------|
| Createï¼ˆåˆ›å»ºè®¢å•ï¼‰ | âœ… OrderService.createOrder() | âœ… Portalè®¢å•åˆ›å»ºé¡µ | å®Œæ•´ |
| Readï¼ˆæŸ¥è¯¢è®¢å•ï¼‰ | âœ… ä¹°å®¶/å–å®¶/è¯¦æƒ…æ¥å£ | âœ… Portal/Adminåˆ—è¡¨é¡µ | å®Œæ•´ |
| Updateï¼ˆæ›´æ–°è®¢å•ï¼‰ | âœ… å–æ¶ˆ/æ”¯ä»˜/å‘è´§ç­‰ | âœ… è®¢å•æ“ä½œæŒ‰é’® | å®Œæ•´ |
| Deleteï¼ˆåˆ é™¤è®¢å•ï¼‰ | âŒ æœªå®ç°ï¼ˆè½¯åˆ é™¤ï¼‰ | âŒ æœªæä¾›å…¥å£ | ç¬¦åˆè®¾è®¡ |

### ğŸ¨ **é¡µé¢å±•ç¤º**

#### Portalç«¯ï¼ˆç”¨æˆ·è®¢å•é¡µé¢ï¼‰
```typescript
// å±•ç¤ºç‰¹ç‚¹ï¼š
âœ… ä¹°å®¶/å–å®¶è®¢å•Tabåˆ‡æ¢
âœ… è®¢å•çŠ¶æ€ç­›é€‰ï¼ˆå…¨éƒ¨/å¾…æ”¯ä»˜/å¾…å‘è´§/å·²å‘è´§/å·²å®Œæˆ/å·²å–æ¶ˆï¼‰
âœ… åˆ†é¡µåŠ è½½
âœ… OrderCardç»„ä»¶ç¾åŒ–å±•ç¤º
âœ… è®¢å•æ“ä½œæŒ‰é’®ï¼ˆæ”¯ä»˜/å–æ¶ˆ/ç¡®è®¤æ”¶è´§/è¯„ä»·ï¼‰
```

#### Adminç«¯ï¼ˆç®¡ç†å‘˜è®¢å•åˆ—è¡¨ï¼‰
```typescript
// å±•ç¤ºç‰¹ç‚¹ï¼š
âœ… ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»è®¢å•/å¾…æ”¯ä»˜/å·²å®Œæˆ/é€€æ¬¾ä¸­ï¼‰
âœ… å¤šç»´åº¦æœç´¢ï¼ˆå…³é”®è¯/çŠ¶æ€/æ—¶é—´èŒƒå›´ï¼‰
âœ… è¡¨æ ¼å±•ç¤ºï¼ˆå•†å“/ä¹°å®¶/å–å®¶/é‡‘é¢/çŠ¶æ€/æ“ä½œï¼‰
âœ… æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
âœ… å“åº”å¼å¸ƒå±€
```

### ğŸ’¡ **æ”¹è¿›å»ºè®®**

1. **ç®¡ç†å‘˜è®¢å•åˆ—è¡¨API** âš ï¸
   - **é—®é¢˜**: `orderService.listOrdersAdmin()` åç«¯æœªå®ç°
   - **ç°çŠ¶**: å‰ç«¯å·²è°ƒç”¨ï¼Œä½†åç«¯ç¼ºå°‘ç®¡ç†å‘˜è§†è§’çš„è®¢å•åˆ—è¡¨æ¥å£
   - **å»ºè®®**: 
     ```java
     @GetMapping("/admin/orders")
     @PreAuthorize("hasAnyRole('ADMIN', 'SUPER_ADMIN')")
     public ApiResponse<Page<OrderResponse>> listOrdersAdmin(
         @RequestParam(required = false) String keyword,
         @RequestParam(required = false) OrderStatus status,
         @RequestParam(required = false) Long campusId,
         @RequestParam(required = false) Long sellerId,
         @RequestParam(required = false) Long buyerId,
         @RequestParam(required = false) String startDate,
         @RequestParam(required = false) String endDate,
         @RequestParam(defaultValue = "0") int page,
         @RequestParam(defaultValue = "20") int size
     ) { ... }
     ```

2. **è®¢å•ç»Ÿè®¡æ•°æ®** âš ï¸
   - **é—®é¢˜**: Adminç«¯ç»Ÿè®¡å¡ç‰‡ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
   - **å»ºè®®**: æ·»åŠ è®¢å•ç»Ÿè®¡æ¥å£ `GET /api/admin/orders/statistics`

---

## 2ï¸âƒ£ é€€æ¬¾ç®¡ç†æ¨¡å— ğŸ’°

### âš ï¸ **æ€»ä½“è¯„ä»·ï¼šè‰¯å¥½**

é€€æ¬¾ç®¡ç†åŠŸèƒ½åŸºæœ¬å®Œæ•´ï¼Œä½†å‰ç«¯æœ‰éƒ¨åˆ†å­—æ®µæœªé€‚é…ï¼Œéœ€è¦å°å¹…è°ƒæ•´ã€‚

### ğŸ“¡ **APIä½¿ç”¨æƒ…å†µ**

#### åç«¯APIï¼ˆå®Œæ•´å®ç°ï¼‰
```java
// Controllerå±‚
POST /orders/{orderNo}/refunds        - ç”³è¯·é€€æ¬¾ âœ…
PUT  /admin/refunds/{refundNo}/approve - æ‰¹å‡†é€€æ¬¾ âœ…
PUT  /admin/refunds/{refundNo}/reject  - æ‹’ç»é€€æ¬¾ âœ…
GET  /refunds                          - æˆ‘çš„é€€æ¬¾åˆ—è¡¨ âœ…
GET  /refunds/{refundNo}               - é€€æ¬¾è¯¦æƒ… âœ…
GET  /admin/refunds                    - ç®¡ç†å‘˜é€€æ¬¾åˆ—è¡¨ âœ…
```

#### å‰ç«¯è°ƒç”¨ï¼ˆåŸºæœ¬é›†æˆï¼‰
```typescript
// Portalç«¯
frontend/packages/portal/src/pages/RefundList/index.tsx
- refundService.listMyRefunds() âœ… è°ƒç”¨ç”¨æˆ·é€€æ¬¾åˆ—è¡¨

// Adminç«¯
frontend/packages/admin/src/pages/Orders/RefundManagement.tsx
- refundService.listAllRefunds() âœ… è°ƒç”¨ç®¡ç†å‘˜é€€æ¬¾åˆ—è¡¨
- refundService.reviewRefund()   âœ… å®¡æ ¸é€€æ¬¾
```

### ğŸ”— **å­—æ®µåŒ¹é…åº¦ï¼š85%**

#### åç«¯è¿”å›å­—æ®µ
```java
// RefundRequest.java
{
  "refundNo": String,
  "orderNo": String,
  "applicantId": Long,
  "reason": String,
  "evidence": Map<String, Object>, // JSONå­—æ®µ
  "status": RefundStatus,
  "channel": String,
  "amount": BigDecimal,
  "retryCount": Integer,
  "lastError": String,
  "createdAt": LocalDateTime,
  "updatedAt": LocalDateTime
}
```

#### å‰ç«¯æœŸæœ›å­—æ®µï¼ˆéƒ¨åˆ†ç¼ºå¤±ï¼‰
```typescript
// frontend/packages/shared/src/services/refund.ts
interface Refund {
  id: number;
  refundNo: string;
  orderNo: string;
  goodsId: number;        // âŒ åç«¯æœªè¿”å›
  goodsTitle: string;     // âŒ åç«¯æœªè¿”å›
  goodsImage?: string;    // âŒ åç«¯æœªè¿”å›
  buyerId: number;        // âŒ åç«¯è¿”å›çš„æ˜¯ applicantId
  buyerName: string;      // âŒ åç«¯æœªè¿”å›
  sellerId: number;       // âŒ åç«¯æœªè¿”å›
  sellerName: string;     // âŒ åç«¯æœªè¿”å›
  refundAmount: number;   // âœ… å¯¹åº” amount
  refundReason: string;   // âœ… å¯¹åº” reason
  status: string;
  // ...
}
```

**âš ï¸ å­—æ®µä¸å®Œå…¨åŒ¹é…ï¼Œéœ€è¦åç«¯è¿”å›æ›´å¤šå…³è”æ•°æ®**

### ğŸ› ï¸ **CRUDåŠŸèƒ½å®Œæ•´æ€§**

| æ“ä½œ | åç«¯å®ç° | å‰ç«¯è°ƒç”¨ | çŠ¶æ€ |
|------|---------|----------|------|
| Createï¼ˆç”³è¯·é€€æ¬¾ï¼‰ | âœ… RefundService.applyRefund() | âœ… Portalç”³è¯·é¡µé¢ | å®Œæ•´ |
| Readï¼ˆæŸ¥è¯¢é€€æ¬¾ï¼‰ | âœ… ç”¨æˆ·/ç®¡ç†å‘˜åˆ—è¡¨ | âœ… Portal/Adminåˆ—è¡¨é¡µ | å®Œæ•´ |
| Updateï¼ˆå®¡æ ¸é€€æ¬¾ï¼‰ | âœ… æ‰¹å‡†/æ‹’ç» | âœ… Adminå®¡æ ¸å¼¹çª— | å®Œæ•´ |
| Deleteï¼ˆåˆ é™¤é€€æ¬¾ï¼‰ | âŒ æœªå®ç° | âŒ æœªæä¾›å…¥å£ | ç¬¦åˆè®¾è®¡ |

### ğŸ¨ **é¡µé¢å±•ç¤º**

#### Portalç«¯ï¼ˆç”¨æˆ·é€€æ¬¾åˆ—è¡¨ï¼‰
```typescript
// å±•ç¤ºç‰¹ç‚¹ï¼š
âœ… é€€æ¬¾åˆ—è¡¨å¡ç‰‡å±•ç¤º
âœ… çŠ¶æ€ç­›é€‰ï¼ˆå…¨éƒ¨/å¾…å¤„ç†/å·²æ‰¹å‡†/å·²æ‹’ç»/å·²å®Œæˆï¼‰
âœ… åˆ†é¡µåŠ è½½
âœ… é€€æ¬¾è¯¦æƒ…æŸ¥çœ‹
âš ï¸ éƒ¨åˆ†å­—æ®µç¼ºå¤±ï¼ˆå•†å“ä¿¡æ¯ã€å–å®¶ä¿¡æ¯ï¼‰
```

#### Adminç«¯ï¼ˆé€€æ¬¾ç®¡ç†ï¼‰
```typescript
// å±•ç¤ºç‰¹ç‚¹ï¼š
âœ… ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»é€€æ¬¾/å¾…å®¡æ ¸/å·²æ‰¹å‡†/å·²æ‹’ç»ï¼‰
âœ… å¤šç»´åº¦æœç´¢ï¼ˆå…³é”®è¯/çŠ¶æ€/æ—¶é—´èŒƒå›´ï¼‰
âœ… è¡¨æ ¼å±•ç¤ºï¼ˆé€€æ¬¾å•å·/è®¢å•å·/å•†å“/ä¹°å®¶/é‡‘é¢/çŠ¶æ€ï¼‰
âœ… å•ä¸ªå®¡æ ¸å¼¹çª—ï¼ˆæ‰¹å‡†/æ‹’ç»ï¼‰
âœ… æ‰¹é‡å®¡æ ¸åŠŸèƒ½
âš ï¸ å•†å“å›¾ç‰‡ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
```

### ğŸ’¡ **æ”¹è¿›å»ºè®®**

1. **åç«¯è¿”å›å­—æ®µå¢å¼º** âš ï¸
   - **é—®é¢˜**: å‰ç«¯éœ€è¦å•†å“ã€ä¹°å®¶ã€å–å®¶ä¿¡æ¯ï¼Œä½†åç«¯åªè¿”å›ID
   - **å»ºè®®**: åˆ›å»º `RefundResponseDTO` åŒ…å«å…³è”æ•°æ®
     ```java
     public record RefundResponseDTO(
         Long id,
         String refundNo,
         String orderNo,
         // å•†å“ä¿¡æ¯
         Long goodsId,
         String goodsTitle,
         String goodsImage,
         // ä¹°å®¶ä¿¡æ¯
         Long buyerId,
         String buyerUsername,
         // å–å®¶ä¿¡æ¯
         Long sellerId,
         String sellerUsername,
         // é€€æ¬¾ä¿¡æ¯
         BigDecimal amount,
         String reason,
         Map<String, Object> evidence,
         RefundStatus status,
         LocalDateTime createdAt,
         LocalDateTime updatedAt
     ) {}
     ```

2. **ç»Ÿè®¡æ¥å£** âš ï¸
   - **é—®é¢˜**: Adminç«¯ç»Ÿè®¡å¡ç‰‡ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
   - **å»ºè®®**: æ·»åŠ  `GET /api/admin/refunds/statistics`

3. **å‰ç«¯ç±»å‹å®šä¹‰ç»Ÿä¸€** âš ï¸
   - **é—®é¢˜**: `shared/services/refund.ts` çš„ `Refund` ç±»å‹ä¸åç«¯ä¸ä¸€è‡´
   - **å»ºè®®**: ä½¿ç”¨OpenAPIç”Ÿæˆçš„ç±»å‹ï¼Œæˆ–æ‰‹åŠ¨åŒæ­¥

---

## 3ï¸âƒ£ æ”¯ä»˜ç®¡ç†æ¨¡å— ğŸ’³

### âš ï¸ **æ€»ä½“è¯„ä»·ï¼šéœ€å®Œå–„**

æ”¯ä»˜ç®¡ç†åŠŸèƒ½éƒ¨åˆ†å®ç°ï¼Œä½†ç¼ºå°‘ç®¡ç†å‘˜è§†è§’çš„æ”¯ä»˜è®°å½•ç®¡ç†æ¥å£ã€‚

### ğŸ“¡ **APIä½¿ç”¨æƒ…å†µ**

#### åç«¯APIï¼ˆéƒ¨åˆ†å®ç°ï¼‰
```java
// Controllerå±‚
POST /payment/create           - åˆ›å»ºæ”¯ä»˜ âŒ å·²åºŸå¼ƒ
POST /payment/wechat/notify    - å¾®ä¿¡æ”¯ä»˜å›è°ƒ âœ…
POST /payment/alipay/notify    - æ”¯ä»˜å®å›è°ƒ âœ…
GET  /payment/status/{orderNo} - æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ âœ…

// âŒ ç¼ºå¤±æ¥å£ï¼š
// GET  /admin/payments          - æ”¯ä»˜è®°å½•åˆ—è¡¨
// GET  /admin/payments/{orderNo} - æ”¯ä»˜è¯¦æƒ…
// GET  /admin/payments/statistics - æ”¯ä»˜ç»Ÿè®¡
```

#### å‰ç«¯è°ƒç”¨ï¼ˆç©ºå£³å®ç°ï¼‰
```typescript
// Adminç«¯
frontend/packages/admin/src/pages/Payment/PaymentList.tsx
- paymentService.listPayments() âš ï¸ è°ƒç”¨ä½†åç«¯æœªå®ç°
- paymentService.getPaymentStatistics() âš ï¸ è°ƒç”¨ä½†åç«¯æœªå®ç°

// Portalç«¯
frontend/packages/portal/src/pages/Payment/
- PaymentStatus.tsx  âœ… æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢ï¼ˆä½¿ç”¨orderServiceï¼‰
- PaymentResult.tsx  âœ… æ”¯ä»˜ç»“æœå±•ç¤º
- PaymentMethods.tsx âœ… æ”¯ä»˜æ–¹å¼ç®¡ç†
```

### ğŸ”— **å­—æ®µåŒ¹é…åº¦ï¼š60%**

#### åç«¯å®ç°
```java
// æ”¯ä»˜åŠŸèƒ½åˆ†æ•£åœ¨ OrderService ä¸­
// æ²¡æœ‰ç‹¬ç«‹çš„ PaymentDTO/PaymentResponse
// æ”¯ä»˜ä¿¡æ¯åµŒå…¥åœ¨ Order ä¸­
```

#### å‰ç«¯æœŸæœ›å­—æ®µ
```typescript
// frontend/packages/shared/src/services/payment.ts
interface PaymentRecord {
  id: number;
  orderNo: string;
  amount: number;
  paymentMethod: string;
  status: string;
  paidAt?: string;
  // ...
}

// âŒ åç«¯æ²¡æœ‰å¯¹åº”çš„å®ä½“å’Œæ¥å£
```

### ğŸ› ï¸ **CRUDåŠŸèƒ½å®Œæ•´æ€§**

| æ“ä½œ | åç«¯å®ç° | å‰ç«¯è°ƒç”¨ | çŠ¶æ€ |
|------|---------|----------|------|
| Createï¼ˆåˆ›å»ºæ”¯ä»˜ï¼‰ | âœ… OrderService.payOrder() | âœ… è®¢å•æ”¯ä»˜æµç¨‹ | å®Œæ•´ |
| Readï¼ˆæŸ¥è¯¢æ”¯ä»˜ï¼‰ | âš ï¸ é€šè¿‡è®¢å•æŸ¥è¯¢ | âš ï¸ å‰ç«¯æœŸæœ›ç‹¬ç«‹æ¥å£ | éƒ¨åˆ†ç¼ºå¤± |
| Updateï¼ˆæ›´æ–°æ”¯ä»˜ï¼‰ | âœ… æ”¯ä»˜å›è°ƒæ›´æ–° | N/A | å®Œæ•´ |
| Deleteï¼ˆåˆ é™¤æ”¯ä»˜ï¼‰ | N/A | N/A | ä¸éœ€è¦ |

### ğŸ¨ **é¡µé¢å±•ç¤º**

#### Portalç«¯ï¼ˆæ”¯ä»˜æµç¨‹ï¼‰
```typescript
// PaymentStatus.tsx - æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢
âœ… æ”¯ä»˜è¿›åº¦å±•ç¤º
âœ… å€’è®¡æ—¶æç¤º
âœ… å®æ—¶çŠ¶æ€è½®è¯¢
âœ… WebSocketå®æ—¶æ›´æ–°

// PaymentResult.tsx - æ”¯ä»˜ç»“æœ
âœ… æˆåŠŸ/å¤±è´¥/è¶…æ—¶çŠ¶æ€å±•ç¤º
âœ… è®¢å•ä¿¡æ¯å±•ç¤º
âœ… æ“ä½œæŒ‰é’®ï¼ˆæŸ¥çœ‹è®¢å•/ç»§ç»­è´­ç‰©ï¼‰
```

#### Adminç«¯ï¼ˆæ”¯ä»˜ç®¡ç†ï¼‰
```typescript
// PaymentList.tsx - æ”¯ä»˜è®°å½•åˆ—è¡¨
âš ï¸ è¡¨æ ¼ç»“æ„å®Œæ•´
âš ï¸ ç­›é€‰æ¡ä»¶å®Œæ•´
âŒ æ•°æ®æ¥æºæœªå®ç°ï¼ˆè°ƒç”¨listPaymentsè¿”å›ç©ºï¼‰
âŒ ç»Ÿè®¡å¡ç‰‡æœªå®ç°
```

### ğŸ’¡ **æ”¹è¿›å»ºè®®**

1. **æ–°å¢æ”¯ä»˜ç®¡ç†æ¥å£** âŒ **ä¼˜å…ˆçº§ï¼šé«˜**
   ```java
   @RestController
   @RequestMapping("/api/admin/payments")
   public class PaymentAdminController {
       
       // æ”¯ä»˜è®°å½•åˆ—è¡¨
       @GetMapping
       public ApiResponse<Page<PaymentRecordDTO>> listPayments(
           @RequestParam(required = false) String keyword,
           @RequestParam(required = false) String status,
           @RequestParam(required = false) String paymentMethod,
           @RequestParam(required = false) String startDate,
           @RequestParam(required = false) String endDate,
           @RequestParam(defaultValue = "0") int page,
           @RequestParam(defaultValue = "20") int size
       ) { ... }
       
       // æ”¯ä»˜è¯¦æƒ…
       @GetMapping("/{orderNo}")
       public ApiResponse<PaymentRecordDTO> getPaymentDetail(
           @PathVariable String orderNo
       ) { ... }
       
       // æ”¯ä»˜ç»Ÿè®¡
       @GetMapping("/statistics")
       public ApiResponse<PaymentStatisticsDTO> getStatistics(
           @RequestParam(required = false) String startDate,
           @RequestParam(required = false) String endDate
       ) { ... }
   }
   ```

2. **åˆ›å»ºæ”¯ä»˜DTO** âš ï¸
   ```java
   public record PaymentRecordDTO(
       Long id,
       String orderNo,
       String transactionId,
       BigDecimal amount,
       String paymentMethod,
       PaymentStatus status,
       LocalDateTime paidAt,
       LocalDateTime createdAt,
       // å…³è”è®¢å•ä¿¡æ¯
       String goodsTitle,
       String buyerUsername,
       String sellerUsername
   ) {}
   ```

3. **æ”¯ä»˜æ—¥å¿—æŸ¥è¯¢** âš ï¸
   - å½“å‰ `PaymentLog` å®ä½“å·²å­˜åœ¨ï¼Œä½†ç¼ºå°‘æŸ¥è¯¢æ¥å£
   - å»ºè®®æ·»åŠ  `GET /api/admin/payment-logs` æ¥å£

---

## 4ï¸âƒ£ ç‰©æµç®¡ç†æ¨¡å— ğŸšš

### âŒ **æ€»ä½“è¯„ä»·ï¼šæœªé›†æˆ**

ç‰©æµç®¡ç†åç«¯åŠŸèƒ½å®Œæ•´ï¼Œä½†å‰ç«¯è°ƒç”¨å®Œå…¨æœªé›†æˆï¼Œé¡µé¢æ˜¯ç©ºå£³ã€‚

### ğŸ“¡ **APIä½¿ç”¨æƒ…å†µ**

#### åç«¯APIï¼ˆå®Œæ•´å®ç°ï¼‰
```java
// Controllerå±‚
POST /logistics/create              - åˆ›å»ºç‰©æµ âœ…
GET  /logistics/order/{orderId}     - æŸ¥è¯¢ç‰©æµ âœ…
GET  /logistics/tracking/{number}   - æ ¹æ®å•å·æŸ¥è¯¢ âœ…
POST /logistics/sync/{orderId}      - æ‰‹åŠ¨åŒæ­¥ âœ…
GET  /logistics/statistics          - ç‰©æµç»Ÿè®¡ âœ…
POST /logistics/mark-overtime       - æ ‡è®°è¶…æ—¶ âœ…
```

#### å‰ç«¯è°ƒç”¨ï¼ˆæœªé›†æˆï¼‰
```typescript
// Portalç«¯
frontend/packages/portal/src/pages/Logistics/index.tsx
- logisticsService.trackLogistics() âŒ è°ƒç”¨ä½†æŠ›å¼‚å¸¸
  ```typescript
  throw new Error('ç‰©æµè¿½è¸ªåŠŸèƒ½æš‚æœªå®ç°');
  ```

// Adminç«¯
frontend/packages/admin/src/pages/Logistics/LogisticsList.tsx
- logisticsService.listLogistics() âŒ è°ƒç”¨ä½†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
  ```typescript
  const mockData = { content: [...] }; // å†™æ­»çš„å‡æ•°æ®
  ```

// Shared Service
frontend/packages/shared/src/services/logistics.ts
- getOrderLogistics()  âŒ æ–¹æ³•å­˜åœ¨ä½†æŠ›å¼‚å¸¸
- trackLogistics()     âŒ æ–¹æ³•å­˜åœ¨ä½†æŠ›å¼‚å¸¸
```

### ğŸ”— **å­—æ®µåŒ¹é…åº¦ï¼š95%**

#### åç«¯è¿”å›å­—æ®µ
```java
// LogisticsDTO.java (å®Œæ•´å®ç°)
{
  "id": Long,
  "orderId": Long,
  "trackingNumber": String,
  "logisticsCompany": LogisticsCompany,
  "status": LogisticsStatus,
  "currentLocation": String,
  "estimatedDeliveryTime": LocalDateTime,
  "actualDeliveryTime": LocalDateTime,
  "trackRecords": List<LogisticsTrackRecord>,
  "syncCount": Integer,
  "lastSyncTime": LocalDateTime,
  "isOvertime": Boolean
}
```

#### å‰ç«¯ç±»å‹å®šä¹‰
```typescript
// frontend/packages/shared/src/types/entity.ts
interface Logistics {
  id: number;
  orderId: number;
  expressCode: string;    // âš ï¸ å¯¹åº” logisticsCompany
  expressName: string;    // âš ï¸ éœ€è¦æ˜ å°„
  trackingNumber: string;
  status: string;
  currentLocation?: string;
  estimatedTime?: string;
  actualTime?: string;
  tracks: LogisticsTrack[];
  // ...
}

// âœ… å­—æ®µåŸºæœ¬åŒ¹é…ï¼Œåªéœ€è¦åšæšä¸¾æ˜ å°„
```

### ğŸ› ï¸ **CRUDåŠŸèƒ½å®Œæ•´æ€§**

| æ“ä½œ | åç«¯å®ç° | å‰ç«¯è°ƒç”¨ | çŠ¶æ€ |
|------|---------|----------|------|
| Createï¼ˆåˆ›å»ºç‰©æµï¼‰ | âœ… LogisticsService.createLogistics() | âŒ æœªè°ƒç”¨ | åç«¯å®Œæ•´ |
| Readï¼ˆæŸ¥è¯¢ç‰©æµï¼‰ | âœ… å¤šç§æŸ¥è¯¢æ¥å£ | âŒ æŠ›å¼‚å¸¸ | åç«¯å®Œæ•´ |
| Updateï¼ˆåŒæ­¥ç‰©æµï¼‰ | âœ… æ‰‹åŠ¨/æ‰¹é‡åŒæ­¥ | âŒ æœªè°ƒç”¨ | åç«¯å®Œæ•´ |
| Deleteï¼ˆåˆ é™¤ç‰©æµï¼‰ | âŒ æœªå®ç° | N/A | ä¸éœ€è¦ |

### ğŸ¨ **é¡µé¢å±•ç¤º**

#### Portalç«¯ï¼ˆç‰©æµè¿½è¸ªé¡µé¢ï¼‰
```typescript
// frontend/packages/portal/src/pages/Logistics/index.tsx
âœ… UIç•Œé¢å®Œæ•´ï¼ˆå¿«é€’å…¬å¸é€‰æ‹©ã€å•å·è¾“å…¥ã€ç»“æœå±•ç¤ºï¼‰
âœ… Timelineç»„ä»¶å±•ç¤ºç‰©æµè½¨è¿¹
âœ… CSSæ ·å¼å®Œæ•´
âŒ æ‰€æœ‰APIè°ƒç”¨éƒ½æŠ›å¼‚å¸¸
âŒ æ— æ³•å®é™…ä½¿ç”¨
```

#### Adminç«¯ï¼ˆç‰©æµç®¡ç†åˆ—è¡¨ï¼‰
```typescript
// frontend/packages/admin/src/pages/Logistics/LogisticsList.tsx
âœ… è¡¨æ ¼ç»“æ„å®Œæ•´
âœ… ç­›é€‰æ¡ä»¶å®Œæ•´
âœ… ç»Ÿè®¡å¡ç‰‡å¸ƒå±€å®Œæ•´
âŒ ä½¿ç”¨å†™æ­»çš„æ¨¡æ‹Ÿæ•°æ®
âŒ æ— æ³•æŸ¥è¯¢çœŸå®ç‰©æµä¿¡æ¯
```

### ğŸ’¡ **æ”¹è¿›å»ºè®®**

1. **å‰ç«¯Serviceç«‹å³é›†æˆ** âŒ **ä¼˜å…ˆçº§ï¼šæœ€é«˜**
   ```typescript
   // frontend/packages/shared/src/services/logistics.ts
   
   // âŒ å½“å‰å®ç°
   async getOrderLogistics(_orderId: number): Promise<Logistics> {
     throw new Error('ç‰©æµæŸ¥è¯¢åŠŸèƒ½æš‚æœªå®ç°');
   }
   
   // âœ… åº”è¯¥ä¿®æ”¹ä¸º
   async getOrderLogistics(orderId: number): Promise<Logistics> {
     const api = getApi();
     const response = await api.getLogisticsByOrderId({ orderId });
     return response.data.data as Logistics;
   }
   
   // âŒ å½“å‰å®ç°
   async trackLogistics(_expressCode: string, _trackingNumber: string): Promise<Logistics> {
     throw new Error('ç‰©æµè¿½è¸ªåŠŸèƒ½æš‚æœªå®ç°');
   }
   
   // âœ… åº”è¯¥ä¿®æ”¹ä¸º
   async trackLogistics(expressCode: string, trackingNumber: string): Promise<Logistics> {
     const api = getApi();
     const response = await api.getLogisticsByTrackingNumber({ trackingNumber });
     // æ˜ å°„ logisticsCompany -> expressCode
     const data = response.data.data;
     return {
       ...data,
       expressCode: data.logisticsCompany,
       expressName: COMPANY_NAMES[data.logisticsCompany],
     } as Logistics;
   }
   ```

2. **Adminç«¯ç§»é™¤æ¨¡æ‹Ÿæ•°æ®** âŒ
   ```typescript
   // âŒ å½“å‰
   const mockData = { content: [...] };
   
   // âœ… åº”è¯¥æ”¹ä¸º
   const { data, isLoading } = useQuery({
     queryKey: ['logistics', 'list', queryParams],
     queryFn: () => logisticsService.listLogistics(queryParams),
   });
   ```

3. **OpenAPIç”Ÿæˆ** âš ï¸
   - æ£€æŸ¥ `api/api/default-api.ts` æ˜¯å¦åŒ…å«ç‰©æµç›¸å…³æ–¹æ³•
   - å¦‚æœç¼ºå¤±ï¼Œéœ€è¦é‡æ–°è¿è¡Œ `pnpm codegen`

4. **æšä¸¾æ˜ å°„** âš ï¸
   - åç«¯ï¼š`LogisticsCompany.SHUNFENG`
   - å‰ç«¯ï¼š`expressCode: "SF"`
   - éœ€è¦ç»Ÿä¸€æˆ–åšæ˜ å°„

---

## ğŸ¯ æ€»ç»“ä¸å»ºè®®

### âœ… **åšå¾—å¥½çš„åœ°æ–¹**

1. **è®¢å•ç®¡ç†æ¨¡å—**ï¼šå‰åç«¯é›†æˆå®Œç¾ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ‡æ†
2. **ä»£ç è§„èŒƒ**ï¼šä½¿ç”¨OpenAPIè‡ªåŠ¨ç”Ÿæˆï¼Œç±»å‹å®‰å…¨æœ‰ä¿éšœ
3. **ç»„ä»¶åŒ–**ï¼šOrderCardã€RefundCardç­‰ç»„ä»¶å¤ç”¨æ€§å¥½
4. **çŠ¶æ€ç®¡ç†**ï¼šReact Queryç»Ÿä¸€ç®¡ç†å¼‚æ­¥çŠ¶æ€

### âš ï¸ **éœ€è¦æ”¹è¿›çš„åœ°æ–¹**

1. **ç‰©æµç®¡ç†**ï¼šå‰ç«¯å®Œå…¨æœªé›†æˆï¼Œéœ€ç«‹å³ä¿®å¤
2. **æ”¯ä»˜ç®¡ç†**ï¼šç¼ºå°‘ç‹¬ç«‹çš„æ”¯ä»˜è®°å½•ç®¡ç†æ¥å£
3. **é€€æ¬¾å­—æ®µ**ï¼šåç«¯éœ€è¦è¿”å›æ›´å¤šå…³è”æ•°æ®
4. **ç»Ÿè®¡æ¥å£**ï¼šå¤šä¸ªæ¨¡å—çš„ç»Ÿè®¡æ•°æ®ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

### ğŸš€ **ä¼˜å…ˆçº§ä¿®å¤é¡ºåº**

| ä¼˜å…ˆçº§ | æ¨¡å— | ä»»åŠ¡ | é¢„ä¼°å·¥ä½œé‡ |
|--------|------|------|------------|
| ğŸ”´ P0 | ç‰©æµç®¡ç† | å‰ç«¯Serviceé›†æˆçœŸå®API | 2å°æ—¶ |
| ğŸ”´ P0 | ç‰©æµç®¡ç† | Adminç«¯ç§»é™¤æ¨¡æ‹Ÿæ•°æ® | 1å°æ—¶ |
| ğŸŸ  P1 | æ”¯ä»˜ç®¡ç† | æ–°å¢Adminæ”¯ä»˜è®°å½•æ¥å£ | 4å°æ—¶ |
| ğŸŸ  P1 | é€€æ¬¾ç®¡ç† | åç«¯è¿”å›å…³è”æ•°æ®DTO | 2å°æ—¶ |
| ğŸŸ¡ P2 | è®¢å•ç®¡ç† | æ–°å¢Adminè®¢å•åˆ—è¡¨æ¥å£ | 2å°æ—¶ |
| ğŸŸ¡ P2 | ç»Ÿè®¡æ¥å£ | å„æ¨¡å—ç»Ÿè®¡æ¥å£å®ç° | 4å°æ—¶ |

### ğŸ“ **å…·ä½“è¡ŒåŠ¨é¡¹**

#### **ç«‹å³æ‰§è¡Œï¼ˆä»Šå¤©ï¼‰**
1. ä¿®å¤ `frontend/packages/shared/src/services/logistics.ts`
   - ç§»é™¤æ‰€æœ‰ `throw new Error()`
   - è°ƒç”¨çœŸå®API
   - æµ‹è¯•ç‰©æµè¿½è¸ªåŠŸèƒ½

2. ä¿®å¤ `frontend/packages/admin/src/pages/Logistics/LogisticsList.tsx`
   - ç§»é™¤ `mockData`
   - ä½¿ç”¨ `useQuery` è°ƒç”¨çœŸå®æ•°æ®
   - æµ‹è¯•åˆ—è¡¨å±•ç¤º

#### **æœ¬å‘¨å®Œæˆ**
3. å®ç°æ”¯ä»˜ç®¡ç†åç«¯æ¥å£
   - `GET /api/admin/payments`
   - `GET /api/admin/payments/{orderNo}`
   - `GET /api/admin/payments/statistics`

4. ä¼˜åŒ–é€€æ¬¾DTO
   - åˆ›å»º `RefundResponseDTO`
   - åŒ…å«å•†å“ã€ä¹°å®¶ã€å–å®¶ä¿¡æ¯
   - æ›´æ–°å‰ç«¯ç±»å‹å®šä¹‰

#### **ä¸‹å‘¨å®Œæˆ**
5. è¡¥å……ç»Ÿè®¡æ¥å£
   - è®¢å•ç»Ÿè®¡
   - é€€æ¬¾ç»Ÿè®¡
   - æ”¯ä»˜ç»Ÿè®¡

6. ä»£ç å®¡æŸ¥å’Œæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•æ‰€æœ‰CRUDåŠŸèƒ½
   - æ£€æŸ¥å­—æ®µæ˜ å°„
   - æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“Š **é™„å½•ï¼šAPIæ¸…å•**

### è®¢å•ç®¡ç†API
| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| GET | /api/orders/buyer | ä¹°å®¶è®¢å•åˆ—è¡¨ | âœ… |
| GET | /api/orders/seller | å–å®¶è®¢å•åˆ—è¡¨ | âœ… |
| GET | /api/orders/{orderNo} | è®¢å•è¯¦æƒ… | âœ… |
| POST | /api/orders | åˆ›å»ºè®¢å• | âœ… |
| PUT | /api/orders/{orderNo}/cancel | å–æ¶ˆè®¢å• | âœ… |
| GET | /api/admin/orders | ç®¡ç†å‘˜è®¢å•åˆ—è¡¨ | âŒ ç¼ºå¤± |
| GET | /api/admin/orders/statistics | è®¢å•ç»Ÿè®¡ | âŒ ç¼ºå¤± |

### é€€æ¬¾ç®¡ç†API
| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| POST | /orders/{orderNo}/refunds | ç”³è¯·é€€æ¬¾ | âœ… |
| PUT | /admin/refunds/{refundNo}/approve | æ‰¹å‡†é€€æ¬¾ | âœ… |
| PUT | /admin/refunds/{refundNo}/reject | æ‹’ç»é€€æ¬¾ | âœ… |
| GET | /refunds | æˆ‘çš„é€€æ¬¾åˆ—è¡¨ | âœ… |
| GET | /refunds/{refundNo} | é€€æ¬¾è¯¦æƒ… | âœ… |
| GET | /admin/refunds | ç®¡ç†å‘˜é€€æ¬¾åˆ—è¡¨ | âœ… |
| GET | /admin/refunds/statistics | é€€æ¬¾ç»Ÿè®¡ | âŒ ç¼ºå¤± |

### æ”¯ä»˜ç®¡ç†API
| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| POST | /payment/wechat/notify | å¾®ä¿¡æ”¯ä»˜å›è°ƒ | âœ… |
| POST | /payment/alipay/notify | æ”¯ä»˜å®å›è°ƒ | âœ… |
| GET | /payment/status/{orderNo} | æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ | âœ… |
| GET | /api/admin/payments | æ”¯ä»˜è®°å½•åˆ—è¡¨ | âŒ ç¼ºå¤± |
| GET | /api/admin/payments/{orderNo} | æ”¯ä»˜è¯¦æƒ… | âŒ ç¼ºå¤± |
| GET | /api/admin/payments/statistics | æ”¯ä»˜ç»Ÿè®¡ | âŒ ç¼ºå¤± |

### ç‰©æµç®¡ç†API
| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| POST | /logistics/create | åˆ›å»ºç‰©æµ | âœ… |
| GET | /logistics/order/{orderId} | æŸ¥è¯¢ç‰©æµ | âœ… |
| GET | /logistics/tracking/{number} | æ ¹æ®å•å·æŸ¥è¯¢ | âœ… |
| POST | /logistics/sync/{orderId} | æ‰‹åŠ¨åŒæ­¥ | âœ… |
| GET | /logistics/statistics | ç‰©æµç»Ÿè®¡ | âœ… |
| POST | /logistics/mark-overtime | æ ‡è®°è¶…æ—¶ | âœ… |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-10  
**ä¸‹æ¬¡æ£€æŸ¥æ—¶é—´**: 2025-11-17  

**æ£€æŸ¥äºº**: BaSui ğŸ˜
