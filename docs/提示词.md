# 项目提示词（Campus Lite Marketplace）

## 1. 系统概要
- 项目目标：构建覆盖商品交易、支付、消息、社区、运维治理的一站式校园集市平台。
- 架构形态：后端 Java 单体（Spring Boot 3.2 + PostgreSQL + Redis），前端 React Monorepo（pnpm workspace，shared + portal + admin）。
- 关键特性：JWT + RBAC 权限体系、OpenAPI 契约、WebSocket 即时通讯、Docker Compose 多环境部署、Prometheus/Grafana 监控。

## 2. 后端速览
| 模块 | 说明 | 关键目录 |
| ---- | ---- | -------- |
| `common` | 配置、DTO、异常、工具、切面、枚举、权限码、角色定义 | `backend/src/main/java/com/campus/marketplace/common` |
| `controller` | REST 接口（含 admin、用户、支付、消息、社区、性能、模拟等子包） | `backend/src/main/java/com/campus/marketplace/controller` |
| `service` | 业务服务、实现、异步任务、合规、风控、通知等 | `backend/src/main/java/com/campus/marketplace/service` |
| `repository` | JPA Repository、QueryDSL 扩展 | `backend/src/main/java/com/campus/marketplace/repository` |
| `websocket` | STOMP 通道、消息处理 | `backend/src/main/java/com/campus/marketplace/websocket` |
| 配置文件 | 多环境 YAML、Redisson、日志、Flyway、支付参数 | `backend/src/main/resources` |
- 安全：`SecurityConfig` + `JwtAuthenticationFilter`（无状态）、`PermissionCodes` + `RoleDefinition`。绝大多数接口通过 `@PreAuthorize` 控制权限。
- 质量：集成 OWASP Dependency-Check、SpotBugs、JaCoCo、PIT、Testcontainers、Postman/JMeter 可选冒烟。

## 3. 前端速览
| 包 | 作用 | 技术栈 | 目录 |
| ---- | ---- | ------ | ---- |
| `@campus/shared` | 公共组件、Hook、服务、类型、工具、OpenAPI 客户端 | TypeScript 5.5、React 18、Axios、React Query、Zustand、tsup | `frontend/packages/shared` |
| `@campus/portal` | C 端用户界面（PC + 移动） | React 18、Vite、Tailwind、React Router、React Query、Zustand | `frontend/packages/portal` |
| `@campus/admin` | 管理后台 | React 18、Vite、Ant Design、React Query、Zustand | `frontend/packages/admin` |
- 脚本：`pnpm run dev:*` / `build:*` / `lint` / `type-check` / `api:generate`。
- WebSocket：共享层 `services/WebSocketClient.ts` + `useWebSocketService` 提供自动重连与心跳。

## 4. Docker & 部署
| 模板 | 说明 |
| ---- | ---- |
| `docker/docker-compose.dev.yml` | 本地依赖（PostgreSQL、Redis、Mailhog）。 |
| `docker/docker-compose.prod.min.yml` | 最小部署：PostgreSQL + Redis 单节点 + 双实例后端 + Nginx。 |
| `docker/docker-compose.prod.ha.yml` | 高可用：PostgreSQL 主从、Redis Sentinel、双实例后端、Nginx、Prometheus、Grafana。 |
- Nginx 反向代理 / 负载均衡：`docker/nginx/nginx.conf`、`docker/nginx/conf.d/locations.conf`。
- 监控：`docker/prometheus`、`docker/grafana`。

## 5. 协作原则
- **语言**：所有注释、文档、PR、讨论统一使用中文；代码注释强调意图与边界。
- **测试优先**：新增功能需补充单元/集成测试；安全扫描、构建必须通过。
- **文档同步**：更新功能后同步 `docs/` 下相关手册（部署、安全、前端策略等）。
- **权限意识**：引用权限字符串需使用 `PermissionCodes` 常量，避免“魔法值”。
- **性能安全**：关注缓存、限流、审计；避免阻塞式调用、确保敏感数据加密或脱敏。

## 6. 常用命令
```bash
# 后端
cd backend
mvn verify                       # 单元 + 集成 + 覆盖率 + OWASP + PIT
mvn org.owasp:dependency-check-maven:check  # 单独安全扫描
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# 前端
cd frontend
pnpm install
pnpm run dev:portal              # 用户端开发
pnpm run dev:admin               # 管理端开发
pnpm run build:all               # 统一构建
pnpm run api:generate            # 更新 OpenAPI 客户端

# Docker（高可用）
docker compose -f docker/docker-compose.prod.ha.yml --env-file .env.prod up -d
docker compose -f docker/docker-compose.prod.ha.yml logs -f app-1
```

## 7. 参考文档（docs/）
- `安全扫描使用指南.md`
- `生产环境部署指南.md`
- `前端架构蓝图 v3.0`（即 `前端架构需求分析文档.md`）
- `前端项目开发策略.md`
- `前端 Monorepo 架构交付报告.md`
- `支付宝沙箱配置指南.md`

> 当你需要向其他协作者（或 AI 助手）描述项目时，可直接引用本提示词中的要点，确保沟通一致、上下文充分。
